import{r as n,j as e}from"./index-Bk3vKcFm.js";import{a as y}from"./api-CQpZrRPq.js";import"./iconify-D1qMnGbo.js";import{l as B}from"./cropper-gzP2ppDS.js";import{F as a}from"./Form-Bzdko2cR.js";import{A as P}from"./Alert-CcI301NI.js";import{R as U}from"./Row-DsFnQgll.js";import{C as v}from"./Col-B9Ck3_nO.js";import{F as f}from"./FormControl-B2brg_VZ.js";import{C as G,a as q}from"./Card-CJZGyBPV.js";import{B as N}from"./Button-B73yjmLp.js";import{S as z}from"./Spinner-fXcKpI-J.js";const Z=({committeeId:S,onSuccess:R,onCancel:F,initialData:r})=>{const[l,E]=n.useState((r==null?void 0:r.name)||""),[u,w]=n.useState((r==null?void 0:r.position)||""),[g,h]=n.useState((r==null?void 0:r.image)||null),[p,I]=n.useState(null),[x,i]=n.useState(!1),[j,t]=n.useState(null),b=n.useRef(null),c=!!r;n.useEffect(()=>{r!=null&&r.image&&h(r.image)},[r]);const L=o=>{const s=o.target.files[0];if(!s)return;if(!s.type.match("image.*")){t("Please select an image file (JPEG, PNG, etc.)");return}if(s.size>5*1024*1024){t("Image size should be less than 5MB");return}t(null);const m=new FileReader;m.onload=()=>{h(m.result)},m.onerror=()=>{t("Failed to read image file")},m.readAsDataURL(s)},M=()=>{var s;const o=(s=b.current)==null?void 0:s.cropper;o&&o.getCroppedCanvas().toBlob(m=>{I(m)},"image/jpeg",.8)},A=async o=>{var m,C;if(o.preventDefault(),i(!0),t(null),!l||!u){t("Name and position are required"),i(!1);return}const s=new FormData;s.append("name",l),s.append("position",u),p&&(!(r!=null&&r.image)||r.image&&typeof r.image=="string")&&s.append("image",p,"member.jpg");try{let d;c?d=await y.put(`/constitution-committees/members/${r.id}`,s,{headers:{"Content-Type":"multipart/form-data"}}):d=await y.post(`/constitution-committees/${S}/members`,s,{headers:{"Content-Type":"multipart/form-data"}}),d.status===(c?200:201)&&R(d.data.data)}catch(d){console.error("Error saving member:",d),t(((C=(m=d.response)==null?void 0:m.data)==null?void 0:C.message)||`Failed to ${c?"update":"add"} member`)}finally{i(!1)}};return e.jsxs(a,{onSubmit:A,children:[j&&e.jsx(P,{variant:"danger",onClose:()=>t(null),dismissible:!0,children:j}),e.jsxs(U,{children:[e.jsxs(v,{md:6,children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Member Name *"}),e.jsx(f,{type:"text",value:l,onChange:o=>E(o.target.value),placeholder:"Enter member name",required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Position *"}),e.jsx(f,{type:"text",value:u,onChange:o=>w(o.target.value),placeholder:"Enter position",required:!0})]})]}),e.jsxs(v,{md:6,children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Member Image (163x231 recommended)"}),e.jsx(f,{type:"file",accept:"image/*",onChange:L})]}),g&&e.jsx(G,{className:"mb-3",children:e.jsx(q,{children:e.jsx(B,{src:g,style:{height:400,width:"100%"},initialAspectRatio:163/231,aspectRatio:163/231,guides:!1,crop:M,ref:b})})}),p&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Cropped Preview:"}),e.jsx("img",{src:URL.createObjectURL(p),alt:"Cropped preview",style:{maxHeight:"200px"}})]})]})]}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(N,{variant:"secondary",className:"me-2",onClick:F,children:"Cancel"}),e.jsx(N,{variant:"primary",type:"submit",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(z,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-1"}),c?"Updating...":"Adding..."]}):c?"Update Member":"Add Member"})]})]})};export{Z as M};
