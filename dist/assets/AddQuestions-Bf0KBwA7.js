import{u as Y,d as z,r as a,j as e,T as H,h as U,i as W}from"./index-DvBs_XxN.js";import{l as Z}from"./cropper-CqY3ptzF.js";import{I as r}from"./IconifyIcon-B1qkdp1h.js";import{a as g}from"./api-CQpZrRPq.js";import{P as J}from"./PageTitle-JyfAtr6J.js";import{l as K}from"./logo-sm-Bq_R7RX3.js";import{R as S}from"./Row-4F2rpKTs.js";import{C as y}from"./Col-X6kS0LVx.js";import{C as T,a as Q}from"./Card-DacR5r0v.js";import{F as i}from"./Form-CC5zIamG.js";import{B as n}from"./Button-C42B3a1V.js";import"./iconify-BL8OsjYR.js";import"./CardHeaderContext-D448mrBQ.js";import"./divWithClassName-BHTNlR0-.js";import"./FormCheck-CTNZ5Y0v.js";import"./FormContext-Wcv-ptEj.js";import"./ElementChildren-a0KITWjK.js";import"./FormControl-DyA7hG25.js";import"./FormLabel-BW5cyMxn.js";import"./Button-DgXctBpM.js";const Ce=()=>{const E=Y(),{id:f,questionId:u}=z(),[p,F]=a.useState(!1),[M,C]=a.useState(!1),[v,b]=a.useState(null),[V,O]=a.useState({cropX:0,cropY:0,imageWidth:0,imageHeight:0,imageRotate:0,scaleX:0,scaleY:0}),[q,k]=a.useState(null),[h,w]=a.useState(""),[m,I]=a.useState("text"),[l,x]=a.useState([""]),[N,j]=a.useState(0),c=a.useRef(null),R=400/400;a.useEffect(()=>{u?(F(!0),D()):L()},[u]);const D=async()=>{try{const s=(await g.get(`/survey/question/${u}`)).data.data.question;w(s.text),I(s.type),j(s.position),s.type==="multiple_choice"&&s.options&&x(s.options),s.image&&b(s.image)}catch(t){console.error("Error fetching question:",t)}},L=async()=>{try{const t=await g.get(`/survey/surveys/${f}/questions`);t.status===200&&j(t.data.data.questions.length)}catch(t){console.error("Error fetching question count:",t)}},_=t=>{const s=t.target.files[0];if(s){const o=new FileReader;o.onload=()=>{b(o.result)},o.readAsDataURL(s)}},A=()=>{var s;const t=(s=c.current)==null?void 0:s.cropper;if(t){const o=t.getData(),d=t.getImageData();O({cropX:Math.ceil(o.x),cropY:Math.ceil(o.y),imageWidth:Math.ceil(d.width),imageHeight:Math.ceil(d.height),imageRotate:Math.ceil(d.rotate),scaleX:Math.ceil(d.scaleX),scaleY:Math.ceil(d.scaleY)}),t.getCroppedCanvas().toBlob(X=>{k(X)})}},$=()=>{x([...l,""])},B=t=>{const s=l.filter((o,d)=>d!==t);x(s)},G=(t,s)=>{const o=[...l];o[t]=s,x(o)},P=async()=>{if(!h.trim()){alert("Question text is required.");return}if(m==="multiple_choice"&&l.some(o=>!o.trim())){alert("All options must be filled.");return}const t=q?new File([q],"question-image.png",{type:"image/png"}):null,s=new FormData;s.append("surveyId",f),t&&s.append("image",t),s.append("text",h),s.append("type",m),s.append("position",N.toString()),m==="multiple_choice"&&s.append("options",JSON.stringify(l.filter(o=>o.trim()!=="")));try{let o;p?o=await g.put(`/survey/question/${u}`,s,{headers:{"Content-Type":"multipart/form-data"}}):o=await g.post("/survey/question",s,{headers:{"Content-Type":"multipart/form-data"}}),o.status===200&&(C(!0),setTimeout(()=>{E(`/questions/${f}`)},2e3))}catch(o){console.error("Error:",o),alert(`Failed to ${p?"update":"create"} question.`)}};return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:p?"Edit Question":"New Question"}),e.jsxs(H,{onClose:()=>C(!1),show:M,delay:2e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(U,{children:[e.jsx("img",{src:K,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsxs(W,{children:["Question ",p?"updated":"created"," successfully."]})]}),e.jsx(S,{children:e.jsx(y,{xs:12,children:e.jsx(T,{children:e.jsx(Q,{children:e.jsxs(S,{children:[e.jsxs(y,{lg:9,children:[e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Upload Question Image (400x400)"}),e.jsx(i.Control,{type:"file",accept:"image/*",onChange:_})]}),v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"img-container",children:e.jsx(Z,{src:v,style:{height:400,width:"100%"},initialAspectRatio:R,aspectRatio:R,guides:!1,crop:A,ref:c,rotatable:!0,scalable:!0,zoomable:!0})}),e.jsx(T,{children:e.jsx(Q,{children:e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsxs(n,{onClick:()=>{var t;return(t=c.current)==null?void 0:t.cropper.zoom(.1)},children:[e.jsx(r,{icon:"mdi:magnify-plus-outline"})," ","Zoom In"]}),e.jsxs(n,{onClick:()=>{var t;return(t=c.current)==null?void 0:t.cropper.zoom(-.1)},children:[e.jsx(r,{icon:"mdi:magnify-minus-outline"})," ","Zoom Out"]}),e.jsxs(n,{onClick:()=>{var t;return(t=c.current)==null?void 0:t.cropper.rotate(-45)},children:[e.jsx(r,{icon:"mdi:rotate-left"})," Rotate Left"]}),e.jsxs(n,{onClick:()=>{var t;return(t=c.current)==null?void 0:t.cropper.rotate(45)},children:[e.jsx(r,{icon:"mdi:rotate-right"})," Rotate Right"]}),e.jsxs(n,{onClick:()=>{var t;return(t=c.current)==null?void 0:t.cropper.reset()},children:[e.jsx(r,{icon:"mdi:sync"})," Reset"]}),e.jsxs(n,{onClick:()=>{var t;return(t=c.current)==null?void 0:t.cropper.clear()},children:[e.jsx(r,{icon:"mdi:close"})," Clear"]})]})})})]})]}),e.jsxs(y,{lg:3,children:[e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Question Text"}),e.jsx(i.Control,{type:"text",value:h,onChange:t=>w(t.target.value),placeholder:"Enter question",required:!0})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Question Type"}),e.jsxs(i.Control,{as:"select",value:m,onChange:t=>I(t.target.value),children:[e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"multiple_choice",children:"Multiple Choice"})]})]}),p&&e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Position"}),e.jsx(i.Control,{type:"number",value:N,onChange:t=>j(parseInt(t.target.value)||0),min:"0"})]}),m==="multiple_choice"&&e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Options"}),l.map((t,s)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(i.Control,{type:"text",value:t,onChange:o=>G(s,o.target.value),placeholder:`Option ${s+1}`,required:!0}),e.jsx(n,{variant:"danger",className:"ms-2",onClick:()=>B(s),disabled:l.length<=1,children:e.jsx(r,{icon:"mdi:delete"})})]},s)),e.jsxs(n,{variant:"secondary",className:"w-100",onClick:$,children:[e.jsx(r,{icon:"mdi:plus"})," Add Options"]})]}),e.jsxs(n,{variant:"primary",className:"w-100 mt-3",onClick:P,disabled:!h.trim()||m==="multiple_choice"&&l.some(t=>!t.trim()),children:[e.jsx(r,{icon:p?"mdi:pencil":"mdi:plus"}),p?"Update Question":"Create Question"]})]})]})})})})})]})};export{Ce as default};
