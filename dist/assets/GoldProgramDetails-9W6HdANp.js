import{d as R,u as W,r as c,j as e,T as P}from"./index-oZOXagb6.js";import{a as T}from"./api-CQpZrRPq.js";import{P as F}from"./PageTitle-CDfmxWcc.js";import{I as h}from"./IconifyIcon-DvFk5hCx.js";import{S as U}from"./Spinner-CWr4oDD1.js";import{C as l}from"./Card-CByQ_iKt.js";import{R as _}from"./Row-BRTb4Q3x.js";import{C as S}from"./Col-CliyWdof.js";import{B as g}from"./Badge-BRdiW6wS.js";import{B as p}from"./Button-BjDVT7iL.js";import{T as z}from"./Tabs-Dse4vB8_.js";import{T as C}from"./Tab-Gj97M5FK.js";import{T as D}from"./Table-CaIrORlB.js";import"./iconify-DRmFi74x.js";import"./CardHeaderContext-DZwIQcmL.js";import"./divWithClassName-D5RmpbwJ.js";import"./Button-B8bHFfcq.js";import"./hook-BSmuNoS1.js";import"./extends-CF3RwP-h.js";import"./TabPane-epuITUe2.js";import"./Nav-CLJlsQMz.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-CRMgCCd9.js";import"./useMergedRefs-pn6opyZt.js";import"./NavItem-tRJ2ltAO.js";import"./useEventCallback-BEJq0vfy.js";import"./NavbarContext-_wqrdHt5.js";import"./NavLink-D-AUKX0U.js";import"./Anchor-Myl3kwLU.js";import"./NoopTransition-DgaF_Ew9.js";import"./ElementChildren-B0W_E0jD.js";const be=()=>{var v,w,N,A;const{id:a}=R(),x=W(),[t,L]=c.useState(null),[I,b]=c.useState(!0),[E,B]=c.useState("lots"),[k,j]=c.useState(!1),[M,f]=c.useState("");c.useEffect(()=>{(async()=>{try{b(!0);const i=await T.get(`/gold/${a}`);L(i.data.data)}catch(i){console.error("Error fetching program:",i),f("Failed to load program data"),j(!0)}finally{b(!1)}})()},[a]);const $=async()=>{var s,i;try{const n=await T.get(`/gold/${a}/export-payments`,{responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}),d=new Blob([n.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=window.URL.createObjectURL(d),r=document.createElement("a");r.href=o;let m=`gold_payments_${t.name||a}.xlsx`;const u=n.headers["content-disposition"];if(u){const y=u.match(/filename="?(.+)"?/);y&&y[1]&&(m=y[1])}r.setAttribute("download",m),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(o),r.parentNode.removeChild(r),f("Payment report downloaded successfully"),j(!0)}catch(n){console.error("Error exporting payments:",n),f(((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to export payment data"),j(!0)}};return I?e.jsx("div",{className:"d-flex justify-content-center p-5",children:e.jsx(U,{animation:"border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):t?e.jsxs(e.Fragment,{children:[e.jsx(F,{title:t.name,breadcrumbItems:[{label:"Gold Programs",path:"/gold-programs"},{label:t.name,active:!0}]}),e.jsx(P,{onClose:()=>j(!1),show:k,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(P.Body,{children:M})}),e.jsx(l,{className:"mb-4",children:e.jsxs(l.Body,{children:[e.jsxs(_,{children:[e.jsxs(S,{md:6,children:[e.jsx("h4",{children:t.name}),e.jsx("p",{className:"text-muted",children:t.description}),e.jsxs("div",{className:"d-flex gap-2 mb-3",children:[e.jsx(g,{bg:t.isActive?"success":"secondary",children:t.isActive?"Active":"Ended"}),e.jsxs(g,{bg:"info",children:[((v=t._count)==null?void 0:v.lots)||0," Lots"]}),e.jsxs(g,{bg:"primary",children:[((w=t._count)==null?void 0:w.winners)||0," Winners"]})]})]}),e.jsxs(S,{md:6,className:"text-end",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Started:"})," ",new Date(t.startDate).toLocaleDateString()]}),t.endDate&&e.jsxs("p",{children:[e.jsx("strong",{children:"Ended:"})," ",new Date(t.endDate).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[t.isActive&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{variant:"warning",onClick:()=>x(`/gold-programs/${a}/lots/new`),children:[e.jsx(h,{icon:"mdi:account-plus",className:"me-1"}),"Assign Lot"]}),e.jsxs(p,{variant:"success",onClick:()=>x(`/gold-programs/${a}/winners`),children:[e.jsx(h,{icon:"mdi:trophy",className:"me-1"}),"Manage Winners"]})]}),e.jsxs(p,{variant:"primary",onClick:$,children:[e.jsx(h,{icon:"mdi:file-excel",className:"me-1"}),"Export Payments"]})]})]})}),e.jsxs(z,{activeKey:E,onSelect:s=>B(s),className:"mb-3",children:[e.jsx(C,{eventKey:"lots",title:"Lots",children:e.jsx(l,{children:e.jsx(l.Body,{children:e.jsxs(D,{striped:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Member ID"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Payments"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:(N=t.lots)==null?void 0:N.map((s,i)=>{var n,d,o,r,m;return e.jsxs("tr",{children:[e.jsx("td",{children:i+1}),e.jsx("td",{children:((n=s.user)==null?void 0:n.memberId)||"N/A"}),e.jsx("td",{children:((d=s.user)==null?void 0:d.name)||"N/A"}),e.jsxs("td",{children:[((o=s.payments)==null?void 0:o.filter(u=>u.isPaid).length)||0," paid"]}),e.jsx("td",{children:e.jsx(g,{bg:(r=s.winners)!=null&&r.length?"success":"primary",children:(m=s.winners)!=null&&m.length?"Winner":"Active"})}),e.jsx("td",{children:e.jsx(p,{size:"sm",variant:"primary",onClick:()=>x(`/gold-programs/${a}/lots/${s.id}/payments`),title:"View Payments",children:e.jsx(h,{icon:"mdi:cash"})})})]},s.id)})})]})})})}),e.jsx(C,{eventKey:"winners",title:"Winners",children:e.jsx(l,{children:e.jsxs(l.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between mb-3",children:[e.jsx("h5",{children:"Monthly Winners"}),t.isActive&&e.jsxs(p,{variant:"primary",size:"sm",onClick:()=>x(`/gold-programs/${a}/winners`),children:[e.jsx(h,{icon:"mdi:plus",className:"me-1"}),"Add Winners"]})]}),e.jsxs(D,{striped:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Month"}),e.jsx("th",{children:"Member ID"}),e.jsx("th",{children:"Winner Name"})]})}),e.jsx("tbody",{children:(A=t.winners)==null?void 0:A.map((s,i)=>{var n,d,o,r;return e.jsxs("tr",{children:[e.jsx("td",{children:i+1}),e.jsxs("td",{children:[new Date(0,s.month-1).toLocaleString("default",{month:"long"})," ",s.year]}),e.jsx("td",{children:((d=(n=s.lot)==null?void 0:n.user)==null?void 0:d.memberId)||"N/A"}),e.jsx("td",{children:((r=(o=s.lot)==null?void 0:o.user)==null?void 0:r.name)||"N/A"})]},s.id)})})]})]})})})]})]}):e.jsx("div",{className:"d-flex justify-content-center p-5",children:"Program not found"})};export{be as default};
