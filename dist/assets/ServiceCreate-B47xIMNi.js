import{a as K,r as o,j as e,T as Q,g as V,h as ee}from"./index-DPuNUjLg.js";import{l as te}from"./cropper-MwML4X9w.js";import{I as u}from"./IconifyIcon-CRmgpD-A.js";import{a as se}from"./api-alN533tX.js";import{P as ae}from"./PageTitle-CqWn3q0T.js";import{l as re}from"./logo-sm-DeRMNujR.js";import{R as I,C as D}from"./Row-CcHO1i0D.js";import{C as M}from"./Card-BZ6UHl2I.js";import{C as k}from"./CardBody-CGT1fL4u.js";import{F as s}from"./Form-LPEeaXcj.js";import{B as m}from"./Button-BnjsKorX.js";import"./iconify-CwHMartp.js";import"./CardHeaderContext-DMcAJQTf.js";import"./divWithClassName-CR8nEuA8.js";import"./FormCheck-KaS-eO03.js";import"./FormContext-BlvwWdud.js";import"./ElementChildren-ChJp8XjW.js";import"./FormControl-bLwLOBBO.js";import"./FormLabel-B_CILb4g.js";import"./Button-CXwj5S0n.js";const Re=()=>{const L=K(),[P,d]=o.useState(!1),[E,l]=o.useState(""),[T,w]=o.useState(!1),[R,G]=o.useState(null),[oe,H]=o.useState({cropX:0,cropY:0,imageWidth:0,imageHeight:0,imageRotate:0,scaleX:0,scaleY:0}),[j,$]=o.useState(null),[f,z]=o.useState(""),[C,A]=o.useState(""),[v,B]=o.useState(""),[y,X]=o.useState(""),[b,Y]=o.useState(""),[h,N]=o.useState([""]),p=o.useRef(null),F=123/137,U=t=>{const a=t.target.files[0];if(!a)return;if(!a.type.startsWith("image/")){l("Please upload a valid image file."),d(!0);return}if(a.size>5*1024*1024){l("File size must be less than 5MB."),d(!0);return}const r=new FileReader;r.onload=()=>{G(r.result)},r.readAsDataURL(a)},W=()=>{var a;const t=(a=p.current)==null?void 0:a.cropper;if(t){const r=t.getData(),c=t.getImageData();H({cropX:Math.ceil(r.x),cropY:Math.ceil(r.y),imageWidth:Math.ceil(c.width),imageHeight:Math.ceil(c.height),imageRotate:Math.ceil(c.rotate),scaleX:Math.ceil(c.scaleX),scaleY:Math.ceil(c.scaleY)}),t.getCroppedCanvas().toBlob(n=>{$(n)})}},q=()=>{N([...h,""])},O=t=>{const a=h.filter((r,c)=>c!==t);N(a)},Z=(t,a)=>{const r=[...h];r[t]=a,N(r)},J=async()=>{if(!j){l("Please crop the image first."),d(!0);return}if(!f||!C||!y||!b||!v||h.length===0){l("Please fill all required fields."),d(!0);return}w(!0);const t=i=>{const[g,S]=i.split(":"),x=parseInt(g,10),_=x>=12?"PM":"AM";return`${x%12||12}:${S} ${_}`},a=`${t(y)} - ${t(b)}`,r=`service-image-${Date.now()}.png`,c=new File([j],r,{type:"image/png"}),n=new FormData;n.append("image",c),n.append("title",f),n.append("location",C),n.append("availableTime",a),n.append("phoneNumber",v),n.append("availableDays",JSON.stringify(h.filter(i=>i.trim()!==""))),(i=>{const g={};for(let[S,x]of i.entries())g[S]=x;console.log(g)})(n);try{(await se.post("/services/new",n,{headers:{"Content-Type":"multipart/form-data"}})).status===201?(l("Service created successfully!"),d(!0),setTimeout(()=>{L("/service")},2e3)):(l("Failed to create service."),d(!0))}catch(i){console.error("Error creating service:",i),i.response?l(i.response.data.message||"Failed to create service."):i.request?l("Network error. Please check your connection."):l("An unexpected error occurred."),d(!0)}finally{w(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{title:"New service"}),e.jsxs(Q,{onClose:()=>d(!1),show:P,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(V,{children:[e.jsx("img",{src:re,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsx(ee,{children:E})]}),e.jsx(I,{children:e.jsx(D,{xs:12,children:e.jsx(M,{children:e.jsx(k,{children:e.jsxs(I,{children:[e.jsxs(D,{lg:9,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Upload Service Image (123x137)"}),e.jsx(s.Control,{type:"file",accept:"image/*",onChange:U})]}),R&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"img-container",children:e.jsx(te,{src:R,style:{height:400,width:"100%"},initialAspectRatio:F,aspectRatio:F,guides:!1,crop:W,ref:p,rotatable:!0,scalable:!0,zoomable:!0})}),e.jsx(M,{children:e.jsx(k,{children:e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsxs(m,{onClick:()=>{var t;return(t=p.current)==null?void 0:t.cropper.zoom(.1)},children:[e.jsx(u,{icon:"mdi:magnify-plus-outline"})," Zoom In"]}),e.jsxs(m,{onClick:()=>{var t;return(t=p.current)==null?void 0:t.cropper.zoom(-.1)},children:[e.jsx(u,{icon:"mdi:magnify-minus-outline"})," Zoom Out"]}),e.jsxs(m,{onClick:()=>{var t;return(t=p.current)==null?void 0:t.cropper.rotate(-45)},children:[e.jsx(u,{icon:"mdi:rotate-left"})," Rotate Left"]}),e.jsxs(m,{onClick:()=>{var t;return(t=p.current)==null?void 0:t.cropper.rotate(45)},children:[e.jsx(u,{icon:"mdi:rotate-right"})," Rotate Right"]}),e.jsxs(m,{onClick:()=>{var t;return(t=p.current)==null?void 0:t.cropper.reset()},children:[e.jsx(u,{icon:"mdi:sync"})," Reset"]}),e.jsxs(m,{onClick:()=>{var t;return(t=p.current)==null?void 0:t.cropper.clear()},children:[e.jsx(u,{icon:"mdi:close"})," Clear"]})]})})})]})]}),e.jsxs(D,{lg:3,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Service Title"}),e.jsx(s.Control,{type:"text",value:f,onChange:t=>z(t.target.value),placeholder:"Enter service title"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Place"}),e.jsx(s.Control,{type:"text",value:C,onChange:t=>A(t.target.value),placeholder:"Enter service place"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Start Time"}),e.jsx(s.Control,{type:"time",value:y,onChange:t=>X(t.target.value)})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"End Time"}),e.jsx(s.Control,{type:"time",value:b,onChange:t=>Y(t.target.value)})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Phone Number"}),e.jsx(s.Control,{type:"number",value:v,onChange:t=>B(t.target.value),placeholder:"Enter phone number"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Days"}),h.map((t,a)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(s.Control,{type:"text",value:t,onChange:r=>Z(a,r.target.value),placeholder:`Day ${a+1}`}),e.jsx(m,{variant:"danger",className:"ms-2",onClick:()=>O(a),children:e.jsx(u,{icon:"mdi:delete"})})]},a)),e.jsxs(m,{variant:"secondary",className:"w-100",onClick:q,children:[e.jsx(u,{icon:"mdi:plus"})," Add Day"]})]}),e.jsx(m,{variant:"primary",className:"w-100 mt-3",onClick:J,disabled:!j||T,children:T?"Creating...":"Create Service"})]})]})})})})})]})};export{Re as default};
