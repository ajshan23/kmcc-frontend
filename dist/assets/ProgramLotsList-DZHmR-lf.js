import{d as z,u as F,r as o,j as e}from"./index-BJxyWXw5.js";import{a as v}from"./api-CQpZrRPq.js";import{P as H}from"./PageTitle-CrVvbIAm.js";import{S as N}from"./Spinner-BnFYvPDL.js";import{A as j}from"./Alert-CpJv488r.js";import{B as l}from"./Button-CGKBl0Dq.js";import{R as T}from"./Row-BL2JdXdK.js";import{C as A}from"./Col-DIvgp7I2.js";import{C as R}from"./Card-tfBEtDvx.js";import{T as W}from"./Table-C9xmPB6g.js";import{B as G}from"./Badge-Cb0QFnV7.js";import{M as x}from"./Modal-mK9PqeHZ.js";import"./hook-D0SvG8YV.js";import"./extends-CF3RwP-h.js";import"./divWithClassName-CjTg634B.js";import"./Anchor-CWIwgsZZ.js";import"./useEventCallback-UJTQjI5X.js";import"./Button-CctqLc8n.js";import"./CardHeaderContext-b-v_Bpfa.js";import"./AbstractModalHeader-DcSmph9c.js";import"./useWindow-DPDKtJy6.js";import"./usePrevious-Bvv3fifr.js";import"./hasClass-DXqp-4_b.js";import"./useMergedRefs-WPm0qXrL.js";import"./NoopTransition-BubZyDxC.js";import"./DataKey-COGXBUcQ.js";const pe=()=>{var S;const{programId:i}=z(),w=F(),[g,b]=o.useState([]),[t,B]=o.useState(null),[f,u]=o.useState(!0),[C,L]=o.useState(null),[I,p]=o.useState(!1),[d,M]=o.useState(null),[$,y]=o.useState(!1),[E,P]=o.useState("");o.useEffect(()=>{(async()=>{var n,r,c,m;u(!0),L(null);try{const[a,h]=await Promise.all([v.get(`/gold/${i}`),v.get(`/gold/${i}/lots/`)]);if(!((n=a.data)!=null&&n.data)||!((r=h.data)!=null&&r.data))throw new Error("Invalid data structure from API");B(a.data.data),b(h.data.data)}catch(a){console.error("Error fetching data:",a),L(((m=(c=a.response)==null?void 0:c.data)==null?void 0:m.message)||a.message||"Failed to load data")}finally{u(!1)}})()},[i]);const k=async()=>{var s,n;u(!0);try{await v.delete(`/gold/lots/${d.id}`),b(g.filter(r=>r.id!==d.id)),P("Lot removed successfully"),y(!0),p(!1)}catch(r){P(((n=(s=r.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to remove lot"),y(!0)}finally{u(!1)}};return f?e.jsx("div",{className:"text-center py-4",children:e.jsx(N,{animation:"border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):C?e.jsxs(j,{variant:"danger",className:"my-4",children:[e.jsx(j.Heading,{children:"Error loading data"}),e.jsx("p",{children:C}),e.jsx(l,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{title:`Lots - ${(t==null?void 0:t.name)||"Program"}`,breadcrumbItems:[{label:"Gold Programs",path:"/gold-programs"},{label:(t==null?void 0:t.name)||"Program",path:`/gold-programs/${i}`},{label:"Lots",active:!0}]}),e.jsx(Toast,{onClose:()=>y(!1),show:$,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(Toast.Body,{children:E})}),e.jsx(T,{className:"mb-3",children:e.jsx(A,{children:e.jsx(l,{variant:"primary",onClick:()=>w(`/gold-programs/${i}/lots/new`),children:"Assign New Lot"})})}),e.jsx(T,{children:e.jsx(A,{children:e.jsx(R,{children:e.jsx(R.Body,{children:g.length===0?e.jsx(j,{variant:"info",children:"No lots found for this program"}):e.jsxs(W,{striped:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Member ID"}),e.jsx("th",{children:"Payments"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:g.map(s=>{var n,r,c,m,a,h;return e.jsxs("tr",{children:[e.jsx("td",{children:((n=s.user)==null?void 0:n.name)||"N/A"}),e.jsx("td",{children:((r=s.user)==null?void 0:r.memberId)||"N/A"}),e.jsxs("td",{children:[((c=s.payments)==null?void 0:c.filter(D=>D.isPaid).length)||0," /",(t==null?void 0:t.durationMonths)||"N/A"]}),e.jsx("td",{children:e.jsx(G,{bg:(m=s.winners)!=null&&m.length?"success":"secondary",children:(a=s.winners)!=null&&a.length?"Winner":"Active"})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(l,{variant:"primary",size:"sm",onClick:()=>w(`/gold-programs/${i}/lots/${s.id}/payments`),children:"Payments"}),!((h=s.winners)!=null&&h.length)&&e.jsx(l,{variant:"danger",size:"sm",onClick:()=>{M(s),p(!0)},disabled:f,children:"Remove"})]})})]},s.id)})})]})})})})}),e.jsxs(x,{show:I,onHide:()=>p(!1),centered:!0,children:[e.jsx(x.Header,{closeButton:!0,children:e.jsx(x.Title,{children:"Confirm Lot Removal"})}),e.jsxs(x.Body,{children:["Are you sure you want to remove this lot? This action cannot be undone.",((S=d==null?void 0:d.payments)==null?void 0:S.length)>0&&e.jsxs(j,{variant:"warning",className:"mt-3",children:[e.jsx("strong",{children:"Warning:"})," This lot has payment records. Removing it will also delete all associated payment records."]})]}),e.jsxs(x.Footer,{children:[e.jsx(l,{variant:"secondary",onClick:()=>p(!1),children:"Cancel"}),e.jsx(l,{variant:"danger",onClick:k,children:f?e.jsx(N,{size:"sm",animation:"border"}):"Remove Lot"})]})]})]})};export{pe as default};
