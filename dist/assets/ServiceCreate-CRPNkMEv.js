import{d as W,u as J,r,j as e,T as K,h as Q,i as V}from"./index-CfNT85tM.js";import{l as X}from"./cropper-pWBWfG95.js";import{I as l}from"./IconifyIcon-0D5ZULyN.js";import{a as f}from"./api-BAouzzCb.js";import{P as Y}from"./PageTitle-D_HZ265t.js";import{l as _}from"./logo-sm-DeRMNujR.js";import{R as M,C as y}from"./Row-pUvplkm2.js";import{C as G}from"./Card-BxC9ygCX.js";import{C as P}from"./CardBody-TiP-bp9B.js";import{F as a}from"./Form-BPTIrVzf.js";import{B as o}from"./Button-DmtmunvM.js";import{S as ee}from"./Spinner-DY2VvB9K.js";import"./iconify-Dnpwx_79.js";import"./CardHeaderContext-DMh6jMut.js";import"./divWithClassName-MTQsKDs0.js";import"./FormCheck-DtwGqKiM.js";import"./FormContext-CAGAzZgQ.js";import"./ElementChildren-ShUlXlPu.js";import"./FormControl-dmhg-08h.js";import"./FormLabel-CoJ0DtNH.js";import"./Button-AVmPP0NH.js";const be=()=>{const{id:p}=W(),C=J(),[z,c]=r.useState(!1),[A,m]=r.useState(""),[b,u]=r.useState(!1),[d,B]=r.useState(!1),[S,T]=r.useState(null),[N,U]=r.useState(null),[h,w]=r.useState(""),[x,E]=r.useState(""),[F,I]=r.useState(""),[g,R]=r.useState(""),[j,L]=r.useState(""),[v,D]=r.useState("Mon-Fri"),i=r.useRef(null),k=123/137,$=[{label:"Monday to Friday",value:"Mon-Fri"},{label:"Monday to Saturday",value:"Mon-Sat"},{label:"Everyday",value:"Everyday"},{label:"Custom",value:"Custom"}];r.useEffect(()=>{p&&(B(!0),H())},[p]);const H=async()=>{try{u(!0);const s=(await f.get(`/services/${p}`)).data.data;w(s.title),E(s.location),I(s.phoneNumber),R(s.startingTime),L(s.stoppingTime),D(s.availableDays),s.image&&T(s.image)}catch(t){console.error("Error fetching service:",t),m("Failed to load service data"),c(!0)}finally{u(!1)}},O=t=>{const s=t.target.files[0];if(!s)return;if(!s.type.startsWith("image/")){m("Please upload a valid image file."),c(!0);return}const n=new FileReader;n.onload=()=>{T(n.result)},n.readAsDataURL(s)},Z=()=>{var s;const t=(s=i.current)==null?void 0:s.cropper;t&&t.getCroppedCanvas().toBlob(n=>{U(n)})},q=async()=>{if(!h||!x||!g||!j||!v){m("Please fill all required fields."),c(!0);return}u(!0);const t=new FormData;if(t.append("title",h),t.append("location",x),t.append("startingTime",g),t.append("stoppingTime",j),t.append("availableDays",v),t.append("phoneNumber",F),N){const s=`service-image-${Date.now()}.png`,n=new File([N],s,{type:"image/png"});t.append("image",n)}try{let s;d?s=await f.put(`/services/${p}`,t,{headers:{"Content-Type":"multipart/form-data"}}):s=await f.post("/services/new",t,{headers:{"Content-Type":"multipart/form-data"}}),(s.status===200||s.status===201)&&(m(d?"Service updated successfully!":"Service created successfully!"),c(!0),setTimeout(()=>{C("/service")},2e3))}catch(s){console.error("Error saving service:",s),m(d?"Failed to update service.":"Failed to create service."),c(!0)}finally{u(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:d?"Edit Service":"New Service"}),e.jsxs(K,{onClose:()=>c(!1),show:z,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(Q,{children:[e.jsx("img",{src:_,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsx(V,{children:A})]}),e.jsx(M,{children:e.jsx(y,{xs:12,children:e.jsx(G,{children:e.jsx(P,{children:e.jsxs(M,{children:[e.jsxs(y,{lg:9,children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Service Image (123x137)"}),e.jsx(a.Control,{type:"file",accept:"image/*",onChange:O})]}),S&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"img-container",children:e.jsx(X,{src:S,style:{height:400,width:"100%"},initialAspectRatio:k,aspectRatio:k,guides:!1,crop:Z,ref:i,rotatable:!0,scalable:!0,zoomable:!0})}),e.jsx(G,{children:e.jsx(P,{children:e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsxs(o,{onClick:()=>{var t;return(t=i.current)==null?void 0:t.cropper.zoom(.1)},children:[e.jsx(l,{icon:"mdi:magnify-plus-outline"})," ","Zoom In"]}),e.jsxs(o,{onClick:()=>{var t;return(t=i.current)==null?void 0:t.cropper.zoom(-.1)},children:[e.jsx(l,{icon:"mdi:magnify-minus-outline"})," ","Zoom Out"]}),e.jsxs(o,{onClick:()=>{var t;return(t=i.current)==null?void 0:t.cropper.rotate(-45)},children:[e.jsx(l,{icon:"mdi:rotate-left"})," Rotate Left"]}),e.jsxs(o,{onClick:()=>{var t;return(t=i.current)==null?void 0:t.cropper.rotate(45)},children:[e.jsx(l,{icon:"mdi:rotate-right"})," Rotate Right"]}),e.jsxs(o,{onClick:()=>{var t;return(t=i.current)==null?void 0:t.cropper.reset()},children:[e.jsx(l,{icon:"mdi:sync"})," Reset"]}),e.jsxs(o,{onClick:()=>{var t;return(t=i.current)==null?void 0:t.cropper.clear()},children:[e.jsx(l,{icon:"mdi:close"})," Clear"]})]})})})]})]}),e.jsxs(y,{lg:3,children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Service Title*"}),e.jsx(a.Control,{type:"text",value:h,onChange:t=>w(t.target.value),placeholder:"Enter service title"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Location*"}),e.jsx(a.Control,{type:"text",value:x,onChange:t=>E(t.target.value),placeholder:"Enter service location"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Start Time*"}),e.jsx(a.Control,{type:"time",value:g,onChange:t=>R(t.target.value)})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"End Time*"}),e.jsx(a.Control,{type:"time",value:j,onChange:t=>L(t.target.value)})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Available Days*"}),e.jsx(a.Select,{value:v,onChange:t=>D(t.target.value),children:$.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Phone Number"}),e.jsx(a.Control,{type:"tel",value:F,onChange:t=>I(t.target.value),placeholder:"Enter phone number"})]}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(o,{variant:"primary",onClick:q,disabled:b,children:[b?e.jsx(ee,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}):e.jsx(l,{icon:d?"mdi:content-save":"mdi:plus",className:"me-2"}),d?"Update Service":"Create Service"]}),e.jsx(o,{variant:"outline-secondary",onClick:()=>C("/service"),children:"Cancel"})]})]})]})})})})})]})};export{be as default};
