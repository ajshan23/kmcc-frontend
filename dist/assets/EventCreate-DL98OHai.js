import{d as V,u as X,r as c,j as e,k as Y,T as C}from"./index-tNgA7nGT.js";import{l as ee}from"./cropper-RC2VS0_y.js";import{a as H}from"./api-CQpZrRPq.js";import{P as te}from"./PageTitle-CCkfjASR.js";import{S as I}from"./Spinner-DN05z5fI.js";import{R as $}from"./Row-RifMysLS.js";import{C as T}from"./Col-CnORAU6q.js";import{C as k,a as L}from"./Card-B1tYBRGQ.js";import{F as s}from"./Form-Dv6oRs5P.js";import{B as l}from"./Button-CENta7Bz.js";import"./CardHeaderContext-BtYRO3IT.js";import"./divWithClassName-BkIstr-m.js";import"./FormCheck-Bgt48iIR.js";import"./FormContext-DD_I2OzJ.js";import"./FormCheckInput-B2vMIfyo.js";import"./ElementChildren-DV_13d0k.js";import"./FormControl-CbvVdWru.js";import"./FormLabel-C90nlSEw.js";import"./Button-CXeEohPr.js";const Te=()=>{const{id:o}=V(),b=X(),d=c.useRef(null),[A,u]=c.useState(!1),[P,x]=c.useState(""),[N,S]=c.useState(null),[E,G]=c.useState(null),[M,U]=c.useState(!!o),[j,D]=c.useState(!1),[i,p]=c.useState({title:"",place:"",eventType:"",eventDate:"",startTime:"",endTime:"",highlights:[""]}),R=362/472;c.useEffect(()=>{if(!o)return;(async()=>{try{const n=await H.get(`/admin/events/${o}`);if(console.log("API Response:",n.data),n.status===200){const a=n.data.data.event;let r="",h="";if(a.timing){const[f,g]=a.timing.split(" - ");r=w(f.trim()),h=w(g.trim())}p({title:a.title||"",place:a.place||"",eventType:a.eventType||"",eventDate:a.eventDate?new Date(a.eventDate).toISOString().split("T")[0]:"",startTime:r,endTime:h,highlights:Array.isArray(a.highlights)?a.highlights:[""]}),a.image&&S(a.image)}}catch(n){console.error("Error fetching event:",n),x("Failed to load event data. Please try again."),u(!0)}finally{U(!1)}})()},[o]);const w=t=>{if(!t)return"";if(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/.test(t))return t;const n=t.match(/^(\d{1,2}):(\d{2})\s*(AM|PM)?$/i);if(!n)return"";let a=parseInt(n[1],10);const r=n[2],h=n[3]?n[3].toUpperCase():"";return h==="PM"&&a!==12?a+=12:h==="AM"&&a===12&&(a=0),`${a.toString().padStart(2,"0")}:${r}`},q=t=>{const n=t.target.files[0];if(n){const a=new FileReader;a.onload=()=>{S(a.result)},a.readAsDataURL(n)}},B=()=>{var n;const t=(n=d.current)==null?void 0:n.cropper;t&&t.getCroppedCanvas().toBlob(a=>{G(a)})},m=t=>{const{name:n,value:a}=t.target;p(r=>({...r,[n]:a}))},z=()=>{p(t=>({...t,highlights:[...t.highlights,""]}))},O=t=>{const n=i.highlights.filter((a,r)=>r!==t);p(a=>({...a,highlights:n.length>0?n:[""]}))},Z=(t,n)=>{const a=[...i.highlights];a[t]=n,p(r=>({...r,highlights:a}))},J=async t=>{var n,a;t.preventDefault(),D(!0);try{const r=new FormData;E&&r.append("image",E);const h=v=>{if(!v)return"";try{const[y,K]=v.split(":"),F=parseInt(y,10),Q=F>=12?"PM":"AM";return`${F%12||12}:${K} ${Q}`}catch(y){return console.warn("Error formatting time:",y),""}},f=`${h(i.startTime)} - ${h(i.endTime)}`;o&&r.append("id",o),r.append("title",i.title),r.append("place",i.place),r.append("eventType",i.eventType),r.append("eventDate",i.eventDate),r.append("timing",f);const g=i.highlights.filter(v=>v.trim()!=="");r.append("highlights",JSON.stringify(g.length>0?g:[""]));const W=o?`/admin/events/${o}`:"/admin/create-event",_=await H.post(W,r,{headers:{"Content-Type":"multipart/form-data"}});[200,201].includes(_.status)&&(x(o?"Event updated successfully!":"Event created successfully!"),u(!0),setTimeout(()=>b("/event"),2e3))}catch(r){console.error("Error saving event:",r),x(((a=(n=r.response)==null?void 0:n.data)==null?void 0:a.message)||`Failed to ${o?"update":"create"} event`),u(!0)}finally{D(!1)}};return M?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"80vh"},children:e.jsx(I,{animation:"border",variant:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(te,{title:o?"Edit Event":"Create Event"}),e.jsx(Y,{position:"top-end",className:"p-3",children:e.jsxs(C,{onClose:()=>u(!1),show:A,delay:3e3,autohide:!0,children:[e.jsx(C.Header,{children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(C.Body,{children:P})]})}),e.jsx($,{children:e.jsx(T,{xs:12,children:e.jsx(k,{children:e.jsx(L,{children:e.jsx(s,{onSubmit:J,children:e.jsxs($,{children:[e.jsxs(T,{lg:9,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Event Image (362x472)"}),e.jsx(s.Control,{type:"file",accept:"image/*",onChange:q}),e.jsx(s.Text,{className:"text-muted",children:o?"Upload new image to replace existing one":"Upload event image"})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"img-container",children:e.jsx(ee,{src:N,style:{height:400,width:"100%"},initialAspectRatio:R,aspectRatio:R,guides:!1,crop:B,ref:d,rotatable:!0,scalable:!0,zoomable:!0})}),e.jsx(k,{className:"mt-3",children:e.jsx(L,{children:e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsx(l,{variant:"outline-secondary",onClick:()=>{var t;return(t=d.current)==null?void 0:t.cropper.zoom(.1)},children:"Zoom In"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>{var t;return(t=d.current)==null?void 0:t.cropper.zoom(-.1)},children:"Zoom Out"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>{var t;return(t=d.current)==null?void 0:t.cropper.rotate(-45)},children:"Rotate Left"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>{var t;return(t=d.current)==null?void 0:t.cropper.rotate(45)},children:"Rotate Right"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>{var t;return(t=d.current)==null?void 0:t.cropper.reset()},children:"Reset"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>{var t;return(t=d.current)==null?void 0:t.cropper.clear()},children:"Clear"})]})})})]})]}),e.jsxs(T,{lg:3,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Event Title"}),e.jsx(s.Control,{type:"text",name:"title",value:i.title,onChange:m,placeholder:"Enter event title",required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Place"}),e.jsx(s.Control,{type:"text",name:"place",value:i.place,onChange:m,placeholder:"Enter event place",required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Event Type"}),e.jsxs(s.Control,{as:"select",name:"eventType",value:i.eventType,onChange:m,children:[e.jsx("option",{value:"",children:"Select event type"}),e.jsx("option",{value:"concert",children:"Concert"}),e.jsx("option",{value:"conference",children:"Conference"}),e.jsx("option",{value:"workshop",children:"Workshop"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Date"}),e.jsx(s.Control,{type:"date",name:"eventDate",value:i.eventDate,onChange:m,required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Start Time"}),e.jsx(s.Control,{type:"time",name:"startTime",value:i.startTime,onChange:m,required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"End Time"}),e.jsx(s.Control,{type:"time",name:"endTime",value:i.endTime,onChange:m,required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Highlights"}),i.highlights.map((t,n)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(s.Control,{type:"text",value:t,onChange:a=>Z(n,a.target.value),placeholder:`Highlight ${n+1}`}),e.jsx(l,{variant:"danger",className:"ms-2",onClick:()=>O(n),disabled:i.highlights.length===1,children:"Remove"})]},n)),e.jsx(l,{variant:"secondary",className:"w-100",onClick:z,children:"Add Highlight"})]}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsx(l,{variant:"primary",type:"submit",className:"mt-3",disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(I,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),o?" Updating...":" Creating..."]}):o?"Update Event":"Create Event"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>b("/event"),disabled:j,children:"Cancel"})]})]})]})})})})})})]})};export{Te as default};
