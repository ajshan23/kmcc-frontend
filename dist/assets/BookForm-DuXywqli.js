import{d as A,u as G,r as l,j as e,T as L,h as q,i as R}from"./index-oZOXagb6.js";import{a as f}from"./api-CQpZrRPq.js";import{P as $}from"./PageTitle-CDfmxWcc.js";import{l as _}from"./logo-sm-Bq_R7RX3.js";import{R as N}from"./Row-BRTb4Q3x.js";import{C as x}from"./Col-CliyWdof.js";import{C as U,a as H}from"./Card-CByQ_iKt.js";import{F as s}from"./Form-RlP0Rjz3.js";import{B as S}from"./Button-BjDVT7iL.js";import"./CardHeaderContext-DZwIQcmL.js";import"./divWithClassName-D5RmpbwJ.js";import"./FormCheck-Bhm0cQQY.js";import"./FormContext-Bl_nBIxk.js";import"./FormCheckInput-BXTlCTZ2.js";import"./ElementChildren-B0W_E0jD.js";import"./FormControl-7vMxEVbB.js";import"./FormLabel-Bo8_nfdL.js";import"./Button-B8bHFfcq.js";const ce=()=>{const{id:m}=A(),r=!!m,g=G(),[T,i]=l.useState(!1),[w,n]=l.useState(""),[p,j]=l.useState(""),[h,b]=l.useState(""),[v,C]=l.useState(""),[u,M]=l.useState(null),[y,k]=l.useState(null),[c,E]=l.useState(null),[B,d]=l.useState(!1),P=10*1024*1024,F=2*1024*1024;l.useEffect(()=>{r&&(async()=>{try{const t=await f.get(`/book/${m}`);if(t.status===200){const o=t.data.data;j(o.title||""),b(o.author||""),C(o.description||""),k(o.coverImage||null)}}catch(t){console.error("Error fetching book:",t),n("Failed to load book data"),i(!0)}})()},[m,r]);const I=a=>{const t=a.target.files[0];if(!t)return;if(!t.type.match("image.*")){n("Please select an image file"),i(!0),a.target.value="";return}if(t.size>F){n("Image file size must be less than 2MB"),i(!0),a.target.value="";return}M(t);const o=new FileReader;o.onload=()=>{k(o.result)},o.readAsDataURL(t)},D=a=>{const t=a.target.files[0];if(t){if(t.type!=="application/pdf"){n("Please select a PDF file"),i(!0),a.target.value="";return}if(t.size>P){n("PDF file size must be less than 10MB"),i(!0),a.target.value="";return}E(t)}},z=async a=>{if(a.preventDefault(),d(!0),!p||!h){n("Title and author are required"),i(!0),d(!1);return}if(!r&&(!u||!c)){n("Both cover image and PDF file are required"),i(!0),d(!1);return}if(u&&u.size>F){n("Image file size must be less than 2MB"),i(!0),d(!1);return}if(c&&c.size>P){n("PDF file size must be less than 10MB"),i(!0),d(!1);return}const t=new FormData;t.append("title",p),t.append("author",h),t.append("description",v),u&&t.append("coverImage",u),c&&t.append("pdf",c);try{let o;r?o=await f.put(`/book/${m}`,t,{headers:{"Content-Type":"multipart/form-data"}}):o=await f.post("/book",t,{headers:{"Content-Type":"multipart/form-data"}}),o.status===(r?200:201)&&(n(`Book ${r?"updated":"created"} successfully!`),i(!0),setTimeout(()=>{g("/book")},1500))}catch(o){console.error(`Error ${r?"updating":"creating"} book:`,o),n(`Failed to ${r?"update":"create"} book. Please try again.`),i(!0)}finally{d(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx($,{title:r?"Edit Book":"Add New Book"}),e.jsxs(L,{onClose:()=>i(!1),show:T,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(q,{children:[e.jsx("img",{src:_,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"KMCC"})]}),e.jsx(R,{children:w})]}),e.jsx(N,{children:e.jsx(x,{xs:12,children:e.jsx(U,{children:e.jsx(H,{children:e.jsxs(s,{onSubmit:z,children:[e.jsxs(N,{children:[e.jsxs(x,{md:6,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Title *"}),e.jsx(s.Control,{type:"text",value:p,onChange:a=>j(a.target.value),placeholder:"Enter book title",required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Author *"}),e.jsx(s.Control,{type:"text",value:h,onChange:a=>b(a.target.value),placeholder:"Enter author name",required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Description"}),e.jsx(s.Control,{as:"textarea",rows:3,value:v,onChange:a=>C(a.target.value),placeholder:"Enter book description"})]})]}),e.jsxs(x,{md:6,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsxs(s.Label,{children:["Cover Image ",!r&&"*"]}),e.jsx(s.Control,{type:"file",accept:"image/*",onChange:I,required:!r}),e.jsx(s.Text,{className:"text-muted",children:"Max size: 2MB (JPEG, PNG, etc.)"}),y&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{children:"Preview:"}),e.jsx("img",{src:y,alt:"Cover preview",style:{maxHeight:"200px"}})]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsxs(s.Label,{children:["PDF File ",!r&&"*"]}),e.jsx(s.Control,{type:"file",accept:"application/pdf",onChange:D,required:!r}),e.jsx(s.Text,{className:"text-muted",children:"Max size: 10MB"}),c&&e.jsx("div",{className:"mt-2",children:e.jsxs("p",{children:["Selected file: ",c.name]})})]})]})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-4",children:[e.jsx(S,{variant:"secondary",className:"me-2",onClick:()=>g("/book"),children:"Cancel"}),e.jsx(S,{variant:"primary",type:"submit",disabled:B,children:B?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),r?"Updating...":"Creating..."]}):r?"Update Book":"Add Book"})]})]})})})})})]})};export{ce as default};
