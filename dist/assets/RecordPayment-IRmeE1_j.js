import{d as R,u as T,r as n,j as e,T as g}from"./index-Dgt01rRE.js";import{a as S}from"./api-CQpZrRPq.js";import{S as v}from"./Spinner-BpPHWKE5.js";import{R as b,C as d}from"./Row-4Z9dirXZ.js";import{C}from"./Card-BG9Ed4zH.js";import{F as o}from"./Form-CB017dp8.js";import{B as w}from"./Button-B09RcjbQ.js";import"./CardHeaderContext-CackRrvh.js";import"./divWithClassName-BVSQMdwe.js";import"./FormCheck-D50FBt5F.js";import"./FormContext-Dopo7G1u.js";import"./ElementChildren-C09WryAM.js";import"./FormControl-0K0tugQX.js";import"./FormLabel-BH0-8cKa.js";import"./Button-jd7_BOcc.js";const H=()=>{var j;const{lotId:m}=R(),u=T(),[r,h]=n.useState(null),[p,x]=n.useState(!1),[P,c]=n.useState(!1),[L,y]=n.useState(""),[s,f]=n.useState({year:new Date().getFullYear(),month:"",isPaid:!0});n.useEffect(()=>{(async()=>{try{const a=await S.get(`/gold/lots/${m}`);h(a.data.data||null)}catch(a){console.error("Error fetching lot:",a),h(null)}})()},[m]);const I=async t=>{var a,i;if(t.preventDefault(),!(!s.month||!s.year)){x(!0);try{await S.post("/gold/payments",{lotId:m,year:parseInt(s.year),month:parseInt(s.month)}),y("Payment recorded successfully!"),c(!0),setTimeout(()=>u(-1),1500)}catch(l){y(((i=(a=l.response)==null?void 0:a.data)==null?void 0:i.message)||"Payment failed"),c(!0)}finally{x(!1)}}};return r?e.jsxs(b,{children:[e.jsx(d,{md:6,children:e.jsx(C,{children:e.jsxs(C.Body,{children:[e.jsxs("h5",{children:["Record Payment for ",((j=r==null?void 0:r.user)==null?void 0:j.name)||"Unknown User"]}),e.jsxs(o,{onSubmit:I,children:[e.jsxs(b,{children:[e.jsx(d,{children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Year"}),e.jsx(o.Control,{type:"number",min:2020,max:2099,value:s.year,onChange:t=>f({...s,year:t.target.value}),required:!0})]})}),e.jsx(d,{children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Month"}),e.jsxs(o.Select,{value:s.month,onChange:t=>f({...s,month:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select month..."}),Array.from({length:12},(t,a)=>a+1).map(t=>{var i;const a=(i=r==null?void 0:r.payments)==null?void 0:i.some(l=>l.month===t&&l.year===parseInt(s.year));return e.jsxs("option",{value:t,disabled:a,children:[new Date(0,t-1).toLocaleString("default",{month:"long"})," ",a?"(Paid)":""]},t)})]})]})})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(w,{variant:"secondary",onClick:()=>u(-1),children:"Cancel"}),e.jsx(w,{type:"submit",variant:"primary",disabled:p||!s.month||!s.year,children:p?e.jsx(v,{size:"sm"}):"Record Payment"})]})]})]})})}),e.jsx(g,{onClose:()=>c(!1),show:P,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(g.Body,{children:L})})]}):e.jsx(v,{animation:"border"})};export{H as default};
