import{d as K,u as O,r as l,j as e,T as E}from"./index-BCQ8XePc.js";import{a as p}from"./api-CQpZrRPq.js";import{P as Q}from"./PageTitle-Bqjq_xpf.js";import"./iconify-Sjb3qfcU.js";import{S as b}from"./Spinner-BNXt9rxS.js";import{R as L}from"./Row-CQj91pzA.js";import{C as v}from"./Col-BR9WNOn1.js";import{C as w}from"./Card-DBoZ8N4s.js";import{F as s}from"./Form-DOoTYhWU.js";import{B as h}from"./Button-DDbE0FWG.js";import{T as V}from"./Table-gVZHZr4U.js";import{B as W}from"./Badge-Bf-JSp8T.js";import{M as i}from"./Modal-BTZHy_Jc.js";import"./CardHeaderContext-DlD9yLXM.js";import"./divWithClassName-BsRS6Wb_.js";import"./FormCheck-B3j9whee.js";import"./FormContext-BhFHY_3_.js";import"./FormCheckInput-WVpR3VYM.js";import"./ElementChildren-CqgWmrA1.js";import"./FormControl-SqxqXHwE.js";import"./FormLabel-BuyplJ8N.js";import"./Button-D-jFX0tQ.js";import"./AbstractModalHeader-D4Cx9Y2h.js";import"./useWindow-DanGxOlB.js";import"./usePrevious-BphD9FTY.js";import"./useEventCallback-qFhElVO6.js";import"./hasClass-DANfkvs8.js";import"./useMergedRefs-D72rsyTi.js";import"./NoopTransition-BkakQPQj.js";import"./DataKey-COGXBUcQ.js";const Be=()=>{var B,M,N,F,I,k;const{lotId:x}=K(),$=O(),[d,g]=l.useState(null),[y,c]=l.useState(!1),[z,m]=l.useState(!1),[R,u]=l.useState(""),[A,f]=l.useState(!1),[T,G]=l.useState(null),[n,C]=l.useState(null),[H,P]=l.useState(!1),[o,S]=l.useState({year:new Date().getFullYear(),month:"",isPaid:!0});l.useEffect(()=>{(async()=>{try{c(!0);const a=await p.get(`/gold/lots/${x}`);g(a.data.data||null)}catch(a){console.error("Error fetching lot:",a),u("Failed to load lot data"),m(!0),g(null)}finally{c(!1)}})()},[x]);const Y=async t=>{var a,r;if(t.preventDefault(),!(!o.month||!o.year)){c(!0);try{await p.post("/gold/payments",{lotId:x,year:parseInt(o.year),month:parseInt(o.month)}),u("Payment recorded successfully!"),m(!0);const j=await p.get(`/gold/lots/${x}`);g(j.data.data),S({year:new Date().getFullYear(),month:"",isPaid:!0})}catch(j){u(((r=(a=j.response)==null?void 0:a.data)==null?void 0:r.message)||"Payment failed"),m(!0)}finally{c(!1)}}},U=t=>{C(t),P(!0)},q=async()=>{var t,a;if(n){c(!0);try{await p.put(`/gold/payments/${n.id}`,{year:parseInt(n.year),month:parseInt(n.month),isPaid:n.isPaid,lotId:n.lotId}),u("Payment updated successfully!"),m(!0),P(!1);const r=await p.get(`/gold/lots/${x}`);g(r.data.data)}catch(r){u(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update payment"),m(!0)}finally{c(!1)}}},_=t=>{G(t),f(!0)},J=async()=>{var t,a;if(T){c(!0);try{await p.delete(`/gold/payments/${T.id}`),u("Payment deleted successfully"),m(!0),f(!1);const r=await p.get(`/gold/lots/${x}`);g(r.data.data)}catch(r){u(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to delete payment"),m(!0)}finally{c(!1)}}},D=t=>new Date(0,t-1).toLocaleString("default",{month:"long"});return d?e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:`Payments - ${((B=d.user)==null?void 0:B.name)||"Unknown User"}`,breadcrumbItems:[{label:"Gold Programs",path:"/gold-programs"},{label:((M=d.program)==null?void 0:M.name)||"Program",path:`/gold-programs/${(N=d.program)==null?void 0:N.id}`},{label:"Lots",path:`/gold-programs/${(F=d.program)==null?void 0:F.id}/lots`},{label:"Payments",active:!0}]}),e.jsx(E,{onClose:()=>m(!1),show:z,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(E.Body,{children:R})}),e.jsxs(L,{children:[e.jsx(v,{md:6,children:e.jsx(w,{className:"mb-4",children:e.jsxs(w.Body,{children:[e.jsx("h5",{children:"Record New Payment"}),e.jsxs(s,{onSubmit:Y,children:[e.jsxs(L,{children:[e.jsx(v,{children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Year"}),e.jsx(s.Control,{type:"number",min:2020,max:2099,value:o.year,onChange:t=>S({...o,year:t.target.value}),required:!0})]})}),e.jsx(v,{children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Month"}),e.jsxs(s.Select,{value:o.month,onChange:t=>S({...o,month:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select month..."}),Array.from({length:12},(t,a)=>a+1).map(t=>{var r;const a=(r=d.payments)==null?void 0:r.some(j=>j.month===t&&j.year===parseInt(o.year));return e.jsxs("option",{value:t,disabled:a,children:[D(t)," ",a?"(Paid)":""]},t)})]})]})})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(h,{variant:"secondary",onClick:()=>$(-1),children:"Back"}),e.jsx(h,{type:"submit",variant:"primary",disabled:y||!o.month||!o.year,children:y?e.jsx(b,{size:"sm",animation:"border"}):"Record Payment"})]})]})]})})}),e.jsx(v,{md:6,children:e.jsx(w,{children:e.jsxs(w.Body,{children:[e.jsx("h5",{children:"Payment History"}),((I=d.payments)==null?void 0:I.length)===0?e.jsx("div",{className:"text-center py-4 text-muted",children:"No payments recorded yet"}):e.jsxs(V,{striped:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Year"}),e.jsx("th",{children:"Month"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:(k=d.payments)==null?void 0:k.sort((t,a)=>a.year-t.year||a.month-t.month).map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.year}),e.jsx("td",{children:D(t.month)}),e.jsx("td",{children:e.jsx(W,{bg:t.isPaid?"success":"warning",children:t.isPaid?"Paid":"Pending"})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(h,{variant:"primary",size:"sm",onClick:()=>U(t),disabled:y,children:"Edit"}),e.jsx(h,{variant:"danger",size:"sm",onClick:()=>_(t),disabled:y,children:"Delete"})]})})]},t.id))})]})]})})})]}),e.jsxs(i,{show:H,onHide:()=>P(!1),children:[e.jsx(i.Header,{closeButton:!0,children:e.jsx(i.Title,{children:"Edit Payment"})}),e.jsx(i.Body,{children:n&&e.jsxs(s,{children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Year"}),e.jsx(s.Control,{type:"number",value:n.year,onChange:t=>C({...n,year:t.target.value})})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Month"}),e.jsx(s.Select,{value:n.month,onChange:t=>C({...n,month:t.target.value}),children:Array.from({length:12},(t,a)=>a+1).map(t=>e.jsx("option",{value:t,children:D(t)},t))})]})]})}),e.jsxs(i.Footer,{children:[e.jsx(h,{variant:"secondary",onClick:()=>P(!1),children:"Cancel"}),e.jsx(h,{variant:"primary",onClick:q,children:y?e.jsx(b,{size:"sm",animation:"border"}):"Update Payment"})]})]}),e.jsxs(i,{show:A,onHide:()=>f(!1),centered:!0,children:[e.jsx(i.Header,{closeButton:!0,children:e.jsx(i.Title,{children:"Confirm Payment Deletion"})}),e.jsx(i.Body,{children:"Are you sure you want to delete this payment record? This action cannot be undone."}),e.jsxs(i.Footer,{children:[e.jsx(h,{variant:"secondary",onClick:()=>f(!1),children:"Cancel"}),e.jsx(h,{variant:"danger",onClick:J,children:y?e.jsx(b,{size:"sm",animation:"border"}):"Delete Payment"})]})]})]}):e.jsx("div",{className:"d-flex justify-content-center p-5",children:e.jsx(b,{animation:"border"})})};export{Be as default};
