import{d as S,u as C,r as l,j as t,T as f}from"./index-C4h4LeeC.js";import{a as h}from"./api-CQpZrRPq.js";import{P as F}from"./PageTitle-CWWablCN.js";import{I as N}from"./IconifyIcon-vDUfkHRu.js";import{R as T}from"./Row-q3Ki7zJR.js";import{C as $}from"./Col-DtQoyYva.js";import{C as g}from"./Card-C11WjSz1.js";import{A as w}from"./Alert-DGPhNwfj.js";import{F as a}from"./Form-D3LbNE2c.js";import{B as j}from"./Button-44QDA4_g.js";import{S as I}from"./Spinner-lRSxT0Gw.js";import"./iconify-Cb3atxOG.js";import"./CardHeaderContext-DEdCtnK_.js";import"./divWithClassName-D8tIs208.js";import"./hook-BbaAwkr-.js";import"./extends-CF3RwP-h.js";import"./Anchor-nZ7QxtTe.js";import"./useEventCallback-DBOd_9XM.js";import"./Button-BvvrbRIW.js";import"./FormCheck-kNP21EUQ.js";import"./FormContext-BAY9kC9G.js";import"./ElementChildren-CJn4I1Gs.js";import"./FormControl-BR82fO97.js";import"./FormLabel-CMWJChb4.js";const st=()=>{const{id:r}=S(),u=C(),[n,p]=l.useState(!1),[y,i]=l.useState(!1),[b,d]=l.useState(""),[e,v]=l.useState(null),[s,c]=l.useState({amount:"",notes:"",payoutDate:new Date().toISOString().split("T")[0]});l.useEffect(()=>{(async()=>{try{const m=await h.get(`/investments/${r}/profit-summary`);v(m.data.data)}catch{d("Failed to load profit data"),i(!0)}})()},[r]);const P=async o=>{var m,x;if(o.preventDefault(),!s.amount||parseFloat(s.amount)<=0){d("Please enter a valid payout amount"),i(!0);return}if(e&&parseFloat(s.amount)>e.profitPending){d("Payout amount exceeds available pending profit"),i(!0);return}p(!0);try{await h.post(`/investments/${r}/profit-payouts`,{amount:parseFloat(s.amount),notes:s.notes,payoutDate:s.payoutDate}),d("Profit payout recorded successfully!"),i(!0),setTimeout(()=>u(`/investments/${r}`),1500)}catch(D){d(((x=(m=D.response)==null?void 0:m.data)==null?void 0:x.message)||"Failed to record profit payout"),i(!0)}finally{p(!1)}};return t.jsxs(t.Fragment,{children:[t.jsx(F,{title:"Distribute Profit",breadcrumbItems:[{label:"Investments",path:"/investments"},{label:`Investment #${r}`,path:`/investments/${r}`},{label:"Distribute Profit",active:!0}]}),t.jsx(f,{onClose:()=>i(!1),show:y,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:t.jsx(f.Body,{children:b})}),t.jsx(T,{children:t.jsx($,{md:6,children:t.jsx(g,{children:t.jsxs(g.Body,{children:[e&&t.jsx(w,{variant:"info",className:"mb-4",children:t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsxs("span",{children:["Total Profit:"," ",t.jsxs("strong",{children:["$",e.totalProfit.toLocaleString()]})]}),t.jsxs("span",{children:["Pending:"," ",t.jsxs("strong",{children:["$",e.profitPending.toLocaleString()]})]}),t.jsxs("span",{children:["Distributed:"," ",t.jsxs("strong",{children:["$",e.profitDistributed.toLocaleString()]})]})]})}),t.jsxs(a,{onSubmit:P,children:[t.jsxs(a.Group,{className:"mb-3",children:[t.jsx(a.Label,{children:"Payout Amount*"}),t.jsx(a.Control,{type:"number",step:"0.01",placeholder:"Enter payout amount",value:s.amount,onChange:o=>c({...s,amount:o.target.value}),required:!0,disabled:n,max:(e==null?void 0:e.profitPending)||void 0}),t.jsxs(a.Text,{className:"text-muted",children:["Available: $",(e==null?void 0:e.profitPending.toLocaleString())||"0"]})]}),t.jsxs(a.Group,{className:"mb-3",children:[t.jsx(a.Label,{children:"Payout Date"}),t.jsx(a.Control,{type:"date",value:s.payoutDate,onChange:o=>c({...s,payoutDate:o.target.value}),disabled:n})]}),t.jsxs(a.Group,{className:"mb-3",children:[t.jsx(a.Label,{children:"Notes"}),t.jsx(a.Control,{as:"textarea",rows:3,placeholder:"Optional notes (e.g., 'Quarterly dividend')",value:s.notes,onChange:o=>c({...s,notes:o.target.value}),disabled:n})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx(j,{variant:"secondary",onClick:()=>u(`/investments/${r}`),disabled:n,children:"Cancel"}),t.jsx(j,{type:"submit",variant:"success",disabled:n||!s.amount||((e==null?void 0:e.profitPending)||0)<=0,children:n?t.jsxs(t.Fragment,{children:[t.jsx(I,{size:"sm",animation:"border",className:"me-2"}),"Processing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(N,{icon:"mdi:cash-check",className:"me-2"}),"Record Payout"]})})]})]})]})})})})]})};export{st as default};
