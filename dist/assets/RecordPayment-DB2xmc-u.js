import{d as R,u as T,r as n,j as e,T as g}from"./index-CfNT85tM.js";import{a as S}from"./api-BAouzzCb.js";import{S as v}from"./Spinner-DY2VvB9K.js";import{R as b,C as d}from"./Row-pUvplkm2.js";import{C}from"./Card-BxC9ygCX.js";import{F as o}from"./Form-BPTIrVzf.js";import{B as w}from"./Button-DmtmunvM.js";import"./CardBody-TiP-bp9B.js";import"./CardHeaderContext-DMh6jMut.js";import"./divWithClassName-MTQsKDs0.js";import"./FormCheck-DtwGqKiM.js";import"./FormContext-CAGAzZgQ.js";import"./ElementChildren-ShUlXlPu.js";import"./FormControl-dmhg-08h.js";import"./FormLabel-CoJ0DtNH.js";import"./Button-AVmPP0NH.js";const J=()=>{var j;const{lotId:m}=R(),u=T(),[a,h]=n.useState(null),[p,x]=n.useState(!1),[P,c]=n.useState(!1),[L,y]=n.useState(""),[s,f]=n.useState({year:new Date().getFullYear(),month:"",isPaid:!0});n.useEffect(()=>{(async()=>{try{const r=await S.get(`/gold/lots/${m}`);h(r.data.data||null)}catch(r){console.error("Error fetching lot:",r),h(null)}})()},[m]);const I=async t=>{var r,i;if(t.preventDefault(),!(!s.month||!s.year)){x(!0);try{await S.post("/gold/payments",{lotId:m,year:parseInt(s.year),month:parseInt(s.month)}),y("Payment recorded successfully!"),c(!0),setTimeout(()=>u(-1),1500)}catch(l){y(((i=(r=l.response)==null?void 0:r.data)==null?void 0:i.message)||"Payment failed"),c(!0)}finally{x(!1)}}};return a?e.jsxs(b,{children:[e.jsx(d,{md:6,children:e.jsx(C,{children:e.jsxs(C.Body,{children:[e.jsxs("h5",{children:["Record Payment for ",((j=a==null?void 0:a.user)==null?void 0:j.name)||"Unknown User"]}),e.jsxs(o,{onSubmit:I,children:[e.jsxs(b,{children:[e.jsx(d,{children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Year"}),e.jsx(o.Control,{type:"number",min:2020,max:2099,value:s.year,onChange:t=>f({...s,year:t.target.value}),required:!0})]})}),e.jsx(d,{children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Month"}),e.jsxs(o.Select,{value:s.month,onChange:t=>f({...s,month:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select month..."}),Array.from({length:12},(t,r)=>r+1).map(t=>{var i;const r=(i=a==null?void 0:a.payments)==null?void 0:i.some(l=>l.month===t&&l.year===parseInt(s.year));return e.jsxs("option",{value:t,disabled:r,children:[new Date(0,t-1).toLocaleString("default",{month:"long"})," ",r?"(Paid)":""]},t)})]})]})})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(w,{variant:"secondary",onClick:()=>u(-1),children:"Cancel"}),e.jsx(w,{type:"submit",variant:"primary",disabled:p||!s.month||!s.year,children:p?e.jsx(v,{size:"sm"}):"Record Payment"})]})]})]})})}),e.jsx(g,{onClose:()=>c(!1),show:P,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(g.Body,{children:L})})]}):e.jsx(v,{animation:"border"})};export{J as default};
