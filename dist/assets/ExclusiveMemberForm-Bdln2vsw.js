import{d as P,u as B,r as o,j as e,T as L,h as $,i as U}from"./index-BJxyWXw5.js";import{I as q}from"./IconifyIcon-Bpb1MxQc.js";import{a as g}from"./api-CQpZrRPq.js";import{P as D}from"./PageTitle-CrVvbIAm.js";import{l as G}from"./logo-sm-Bq_R7RX3.js";import{l as A}from"./cropper-ChHY76Yz.js";import{R as M}from"./Row-BL2JdXdK.js";import{C as f}from"./Col-DIvgp7I2.js";import{C as H,a as V}from"./Card-tfBEtDvx.js";import{F as i}from"./Form-BLdj2u0r.js";import{B as k}from"./Button-CGKBl0Dq.js";import"./iconify-COVW_57l.js";import"./CardHeaderContext-b-v_Bpfa.js";import"./divWithClassName-CjTg634B.js";import"./FormCheck-4d5nbpZp.js";import"./FormContext-BBj1yWmE.js";import"./FormCheckInput-CU4jHHca.js";import"./ElementChildren-DOv9weAN.js";import"./FormControl-wkAHHui1.js";import"./FormLabel-rV1PZXta.js";import"./Button-CctqLc8n.js";const pe=()=>{const{id:d}=P(),r=!!d,T=B(),[E,n]=o.useState(!1),[I,m]=o.useState(""),[z,l]=o.useState("success"),[h,x]=o.useState(null),[c,b]=o.useState(null),[p,j]=o.useState(""),[u,C]=o.useState(""),[y,w]=o.useState(!1),S=o.useRef(null),v=1;o.useEffect(()=>{r&&(async()=>{try{const t=await g.get(`/exclusive-members/${d}`);if(t.status===200){const a=t.data.data||t.data;j(a.name),C(a.position),a.image&&(x(a.image),b(a.image))}}catch(t){console.error("Error fetching member:",t),m("Failed to load member data."),l("danger"),n(!0)}})()},[d,r]);const N=s=>{const t=s.target.files[0];if(t){const a=new FileReader;a.onload=()=>x(a.result),a.readAsDataURL(t)}},F=()=>{var t;const s=(t=S.current)==null?void 0:t.cropper;s&&s.getCroppedCanvas().toBlob(a=>b(a))},R=async()=>{if(!p||!u){m("Please fill all required fields."),l("danger"),n(!0);return}if(!r&&!c){m("Please crop the image first."),l("danger"),n(!0);return}w(!0);const s=new FormData;c&&typeof c!="string"&&s.append("image",c,"member-image.png"),s.append("name",p),s.append("position",u);try{let t;if(r?t=await g.put(`/exclusive-members/${d}`,s,{headers:{"Content-Type":"multipart/form-data"}}):t=await g.post("/exclusive-members",s,{headers:{"Content-Type":"multipart/form-data"}}),t.status===(r?200:201))m(`Member ${r?"updated":"created"} successfully!`),l("success"),n(!0),setTimeout(()=>{T("/exclusive-members")},2e3);else throw new Error(`Failed to ${r?"update":"create"} member.`)}catch(t){console.error(`Error ${r?"updating":"creating"} member:`,t),m(`Failed to ${r?"update":"create"} member. Please try again.`),l("danger"),n(!0)}finally{w(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(D,{title:r?"Edit Member":"New Member"}),e.jsxs(L,{onClose:()=>n(!1),show:E,delay:2e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs($,{children:[e.jsx("img",{src:G,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsx(U,{children:I})]}),e.jsx(M,{children:e.jsx(f,{xs:12,children:e.jsx(H,{children:e.jsx(V,{children:e.jsxs(M,{children:[e.jsxs(f,{lg:6,children:[e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Upload Member Image (Square)"}),e.jsx(i.Control,{type:"file",accept:"image/*",onChange:N})]}),h&&e.jsx(A,{src:h,style:{height:400,width:"100%"},initialAspectRatio:v,aspectRatio:v,guides:!1,crop:F,ref:S})]}),e.jsxs(f,{lg:6,children:[e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Name"}),e.jsx(i.Control,{type:"text",value:p,onChange:s=>j(s.target.value),placeholder:"Enter member name",required:!0})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Position"}),e.jsx(i.Control,{type:"text",value:u,onChange:s=>C(s.target.value),placeholder:"Enter member position",required:!0})]}),e.jsx(k,{variant:"primary",className:"w-100 mt-3",onClick:R,disabled:y||!r&&!c,children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),r?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{icon:r?"mdi:pencil":"mdi:upload"}),r?" Update Member":" Create Member"]})})]})]})})})})})]})};export{pe as default};
