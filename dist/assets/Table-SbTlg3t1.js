import{r as o,u as K,j as e,T as U}from"./index-CWxK9h8P.js";import{P as J}from"./PageTitle-DWsonpDE.js";import{a as f}from"./api-CQpZrRPq.js";import{I as g}from"./IconifyIcon-CC4OnH-e.js";import{S as M}from"./Spinner-Dqj128jD.js";import{R as Q}from"./Row-C2I4GQ41.js";import{C as V}from"./Col-BXHEcCf6.js";import{C as W,a as X}from"./Card-DZFDkilJ.js";import{I as Y}from"./InputGroup-DryC4bgQ.js";import{F as Z}from"./FormControl-CAjNTUps.js";import{B as i}from"./Button-CQasjNBg.js";import{B as ee}from"./ButtonGroup-C0KhX05O.js";import{M as p}from"./Modal-BvhR9nwq.js";import"./iconify-BL2rH4cv.js";import"./CardHeaderContext-ijBDOs9Q.js";import"./divWithClassName-B3-UALgE.js";import"./FormCheckInput-DXPhqNpk.js";import"./FormContext-COJ5zA0n.js";import"./InputGroupContext-TO9uxNfI.js";import"./Button-Rbr09trj.js";import"./AbstractModalHeader-Dg8cC4yC.js";import"./useWindow-BSjvxul1.js";import"./usePrevious-f1lRgY9w.js";import"./useEventCallback-FbBVX3K_.js";import"./hasClass-Ce-Nhihp.js";import"./useMergedRefs-7j0TLQWM.js";import"./NoopTransition-N-W7GiHR.js";import"./DataKey-COGXBUcQ.js";const se="/assets/no-Ci1GeHlm.png",Ee=()=>{const[y,b]=o.useState([]),[C,v]=o.useState(""),[u,N]=o.useState(""),[a,c]=o.useState(1),[l,B]=o.useState(1),[x,S]=o.useState(null),[D,w]=o.useState(!1),[k,I]=o.useState(!1),P=K(),[F,m]=o.useState(!1),[L,h]=o.useState(""),[R,T]=o.useState(!1),A=async()=>{var s,r;try{w(!0);const t=await f.get("/admin/users",{params:{page:a,limit:10,search:u}});b(t.data.data.users),B(t.data.data.pagination.totalPages)}catch(t){console.error("Error fetching users:",t),h(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to fetch users"),m(!0)}finally{w(!1)}};o.useEffect(()=>{A()},[a,u]);const $=async()=>{var s,r;try{I(!0);const t=await f.get("/user/export",{responseType:"blob"}),d=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=d;const z=new Date().toISOString().split("T")[0];n.setAttribute("download",`kmcc_users_export_${z}.xlsx`),document.body.appendChild(n),n.click(),n.parentNode.removeChild(n),window.URL.revokeObjectURL(d),h("All users data exported successfully!"),m(!0)}catch(t){console.error("Error exporting users:",t),h(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to export users data"),m(!0)}finally{I(!1)}},E=()=>{N(C),c(1)},G=()=>{v(""),N(""),c(1)},H=s=>{S(s),T(!0)},j=()=>{T(!1),S(null)},O=async()=>{var s,r;if(x)try{await f.delete(`/admin/users/${x}`),b(t=>t.filter(d=>d.id!==x)),h("User deleted successfully!"),m(!0)}catch(t){console.error("Error deleting user:",t),h(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to delete user"),m(!0)}finally{j()}},_=(s,r)=>{r.stopPropagation(),P(`/users/${s}/edit`)},q=()=>{const s=[],r=e.jsx(i,{variant:"outline-primary",disabled:!0,children:"..."});if(l<=7)for(let t=1;t<=l;t++)s.push(e.jsx(i,{variant:t===a?"primary":"outline-primary",onClick:()=>c(t),children:t},t));else{s.push(e.jsx(i,{variant:a===1?"primary":"outline-primary",onClick:()=>c(1),children:"1"},1)),a>3&&s.push(r);let t=Math.max(2,a-1),d=Math.min(l-1,a+1);a<=3?d=4:a>=l-2&&(t=l-3);for(let n=t;n<=d;n++)s.push(e.jsx(i,{variant:n===a?"primary":"outline-primary",onClick:()=>c(n),children:n},n));a<l-2&&s.push(r),s.push(e.jsx(i,{variant:l===a?"primary":"outline-primary",onClick:()=>c(l),children:l},l))}return s};return D?e.jsx("div",{className:"d-flex justify-content-center p-5",children:e.jsx(M,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Users Table"}),e.jsx(U,{onClose:()=>m(!1),show:F,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(U.Body,{children:L})}),e.jsx(Q,{children:e.jsx(V,{xs:12,children:e.jsx(W,{children:e.jsxs(X,{children:[e.jsxs("div",{className:"d-flex justify-content-between mb-3",children:[e.jsxs(Y,{style:{width:"400px"},children:[e.jsx(Z,{placeholder:"Search users...",value:C,onChange:s=>v(s.target.value),onKeyPress:s=>{s.key==="Enter"&&E()}}),e.jsx(i,{variant:"outline-secondary",onClick:E,children:"Search"}),u&&e.jsx(i,{variant:"outline-danger",onClick:G,children:"Clear"})]}),e.jsx(i,{variant:"success",onClick:$,disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx(M,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{icon:"mdi:file-excel",className:"me-2"}),"Export to Excel"]})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Iqama Number"}),e.jsx("th",{children:"Member ID"}),e.jsx("th",{children:"Area name"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Profile"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:y.length>0?y.map(s=>e.jsxs("tr",{className:"align-middle",onClick:()=>P(`/users/${s.id}`),style:{cursor:"pointer"},children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:s.iqamaNumber}),e.jsx("td",{children:s.memberId}),e.jsx("td",{children:s.areaName}),e.jsx("td",{children:s.phoneNumber}),e.jsx("td",{children:s.profileImage?e.jsx("img",{src:`data:image/png;base64,${s.profileImage}`,alt:"Profile",className:"rounded-circle",width:"40",height:"40"}):e.jsx("img",{src:se,alt:"Profile",className:"rounded-circle",width:"40",height:"40"})}),e.jsxs("td",{children:[e.jsx(i,{variant:"primary",className:"me-2",onClick:r=>_(s.id,r),children:e.jsx(g,{icon:"mdi:pencil"})}),e.jsx(i,{variant:"danger",onClick:r=>{r.stopPropagation(),H(s.id)},children:e.jsx(g,{icon:"ri:delete-bin-4-fill"})})]})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center",children:"No users found"})})})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx(i,{variant:"primary",disabled:a<=1,onClick:()=>c(s=>s-1),children:"Previous"}),e.jsx(ee,{className:"mx-2",children:q()}),e.jsx(i,{variant:"primary",disabled:a>=l,onClick:()=>c(s=>s+1),children:"Next"})]})]})})})}),e.jsxs(p,{show:R,onHide:j,centered:!0,children:[e.jsx(p.Header,{closeButton:!0,children:e.jsx(p.Title,{children:"Delete User"})}),e.jsx(p.Body,{children:"Are you sure you want to delete this user? This action cannot be undone."}),e.jsxs(p.Footer,{children:[e.jsx(i,{variant:"secondary",onClick:j,children:"Cancel"}),e.jsx(i,{variant:"danger",onClick:O,children:"Delete"})]})]})]})};export{Ee as default};
