import{d as me,u as ue,r as n,j as e,T as he,h as je,i as ge}from"./index-BCQ8XePc.js";import{l as xe}from"./cropper-DNo2TXcW.js";import{I as c}from"./IconifyIcon-jB5K9-96.js";import{a as q}from"./api-CQpZrRPq.js";import{P as be}from"./PageTitle-Bqjq_xpf.js";import{l as fe}from"./logo-sm-Bq_R7RX3.js";import{R as W}from"./Row-CQj91pzA.js";import{C as P}from"./Col-BR9WNOn1.js";import{C as Q,a as V}from"./Card-DBoZ8N4s.js";import{F as o}from"./Form-DOoTYhWU.js";import{B as l}from"./Button-DDbE0FWG.js";import"./iconify-Sjb3qfcU.js";import"./CardHeaderContext-DlD9yLXM.js";import"./divWithClassName-BsRS6Wb_.js";import"./FormCheck-B3j9whee.js";import"./FormContext-BhFHY_3_.js";import"./FormCheckInput-WVpR3VYM.js";import"./ElementChildren-CqgWmrA1.js";import"./FormControl-SqxqXHwE.js";import"./FormLabel-BuyplJ8N.js";import"./Button-D-jFX0tQ.js";const Me=()=>{const{id:b}=me(),r=!!b,X=ue(),[Y,m]=n.useState(!1),[ee,j]=n.useState(""),[G,O]=n.useState(null),[f,D]=n.useState(null),[F,H]=n.useState(""),[k,M]=n.useState(""),[w,$]=n.useState(""),[J,A]=n.useState(""),[T,K]=n.useState(""),[B,U]=n.useState(""),[u,C]=n.useState([""]),[h,y]=n.useState([""]),[d,v]=n.useState([{heading:"",description:""}]),[I,z]=n.useState(!1),[L,_]=n.useState(!1),g=["Medical","Time Off","Flexible Hours","Remote Work","Bonuses"],[N,R]=n.useState(g),p=n.useRef(null),Z=200/200;n.useEffect(()=>{r&&(async()=>{var t;try{const a=await q.get(`/jobs/${b}`);if(a.status===200){const i=a.data.data||a.data;H(i.companyName||""),M(i.position||""),$(i.jobMode||""),A(i.salary?i.salary.toString():""),K(i.place||""),U(i.jobDescription||""),C(i.keyResponsibilities||[""]),y(i.requirements||[""]),v(i.benefits||[{heading:"",description:""}]),_(i.isClosed||!1),i.logo&&(O(i.logo),D(i.logo));const S=((t=i.benefits)==null?void 0:t.map(x=>x.heading))||[];R(g.filter(x=>!S.includes(x)))}}catch(a){console.error("Error fetching job:",a),j("Failed to load job data."),m(!0)}})()},[b,r]);const se=s=>{const t=s.target.files[0];if(t){const a=new FileReader;a.onload=()=>{O(a.result)},a.readAsDataURL(t)}},te=()=>{var t;const s=(t=p.current)==null?void 0:t.cropper;s&&s.getCroppedCanvas().toBlob(a=>{D(a)})},ae=()=>{C([...u,""])},oe=s=>{const t=u.filter((a,i)=>i!==s);C(t)},ie=(s,t)=>{const a=[...u];a[s]=t,C(a)},ne=()=>{y([...h,""])},re=s=>{const t=h.filter((a,i)=>i!==s);y(t)},le=(s,t)=>{const a=[...h];a[s]=t,y(a)},ce=()=>{v([...d,{heading:"",description:""}])},de=s=>{const t=d[s];v(d.filter((a,i)=>i!==s)),g.includes(t.heading)&&R([...N,t.heading])},E=(s,t,a)=>{const i=[...d],S=i[s].heading;i[s]={...i[s],[t]:a},t==="heading"&&(g.includes(S)&&R([...N,S]),g.includes(a)&&R(N.filter(x=>x!==a))),v(i)},pe=async()=>{if(!f&&!r){j("Please upload and crop the image first."),m(!0);return}if(!F||!k||!w||!J||!T||!B||u.length===0||h.length===0||d.length===0){j("Please fill all required fields."),m(!0);return}z(!0);const s=new FormData;f&&typeof f!="string"&&s.append("logo",f,"job-logo.png"),s.append("companyName",F),s.append("position",k),s.append("jobMode",w),s.append("salary",J),s.append("place",T),s.append("jobDescription",B),s.append("isClosed",L.toString()),s.append("keyResponsibilities",JSON.stringify(u.filter(t=>t.trim()!==""))),s.append("requirements",JSON.stringify(h.filter(t=>t.trim()!==""))),s.append("benefits",JSON.stringify(d.filter(t=>t.heading.trim()!==""||t.description.trim()!=="")));try{let t;r?t=await q.put(`/jobs/${b}`,s,{headers:{"Content-Type":"multipart/form-data"}}):t=await q.post("/jobs/create",s,{headers:{"Content-Type":"multipart/form-data"}}),t.status===(r?200:201)?(j(`Job ${r?"updated":"created"} successfully!`),m(!0),setTimeout(()=>{X("/job")},2e3)):(j(`Failed to ${r?"update":"create"} job.`),m(!0))}catch(t){console.error(`Error ${r?"updating":"creating"} job:`,t),j(`Failed to ${r?"update":"create"} job. Please try again.`),m(!0)}finally{z(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(be,{title:r?"Edit Job":"New Job"}),e.jsxs(he,{onClose:()=>m(!1),show:Y,delay:2e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(je,{children:[e.jsx("img",{src:fe,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsx(ge,{children:ee})]}),e.jsx(W,{children:e.jsx(P,{xs:12,children:e.jsx(Q,{children:e.jsx(V,{children:e.jsxs(W,{children:[e.jsxs(P,{lg:9,children:[e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Upload Job Logo (200x200)"}),e.jsx(o.Control,{type:"file",accept:"image/*",onChange:se})]}),G&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"img-container",children:e.jsx(xe,{src:G,style:{height:400,width:"100%"},initialAspectRatio:Z,aspectRatio:Z,guides:!1,crop:te,ref:p,rotatable:!0,scalable:!0,zoomable:!0})}),e.jsx(Q,{children:e.jsx(V,{children:e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsxs(l,{onClick:()=>{var s;return(s=p.current)==null?void 0:s.cropper.zoom(.1)},children:[e.jsx(c,{icon:"mdi:magnify-plus-outline"})," ","Zoom In"]}),e.jsxs(l,{onClick:()=>{var s;return(s=p.current)==null?void 0:s.cropper.zoom(-.1)},children:[e.jsx(c,{icon:"mdi:magnify-minus-outline"})," ","Zoom Out"]}),e.jsxs(l,{onClick:()=>{var s;return(s=p.current)==null?void 0:s.cropper.rotate(-45)},children:[e.jsx(c,{icon:"mdi:rotate-left"})," Rotate Left"]}),e.jsxs(l,{onClick:()=>{var s;return(s=p.current)==null?void 0:s.cropper.rotate(45)},children:[e.jsx(c,{icon:"mdi:rotate-right"})," Rotate Right"]}),e.jsxs(l,{onClick:()=>{var s;return(s=p.current)==null?void 0:s.cropper.reset()},children:[e.jsx(c,{icon:"mdi:sync"})," Reset"]}),e.jsxs(l,{onClick:()=>{var s;return(s=p.current)==null?void 0:s.cropper.clear()},children:[e.jsx(c,{icon:"mdi:close"})," Clear"]})]})})})]})]}),e.jsxs(P,{lg:3,children:[e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Company Name"}),e.jsx(o.Control,{type:"text",value:F,onChange:s=>H(s.target.value),placeholder:"Enter company name"})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Position"}),e.jsx(o.Control,{type:"text",value:k,onChange:s=>M(s.target.value),placeholder:"Enter position"})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Job Mode"}),e.jsxs(o.Control,{as:"select",value:w,onChange:s=>$(s.target.value),children:[e.jsx("option",{value:"",children:"Select job mode"}),e.jsx("option",{value:"Full-Time",children:"Full Time"}),e.jsx("option",{value:"Part-Time",children:"Part Time"}),e.jsx("option",{value:"Freelance",children:"Freelance"}),e.jsx("option",{value:"Internship",children:"Internship"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Salary"}),e.jsx(o.Control,{type:"text",value:J,onChange:s=>A(s.target.value),placeholder:"Enter salary"})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Place"}),e.jsx(o.Control,{type:"text",value:T,onChange:s=>K(s.target.value),placeholder:"Enter place"})]}),r&&e.jsx(o.Group,{className:"mb-3",children:e.jsx(o.Check,{type:"switch",id:"job-status-switch",label:L?"Job is Closed":"Job is Open",checked:L,onChange:s=>_(s.target.checked),disabled:I})}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Job Description"}),e.jsx(o.Control,{as:"textarea",rows:3,value:B,onChange:s=>U(s.target.value),placeholder:"Enter job description"})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Key Responsibilities"}),u.map((s,t)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(o.Control,{type:"text",value:s,onChange:a=>ie(t,a.target.value),placeholder:`Responsibility ${t+1}`}),e.jsx(l,{variant:"danger",className:"ms-2",onClick:()=>oe(t),disabled:u.length===1,children:e.jsx(c,{icon:"mdi:delete"})})]},t)),e.jsxs(l,{variant:"secondary",className:"w-100",onClick:ae,children:[e.jsx(c,{icon:"mdi:plus"})," Add Responsibility"]})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Requirements"}),h.map((s,t)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(o.Control,{type:"text",value:s,onChange:a=>le(t,a.target.value),placeholder:`Requirement ${t+1}`}),e.jsx(l,{variant:"danger",className:"ms-2",onClick:()=>re(t),disabled:h.length===1,children:e.jsx(c,{icon:"mdi:delete"})})]},t)),e.jsxs(l,{variant:"secondary",className:"w-100",onClick:ne,children:[e.jsx(c,{icon:"mdi:plus"})," Add Requirement"]})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Benefits"}),d.map((s,t)=>e.jsxs("div",{className:"mb-2 p-2 border rounded",children:[e.jsxs(o.Control,{as:"select",value:s.heading,onChange:a=>E(t,"heading",a.target.value),className:"mb-2",children:[e.jsx("option",{value:"",children:"Select a benefit"}),N.map(a=>e.jsx("option",{value:a,children:a},a)),e.jsx("option",{value:"Other",children:"Other"})]}),s.heading==="Other"&&e.jsx(o.Control,{type:"text",value:s.description,onChange:a=>E(t,"heading",a.target.value),placeholder:"Enter custom benefit name",className:"mb-2"}),e.jsx(o.Control,{as:"textarea",rows:2,value:s.description,onChange:a=>E(t,"description",a.target.value),placeholder:"Benefit Description",className:"mb-2"}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(l,{variant:"danger",onClick:()=>de(t),disabled:d.length===1,children:e.jsx(c,{icon:"mdi:delete"})})})]},t)),e.jsxs(l,{variant:"secondary",className:"w-100 mt-2",onClick:ce,children:[e.jsx(c,{icon:"mdi:plus"})," Add Benefit"]})]}),e.jsx(l,{variant:"primary",className:"w-100 mt-3",onClick:pe,disabled:I,children:I?r?"Updating...":"Creating...":r?"Update Job":"Create Job"})]})]})})})})})]})};export{Me as default};
