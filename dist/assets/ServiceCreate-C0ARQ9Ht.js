import{d as W,u as J,r,j as e,T as K,h as Q,i as V}from"./index-Bk3vKcFm.js";import{l as X}from"./cropper-gzP2ppDS.js";import{I as l}from"./IconifyIcon-BmM1FoR_.js";import{a as f}from"./api-CQpZrRPq.js";import{P as Y}from"./PageTitle-DFrWf-CA.js";import{l as _}from"./logo-sm-Bq_R7RX3.js";import{R as M}from"./Row-DsFnQgll.js";import{C as y}from"./Col-B9Ck3_nO.js";import{C as G,a as P}from"./Card-CJZGyBPV.js";import{F as s}from"./Form-Bzdko2cR.js";import{B as o}from"./Button-B73yjmLp.js";import{S as ee}from"./Spinner-fXcKpI-J.js";import"./iconify-D1qMnGbo.js";import"./CardHeaderContext-B-uaTyk9.js";import"./divWithClassName-BPCtmpC6.js";import"./FormCheck-CsRjdK0N.js";import"./FormContext-CNaV4sQv.js";import"./ElementChildren-YcFq_s7N.js";import"./FormControl-B2brg_VZ.js";import"./FormLabel-m1CrgOky.js";import"./Button-KCNyPJY1.js";const Ce=()=>{const{id:p}=W(),b=J(),[z,c]=r.useState(!1),[A,m]=r.useState(""),[C,u]=r.useState(!1),[d,B]=r.useState(!1),[S,T]=r.useState(null),[N,U]=r.useState(null),[h,w]=r.useState(""),[x,E]=r.useState(""),[F,I]=r.useState(""),[g,R]=r.useState(""),[j,L]=r.useState(""),[v,D]=r.useState("Mon-Fri"),i=r.useRef(null),k=123/137,$=[{label:"Monday to Friday",value:"Mon-Fri"},{label:"Monday to Saturday",value:"Mon-Sat"},{label:"Everyday",value:"Everyday"},{label:"Custom",value:"Custom"}];r.useEffect(()=>{p&&(B(!0),H())},[p]);const H=async()=>{try{u(!0);const a=(await f.get(`/services/${p}`)).data.data;w(a.title),E(a.location),I(a.phoneNumber),R(a.startingTime),L(a.stoppingTime),D(a.availableDays),a.image&&T(a.image)}catch(t){console.error("Error fetching service:",t),m("Failed to load service data"),c(!0)}finally{u(!1)}},O=t=>{const a=t.target.files[0];if(!a)return;if(!a.type.startsWith("image/")){m("Please upload a valid image file."),c(!0);return}const n=new FileReader;n.onload=()=>{T(n.result)},n.readAsDataURL(a)},Z=()=>{var a;const t=(a=i.current)==null?void 0:a.cropper;t&&t.getCroppedCanvas().toBlob(n=>{U(n)})},q=async()=>{if(!h||!x||!g||!j||!v){m("Please fill all required fields."),c(!0);return}u(!0);const t=new FormData;if(t.append("title",h),t.append("location",x),t.append("startingTime",g),t.append("stoppingTime",j),t.append("availableDays",v),t.append("phoneNumber",F),N){const a=`service-image-${Date.now()}.png`,n=new File([N],a,{type:"image/png"});t.append("image",n)}try{let a;d?a=await f.put(`/services/${p}`,t,{headers:{"Content-Type":"multipart/form-data"}}):a=await f.post("/services/new",t,{headers:{"Content-Type":"multipart/form-data"}}),(a.status===200||a.status===201)&&(m(d?"Service updated successfully!":"Service created successfully!"),c(!0),setTimeout(()=>{b("/service")},2e3))}catch(a){console.error("Error saving service:",a),m(d?"Failed to update service.":"Failed to create service."),c(!0)}finally{u(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:d?"Edit Service":"New Service"}),e.jsxs(K,{onClose:()=>c(!1),show:z,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(Q,{children:[e.jsx("img",{src:_,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsx(V,{children:A})]}),e.jsx(M,{children:e.jsx(y,{xs:12,children:e.jsx(G,{children:e.jsx(P,{children:e.jsxs(M,{children:[e.jsxs(y,{lg:9,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Service Image (123x137)"}),e.jsx(s.Control,{type:"file",accept:"image/*",onChange:O})]}),S&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"img-container",children:e.jsx(X,{src:S,style:{height:400,width:"100%"},initialAspectRatio:k,aspectRatio:k,guides:!1,crop:Z,ref:i,rotatable:!0,scalable:!0,zoomable:!0})}),e.jsx(G,{children:e.jsx(P,{children:e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsxs(o,{onClick:()=>{var t;return(t=i.current)==null?void 0:t.cropper.zoom(.1)},children:[e.jsx(l,{icon:"mdi:magnify-plus-outline"})," ","Zoom In"]}),e.jsxs(o,{onClick:()=>{var t;return(t=i.current)==null?void 0:t.cropper.zoom(-.1)},children:[e.jsx(l,{icon:"mdi:magnify-minus-outline"})," ","Zoom Out"]}),e.jsxs(o,{onClick:()=>{var t;return(t=i.current)==null?void 0:t.cropper.rotate(-45)},children:[e.jsx(l,{icon:"mdi:rotate-left"})," Rotate Left"]}),e.jsxs(o,{onClick:()=>{var t;return(t=i.current)==null?void 0:t.cropper.rotate(45)},children:[e.jsx(l,{icon:"mdi:rotate-right"})," Rotate Right"]}),e.jsxs(o,{onClick:()=>{var t;return(t=i.current)==null?void 0:t.cropper.reset()},children:[e.jsx(l,{icon:"mdi:sync"})," Reset"]}),e.jsxs(o,{onClick:()=>{var t;return(t=i.current)==null?void 0:t.cropper.clear()},children:[e.jsx(l,{icon:"mdi:close"})," Clear"]})]})})})]})]}),e.jsxs(y,{lg:3,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Service Title*"}),e.jsx(s.Control,{type:"text",value:h,onChange:t=>w(t.target.value),placeholder:"Enter service title"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Location*"}),e.jsx(s.Control,{type:"text",value:x,onChange:t=>E(t.target.value),placeholder:"Enter service location"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Start Time*"}),e.jsx(s.Control,{type:"time",value:g,onChange:t=>R(t.target.value)})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"End Time*"}),e.jsx(s.Control,{type:"time",value:j,onChange:t=>L(t.target.value)})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Available Days*"}),e.jsx(s.Select,{value:v,onChange:t=>D(t.target.value),children:$.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Phone Number"}),e.jsx(s.Control,{type:"tel",value:F,onChange:t=>I(t.target.value),placeholder:"Enter phone number"})]}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(o,{variant:"primary",onClick:q,disabled:C,children:[C?e.jsx(ee,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}):e.jsx(l,{icon:d?"mdi:content-save":"mdi:plus",className:"me-2"}),d?"Update Service":"Create Service"]}),e.jsx(o,{variant:"outline-secondary",onClick:()=>b("/service"),children:"Cancel"})]})]})]})})})})})]})};export{Ce as default};
