import{d as P,u as B,r as o,j as e,T as L,h as $,i as U}from"./index-Cn09gsNl.js";import{I as q}from"./IconifyIcon-BDVt2DYe.js";import{a as g}from"./api-CQpZrRPq.js";import{P as D}from"./PageTitle-Dp3XCP60.js";import{l as G}from"./logo-sm-Bq_R7RX3.js";import{l as A}from"./cropper-pT-upsZA.js";import{R as M,C as h}from"./Row-CcQ6My7F.js";import{C as H,a as V}from"./Card-zwmOuaDT.js";import{F as i}from"./Form-CExGpHyB.js";import{B as k}from"./Button-BjcV9GFW.js";import"./iconify-B4OyD1eu.js";import"./CardHeaderContext-D2zIXosm.js";import"./divWithClassName-j2Oiz3n5.js";import"./FormCheck-u_m6iOoB.js";import"./FormContext-D6aHCO0L.js";import"./ElementChildren-eSepHtHd.js";import"./FormControl-COgqCl2h.js";import"./FormLabel-C0eFGsMt.js";import"./Button-CteYpcFc.js";const ce=()=>{const{id:d}=P(),a=!!d,T=B(),[E,n]=o.useState(!1),[I,m]=o.useState(""),[z,l]=o.useState("success"),[f,x]=o.useState(null),[c,b]=o.useState(null),[p,j]=o.useState(""),[u,C]=o.useState(""),[y,w]=o.useState(!1),S=o.useRef(null),v=1;o.useEffect(()=>{a&&(async()=>{try{const t=await g.get(`/exclusive-members/${d}`);if(t.status===200){const r=t.data.data||t.data;j(r.name),C(r.position),r.image&&(x(r.image),b(r.image))}}catch(t){console.error("Error fetching member:",t),m("Failed to load member data."),l("danger"),n(!0)}})()},[d,a]);const N=s=>{const t=s.target.files[0];if(t){const r=new FileReader;r.onload=()=>x(r.result),r.readAsDataURL(t)}},F=()=>{var t;const s=(t=S.current)==null?void 0:t.cropper;s&&s.getCroppedCanvas().toBlob(r=>b(r))},R=async()=>{if(!p||!u){m("Please fill all required fields."),l("danger"),n(!0);return}if(!a&&!c){m("Please crop the image first."),l("danger"),n(!0);return}w(!0);const s=new FormData;c&&typeof c!="string"&&s.append("image",c,"member-image.png"),s.append("name",p),s.append("position",u);try{let t;if(a?t=await g.put(`/exclusive-members/${d}`,s,{headers:{"Content-Type":"multipart/form-data"}}):t=await g.post("/exclusive-members",s,{headers:{"Content-Type":"multipart/form-data"}}),t.status===(a?200:201))m(`Member ${a?"updated":"created"} successfully!`),l("success"),n(!0),setTimeout(()=>{T("/exclusive-members")},2e3);else throw new Error(`Failed to ${a?"update":"create"} member.`)}catch(t){console.error(`Error ${a?"updating":"creating"} member:`,t),m(`Failed to ${a?"update":"create"} member. Please try again.`),l("danger"),n(!0)}finally{w(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(D,{title:a?"Edit Member":"New Member"}),e.jsxs(L,{onClose:()=>n(!1),show:E,delay:2e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs($,{children:[e.jsx("img",{src:G,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsx(U,{children:I})]}),e.jsx(M,{children:e.jsx(h,{xs:12,children:e.jsx(H,{children:e.jsx(V,{children:e.jsxs(M,{children:[e.jsxs(h,{lg:6,children:[e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Upload Member Image (Square)"}),e.jsx(i.Control,{type:"file",accept:"image/*",onChange:N})]}),f&&e.jsx(A,{src:f,style:{height:400,width:"100%"},initialAspectRatio:v,aspectRatio:v,guides:!1,crop:F,ref:S})]}),e.jsxs(h,{lg:6,children:[e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Name"}),e.jsx(i.Control,{type:"text",value:p,onChange:s=>j(s.target.value),placeholder:"Enter member name",required:!0})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Position"}),e.jsx(i.Control,{type:"text",value:u,onChange:s=>C(s.target.value),placeholder:"Enter member position",required:!0})]}),e.jsx(k,{variant:"primary",className:"w-100 mt-3",onClick:R,disabled:y||!a&&!c,children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),a?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{icon:a?"mdi:pencil":"mdi:upload"}),a?" Update Member":" Create Member"]})})]})]})})})})})]})};export{ce as default};
