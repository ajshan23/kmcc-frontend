import{d as R,u as T,r as n,j as e,T as g}from"./index-Bk3vKcFm.js";import{a as S}from"./api-CQpZrRPq.js";import{S as v}from"./Spinner-fXcKpI-J.js";import{R as b}from"./Row-DsFnQgll.js";import{C as d}from"./Col-B9Ck3_nO.js";import{C}from"./Card-CJZGyBPV.js";import{F as o}from"./Form-Bzdko2cR.js";import{B as w}from"./Button-B73yjmLp.js";import"./CardHeaderContext-B-uaTyk9.js";import"./divWithClassName-BPCtmpC6.js";import"./FormCheck-CsRjdK0N.js";import"./FormContext-CNaV4sQv.js";import"./ElementChildren-YcFq_s7N.js";import"./FormControl-B2brg_VZ.js";import"./FormLabel-m1CrgOky.js";import"./Button-KCNyPJY1.js";const J=()=>{var j;const{lotId:m}=R(),u=T(),[a,h]=n.useState(null),[p,x]=n.useState(!1),[P,c]=n.useState(!1),[L,y]=n.useState(""),[r,f]=n.useState({year:new Date().getFullYear(),month:"",isPaid:!0});n.useEffect(()=>{(async()=>{try{const s=await S.get(`/gold/lots/${m}`);h(s.data.data||null)}catch(s){console.error("Error fetching lot:",s),h(null)}})()},[m]);const I=async t=>{var s,i;if(t.preventDefault(),!(!r.month||!r.year)){x(!0);try{await S.post("/gold/payments",{lotId:m,year:parseInt(r.year),month:parseInt(r.month)}),y("Payment recorded successfully!"),c(!0),setTimeout(()=>u(-1),1500)}catch(l){y(((i=(s=l.response)==null?void 0:s.data)==null?void 0:i.message)||"Payment failed"),c(!0)}finally{x(!1)}}};return a?e.jsxs(b,{children:[e.jsx(d,{md:6,children:e.jsx(C,{children:e.jsxs(C.Body,{children:[e.jsxs("h5",{children:["Record Payment for ",((j=a==null?void 0:a.user)==null?void 0:j.name)||"Unknown User"]}),e.jsxs(o,{onSubmit:I,children:[e.jsxs(b,{children:[e.jsx(d,{children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Year"}),e.jsx(o.Control,{type:"number",min:2020,max:2099,value:r.year,onChange:t=>f({...r,year:t.target.value}),required:!0})]})}),e.jsx(d,{children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Month"}),e.jsxs(o.Select,{value:r.month,onChange:t=>f({...r,month:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select month..."}),Array.from({length:12},(t,s)=>s+1).map(t=>{var i;const s=(i=a==null?void 0:a.payments)==null?void 0:i.some(l=>l.month===t&&l.year===parseInt(r.year));return e.jsxs("option",{value:t,disabled:s,children:[new Date(0,t-1).toLocaleString("default",{month:"long"})," ",s?"(Paid)":""]},t)})]})]})})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(w,{variant:"secondary",onClick:()=>u(-1),children:"Cancel"}),e.jsx(w,{type:"submit",variant:"primary",disabled:p||!r.month||!r.year,children:p?e.jsx(v,{size:"sm"}):"Record Payment"})]})]})]})})}),e.jsx(g,{onClose:()=>c(!1),show:P,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(g.Body,{children:L})})]}):e.jsx(v,{animation:"border"})};export{J as default};
