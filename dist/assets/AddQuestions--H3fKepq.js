import{a as A,f as B,r as l,j as e,T as U,g as X,h as Y}from"./index-DPuNUjLg.js";import{l as z}from"./cropper-MwML4X9w.js";import{I as r}from"./IconifyIcon-CRmgpD-A.js";import{a as G}from"./api-alN533tX.js";import{P as H}from"./PageTitle-CqWn3q0T.js";import{l as P}from"./logo-sm-DeRMNujR.js";import{R as v,C as x}from"./Row-CcHO1i0D.js";import{C as b}from"./Card-BZ6UHl2I.js";import{C as N}from"./CardBody-CGT1fL4u.js";import{F as a}from"./Form-LPEeaXcj.js";import{B as i}from"./Button-BnjsKorX.js";import"./iconify-CwHMartp.js";import"./CardHeaderContext-DMcAJQTf.js";import"./divWithClassName-CR8nEuA8.js";import"./FormCheck-KaS-eO03.js";import"./FormContext-BlvwWdud.js";import"./ElementChildren-ChJp8XjW.js";import"./FormControl-bLwLOBBO.js";import"./FormLabel-B_CILb4g.js";import"./Button-CXwj5S0n.js";const he=()=>{const g=A(),{id:m}=B();m||g("/survey");const[R,j]=l.useState(!1),[f,T]=l.useState(null),[_,w]=l.useState({cropX:0,cropY:0,imageWidth:0,imageHeight:0,imageRotate:0,scaleX:0,scaleY:0}),[h,I]=l.useState(null),[C,S]=l.useState(""),[d,F]=l.useState("text"),[p,u]=l.useState([""]),n=l.useRef(null),y=400/400,O=t=>{const o=t.target.files[0];if(o){const s=new FileReader;s.onload=()=>{T(s.result)},s.readAsDataURL(o)}},k=()=>{var o;const t=(o=n.current)==null?void 0:o.cropper;if(t){const s=t.getData(),c=t.getImageData();w({cropX:Math.ceil(s.x),cropY:Math.ceil(s.y),imageWidth:Math.ceil(c.width),imageHeight:Math.ceil(c.height),imageRotate:Math.ceil(c.rotate),scaleX:Math.ceil(c.scaleX),scaleY:Math.ceil(c.scaleY)}),t.getCroppedCanvas().toBlob(L=>{I(L)})}},M=()=>{u([...p,""])},D=t=>{const o=p.filter((s,c)=>c!==t);u(o)},Q=(t,o)=>{const s=[...p];s[t]=o,u(s)},E=async()=>{if(!h){alert("Please crop the image first.");return}const t=new File([h],"banner-image.png",{type:"image/png"}),o=new FormData;o.append("surveyId",m),o.append("image",t),o.append("text",C),o.append("type",d),d==="multiple_choice"&&o.append("options",JSON.stringify(p.filter(s=>s.trim()!=="")));for(let s of o.entries())console.log(s[0],s[1]);try{const s=await G.post("/survey/question",o,{headers:{"Content-Type":"multipart/form-data"}});console.log(s),s.status===200?(j(!0),setTimeout(()=>{g(`/questions/${m}`)},2e3)):(alert("Failed to upload banner."),console.error("Upload failed:",s.data))}catch(s){console.error("Error uploading banner:",s),alert("Failed to upload banner.")}};return e.jsxs(e.Fragment,{children:[e.jsx(H,{title:"New Questions"}),e.jsxs(U,{onClose:()=>j(!1),show:R,delay:2e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(X,{children:[e.jsx("img",{src:P,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsx(Y,{children:"Question created successfully."})]}),e.jsx(v,{children:e.jsx(x,{xs:12,children:e.jsx(b,{children:e.jsx(N,{children:e.jsxs(v,{children:[e.jsxs(x,{lg:9,children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Upload Event Image (400x400)"}),e.jsx(a.Control,{type:"file",accept:"image/*",onChange:O})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"img-container",children:e.jsx(z,{src:f,style:{height:400,width:"100%"},initialAspectRatio:y,aspectRatio:y,guides:!1,crop:k,ref:n,rotatable:!0,scalable:!0,zoomable:!0})}),e.jsx(b,{children:e.jsx(N,{children:e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsxs(i,{onClick:()=>{var t;return(t=n.current)==null?void 0:t.cropper.zoom(.1)},children:[e.jsx(r,{icon:"mdi:magnify-plus-outline"})," Zoom In"]}),e.jsxs(i,{onClick:()=>{var t;return(t=n.current)==null?void 0:t.cropper.zoom(-.1)},children:[e.jsx(r,{icon:"mdi:magnify-minus-outline"})," Zoom Out"]}),e.jsxs(i,{onClick:()=>{var t;return(t=n.current)==null?void 0:t.cropper.rotate(-45)},children:[e.jsx(r,{icon:"mdi:rotate-left"})," Rotate Left"]}),e.jsxs(i,{onClick:()=>{var t;return(t=n.current)==null?void 0:t.cropper.rotate(45)},children:[e.jsx(r,{icon:"mdi:rotate-right"})," Rotate Right"]}),e.jsxs(i,{onClick:()=>{var t;return(t=n.current)==null?void 0:t.cropper.reset()},children:[e.jsx(r,{icon:"mdi:sync"})," Reset"]}),e.jsxs(i,{onClick:()=>{var t;return(t=n.current)==null?void 0:t.cropper.clear()},children:[e.jsx(r,{icon:"mdi:close"})," Clear"]})]})})})]})]}),e.jsxs(x,{lg:3,children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Question Text"}),e.jsx(a.Control,{type:"text",value:C,onChange:t=>S(t.target.value),placeholder:"Enter question"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Question Type"}),e.jsxs(a.Control,{as:"select",value:d,onChange:t=>F(t.target.value),children:[e.jsx("option",{value:"",children:"Select Question Type"}),e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"multiple_choice",children:"Multiple Choice"})]})]}),d==="multiple_choice"&&e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Options"}),p.map((t,o)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(a.Control,{type:"text",value:t,onChange:s=>Q(o,s.target.value),placeholder:`Option ${o+1}`}),e.jsx(i,{variant:"danger",className:"ms-2",onClick:()=>D(o),children:e.jsx(r,{icon:"mdi:delete"})})]},o)),e.jsxs(i,{variant:"secondary",className:"w-100",onClick:M,disabled:p.length===4,children:[e.jsx(r,{icon:"mdi:plus"})," Add Options"]})]}),e.jsxs(i,{variant:"primary",className:"w-100 mt-3",onClick:E,disabled:!h,children:[e.jsx(r,{icon:"mdi:upload"})," Create Question"]})]})]})})})})})]})};export{he as default};
