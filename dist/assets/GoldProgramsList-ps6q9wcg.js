import{r,u as E,j as e,T as B,h as L,i as M,L as k}from"./index-D9C8xGDJ.js";import{a as f}from"./api-CQpZrRPq.js";import{P as A}from"./PageTitle-CTV_nOCB.js";import{I as c}from"./IconifyIcon-B_FaLXx1.js";import{l as I}from"./logo-sm-Bq_R7RX3.js";import{M as n}from"./Modal-CL_CNIw1.js";import{B as o}from"./Button-jzwfO54I.js";import{R as v,C as y}from"./Row-DNXGtDaS.js";import{C as R,a as G}from"./Card-Bg5eLJtX.js";import{T as z}from"./Table-Bjq8m4ox.js";import{B as F}from"./Badge-lUxFseza.js";import"./iconify-D7I9lgUj.js";import"./AbstractModalHeader-B0m5d8Cx.js";import"./useWindow-B79ER2bB.js";import"./usePrevious-DlNrynkd.js";import"./useEventCallback-CSjVCyuo.js";import"./hasClass-DiruUP4K.js";import"./useMergedRefs-ChISKg02.js";import"./NoopTransition-CoSkVbwQ.js";import"./DataKey-COGXBUcQ.js";import"./divWithClassName-2VyLv_7K.js";import"./Button-_Yz-NvGp.js";import"./CardHeaderContext-B6CePyy5.js";const ce=()=>{const[h,w]=r.useState([]),[C,i]=r.useState(!1),[l,P]=r.useState(null),[S,d]=r.useState(!1),[T,m]=r.useState(""),[H,x]=r.useState(!1),[a,g]=r.useState({page:1,limit:10,total:0}),N=E(),j=async()=>{x(!0);try{const s=await f.get("/gold/all",{params:{page:a.page,limit:a.limit}});w(s.data.data),g(t=>({...t,total:s.data.data.length}))}catch(s){console.error("Error fetching programs:",s),m("Failed to load programs"),d(!0)}finally{x(!1)}};r.useEffect(()=>{j()},[a.page]);const b=async()=>{var s,t;try{await f.post("/gold/end",{programId:l.id}),m("Program ended successfully"),d(!0),i(!1),j()}catch(u){console.error("Error ending program:",u),m(((t=(s=u.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to end program"),d(!0),i(!1)}},p=s=>{g(t=>({...t,page:s}))},D=s=>{P(s),i(!0)};return e.jsxs("div",{className:"p-4",children:[e.jsx(A,{title:"Gold Investment Programs"}),e.jsxs(n,{show:C,onHide:()=>i(!1),centered:!0,children:[e.jsx(n.Header,{closeButton:!0,children:e.jsx(n.Title,{children:"Confirm Program Termination"})}),e.jsxs(n.Body,{children:['Are you sure you want to end the program "',l==null?void 0:l.name,'"?',e.jsx("br",{}),e.jsx("br",{}),"This action cannot be undone and will prevent any further investments in this program."]}),e.jsxs(n.Footer,{children:[e.jsx(o,{variant:"secondary",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(o,{variant:"danger",onClick:b,children:[e.jsx(c,{icon:"mdi:stop"})," End Program"]})]})]}),e.jsxs(B,{onClose:()=>d(!1),show:S,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(L,{children:[e.jsx("img",{src:I,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"GOLD PROGRAM"})]}),e.jsx(M,{children:T})]}),e.jsx(v,{className:"mb-3",children:e.jsx(y,{children:e.jsxs(o,{as:k,to:"/gold-programs/new",variant:"primary",children:[e.jsx(c,{icon:"mdi:plus"})," Start New Program"]})})}),e.jsx(v,{children:e.jsx(y,{xs:12,children:e.jsx(R,{children:e.jsxs(G,{children:[e.jsxs(z,{striped:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Start Date"}),e.jsx("th",{children:"End Date"}),e.jsx("th",{children:"Lots"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:h.map(s=>{var t;return e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:e.jsx(F,{bg:s.isActive?"success":"secondary",children:s.isActive?"Active":"Ended"})}),e.jsx("td",{children:new Date(s.startDate).toLocaleDateString()}),e.jsx("td",{children:s.endDate?new Date(s.endDate).toLocaleDateString():"-"}),e.jsx("td",{children:((t=s._count)==null?void 0:t.lots)||0}),e.jsxs("td",{children:[e.jsx(o,{size:"sm",variant:"info",className:"me-2",onClick:()=>N(`/gold-programs/${s.id}`),children:e.jsx(c,{icon:"mdi:eye"})}),s.isActive&&e.jsx(o,{size:"sm",variant:"warning",className:"me-2",onClick:()=>D(s),children:e.jsx(c,{icon:"mdi:stop"})})]})]},s.id)})})]}),e.jsxs("div",{className:"d-flex justify-content-center mt-3",children:[e.jsx(o,{variant:"light",disabled:a.page===1,onClick:()=>p(a.page-1),children:"Previous"}),e.jsxs("span",{className:"mx-3 align-self-center",children:["Page ",a.page]}),e.jsx(o,{variant:"light",disabled:h.length<a.limit,onClick:()=>p(a.page+1),children:"Next"})]})]})})})})]})};export{ce as default};
