import{r as i,j as e,d as L,T as D,h as F,i as E,L as P}from"./index-DZiXj8TR.js";import{P as W}from"./PageTitle-DsU_ZpA0.js";import{a as N}from"./api-CQpZrRPq.js";import{I as B}from"./IconifyIcon-BSqbF420.js";import{l as $}from"./logo-sm-Bq_R7RX3.js";import"./iconify-DkiI8ZpJ.js";import{l as H}from"./cropper-BFtYBArb.js";import{F as c}from"./Form-BpKd490-.js";import{R as k,C as u}from"./Row-DDbPR_EX.js";import{F as R}from"./FormControl-CYWbfcub.js";import{C as m,a as K}from"./Card-CSmnExEW.js";import{B as g}from"./Button-BxiFzc-j.js";import{B as U}from"./Badge-DgCqRV9z.js";import{T as q}from"./Tabs-CUIWexGs.js";import{T as I}from"./Tab-qGH6-ve6.js";import{T as A}from"./Table-Czl1FK6p.js";import{M as v}from"./Modal-ChJSFphM.js";import"./FormCheck-uCRPbm19.js";import"./FormContext-52DUx_Tc.js";import"./ElementChildren-UnnKUi4O.js";import"./FormLabel-DPx4Bcny.js";import"./CardHeaderContext-DtkFU5Q_.js";import"./divWithClassName-BB-OH6fM.js";import"./Button-DamFSoRp.js";import"./hook-MPOcAf8c.js";import"./extends-CF3RwP-h.js";import"./TabPane-BPWXHvG3.js";import"./Nav-C2B51wBn.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-C7EJ00b9.js";import"./useMergedRefs-ILVE0x2e.js";import"./NavItem-B1DhH6As.js";import"./useEventCallback-DiaRCx7D.js";import"./NavbarContext-Bd8vwGWc.js";import"./NavLink-D4tHfdxU.js";import"./Anchor-DT6C7PiC.js";import"./NoopTransition-Dwcwa9hD.js";import"./AbstractModalHeader-sbZb8sd5.js";import"./useWindow-Dx4OKNd1.js";import"./usePrevious-CCglwABf.js";import"./hasClass-D1G-Uolt.js";const z=({subWingId:n,onSuccess:r,onCancel:w})=>{const[o,p]=i.useState(""),[j,b]=i.useState(""),[f,l]=i.useState(null),[h,x]=i.useState(null),[y,d]=i.useState(!1),C=i.useRef(null),S=s=>{const t=s.target.files[0];if(t){const a=new FileReader;a.onload=()=>{l(a.result)},a.readAsDataURL(t)}},M=()=>{var t;const s=(t=C.current)==null?void 0:t.cropper;s&&s.getCroppedCanvas().toBlob(a=>{x(a)})},T=async s=>{if(s.preventDefault(),d(!0),!o||!j){alert("Name and position are required"),d(!1);return}const t=new FormData;t.append("name",o),t.append("position",j),h&&t.append("image",h,"member.jpg");try{const a=await N.post(`/sub-wing/${n}/members`,t,{headers:{"Content-Type":"multipart/form-data"}});a.status===201&&r(a.data.data)}catch(a){console.error("Error adding member:",a),alert("Failed to add member")}finally{d(!1)}};return e.jsxs(c,{onSubmit:T,children:[e.jsxs(k,{children:[e.jsxs(u,{md:6,children:[e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Member Name"}),e.jsx(R,{type:"text",value:o,onChange:s=>p(s.target.value),placeholder:"Enter member name",required:!0})]}),e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Position"}),e.jsx(R,{type:"text",value:j,onChange:s=>b(s.target.value),placeholder:"Enter position",required:!0})]})]}),e.jsxs(u,{md:6,children:[e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Member Image (163x231 recommended)"}),e.jsx(R,{type:"file",accept:"image/*",onChange:S})]}),f&&e.jsx(m,{className:"mb-3",children:e.jsx(K,{children:e.jsx(H,{src:f,style:{height:400,width:"100%"},initialAspectRatio:163/231,aspectRatio:163/231,guides:!1,crop:M,ref:C})})}),h&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Cropped Preview:"}),e.jsx("img",{src:URL.createObjectURL(h),alt:"Cropped preview",style:{maxHeight:"200px"}})]})]})]}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(g,{variant:"secondary",className:"me-2",onClick:w,children:"Cancel"}),e.jsx(g,{variant:"primary",type:"submit",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Adding..."]}):"Add Member"})]})]})},Ae=()=>{const{subWingId:n}=L(),[r,w]=i.useState(null),[o,p]=i.useState([]),[j,b]=i.useState(!0),[f,l]=i.useState(!1),[h,x]=i.useState(""),[y,d]=i.useState(!1),[C,S]=i.useState("details");i.useEffect(()=>{(async()=>{try{b(!0);const[t,a]=await Promise.all([N.get(`/sub-wing/${n}`),N.get(`/sub-wing/${n}/members`)]);w(t.data.data),p(a.data.data)}catch(t){console.error("Error fetching sub-wing details:",t),x("Failed to load sub-wing details"),l(!0)}finally{b(!1)}})()},[n]);const M=s=>{p([...o,s]),d(!1),x("Member added successfully"),l(!0)},T=async s=>{try{await N.delete(`/sub-wing/${n}/members/${s}`),p(o.filter(t=>t.id!==s)),x("Member deleted successfully"),l(!0)}catch(t){console.error("Error deleting member:",t),x("Failed to delete member"),l(!0)}};return j?e.jsx("div",{className:"d-flex justify-content-center p-5",children:"Loading..."}):r?e.jsxs("div",{className:"d-flex p-4",children:[e.jsx(W,{title:"Sub-Wing Details"}),e.jsxs(D,{onClose:()=>l(!1),show:f,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(F,{children:[e.jsx("img",{src:$,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"KMCC"})]}),e.jsx(E,{children:h})]}),e.jsx(k,{className:"w-100",children:e.jsx(u,{xs:12,children:e.jsx(m,{children:e.jsxs(m.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("h4",{children:[r.name," Sub-Wing",e.jsxs(U,{bg:"primary",className:"ms-2",children:[o.length," Members"]})]}),e.jsxs("div",{children:[e.jsxs(g,{variant:"primary",className:"me-2",as:P,to:`/sub-wing/edit/${n}`,children:[e.jsx(B,{icon:"mdi:pencil",className:"me-1"}),"Edit"]}),e.jsxs(g,{variant:"success",onClick:()=>d(!0),children:[e.jsx(B,{icon:"mdi:plus",className:"me-1"}),"Add Member"]})]})]}),e.jsxs(q,{activeKey:C,onSelect:s=>S(s),className:"mb-3",children:[e.jsx(I,{eventKey:"details",title:"Details",children:e.jsxs(k,{className:"mt-3",children:[e.jsx(u,{md:4,children:e.jsx(m,{children:e.jsxs(m.Body,{className:"text-center",children:[r.icon?e.jsx("img",{src:r.icon,alt:r.name,style:{height:"150px",marginBottom:"20px"}}):e.jsx("div",{style:{height:"150px",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"20px"},children:e.jsx("span",{className:"text-muted",children:"No icon"})}),e.jsx("h5",{children:"Color Scheme"}),e.jsxs("div",{className:"d-flex justify-content-center gap-3 mb-3",children:[e.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:r.backgroundColor,border:"1px solid #ddd"},title:`Background: ${r.backgroundColor}`}),e.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:r.mainColor,border:"1px solid #ddd"},title:`Main color: ${r.mainColor}`})]})]})})}),e.jsx(u,{md:8,children:e.jsx(m,{children:e.jsxs(m.Body,{children:[e.jsx("h5",{children:"Sub-Wing Information"}),e.jsx(A,{bordered:!0,children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("td",{children:r.name})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Background Color"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{style:{width:"20px",height:"20px",backgroundColor:r.backgroundColor,marginRight:"10px",border:"1px solid #ddd"}}),r.backgroundColor]})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Main Color"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{style:{width:"20px",height:"20px",backgroundColor:r.mainColor,marginRight:"10px",border:"1px solid #ddd"}}),r.mainColor]})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Created At"}),e.jsx("td",{children:new Date(r.createdAt).toLocaleString()})]})]})})]})})})]})}),e.jsx(I,{eventKey:"members",title:"Members",children:e.jsx("div",{className:"mt-3",children:e.jsxs(A,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Position"}),e.jsx("th",{children:"Image"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:o.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.position}),e.jsx("td",{children:s.image?e.jsx("img",{src:s.image,alt:s.name,style:{height:"50px"}}):e.jsx("span",{className:"text-muted",children:"No image"})}),e.jsx("td",{children:e.jsx(g,{variant:"danger",size:"sm",onClick:()=>T(s.id),children:e.jsx(B,{icon:"mdi:delete",color:"white"})})})]},s.id))})]})})})]})]})})})}),e.jsxs(v,{show:y,onHide:()=>d(!1),size:"lg",children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:"Add New Member"})}),e.jsx(v.Body,{children:e.jsx(z,{subWingId:n,onSuccess:M,onCancel:()=>d(!1)})})]})]}):e.jsx("div",{className:"d-flex justify-content-center p-5",children:"Sub-wing not found"})};export{Ae as default};
