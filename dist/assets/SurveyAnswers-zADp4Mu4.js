import{d as I,r as n,j as e,T as U,h as k,i as L}from"./index-CWxK9h8P.js";import{P as O}from"./PageTitle-DWsonpDE.js";import{a as u}from"./api-CQpZrRPq.js";import"./iconify-BL2rH4cv.js";import{l as P}from"./logo-sm-Bq_R7RX3.js";import{C as Q}from"./Container-B61nTpwK.js";import{C as o}from"./Card-DZFDkilJ.js";import{B as p}from"./Badge-BJiw47KL.js";import{B as q}from"./Button-CQasjNBg.js";import{R as F}from"./Row-C2I4GQ41.js";import{C as j}from"./Col-BXHEcCf6.js";import{A as d}from"./Accordion-l2i2vNPx.js";import{T as y}from"./Table-DywIZmfJ.js";import"./CardHeaderContext-ijBDOs9Q.js";import"./divWithClassName-B3-UALgE.js";import"./Button-Rbr09trj.js";import"./hook-DSKMHYPi.js";import"./extends-CF3RwP-h.js";import"./Collapse-BP8qShFx.js";import"./createChainedFunction-Vh3cVaa6.js";const ie=()=>{const{surveyId:a}=I(),[f,w]=n.useState({}),[b,g]=n.useState([]),[i,v]=n.useState(null),[S,T]=n.useState(0),[N,l]=n.useState(""),[A,c]=n.useState(!1),[m,C]=n.useState(null),[h,x]=n.useState(!1);n.useEffect(()=>{a&&E()},[a]);const E=async()=>{try{const s=await u.get(`/survey/answers/${a}`);if(s.status===200){const t=s.data.data;v(t.survey),w(t.answers),g(t.statistics),T(t.totalRespondents)}}catch(s){console.error("Error fetching survey answers:",s),l("Failed to fetch survey answers"),c(!0)}},R=async()=>{if(a){x(!0);try{const s=await u.get(`/survey/export/${a}`,{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([s.data])),r=document.createElement("a");r.href=t,r.setAttribute("download",`survey_${a}_answers.xlsx`),document.body.appendChild(r),r.click(),r.parentNode.removeChild(r),window.URL.revokeObjectURL(t),l("Export started successfully"),c(!0)}catch(s){console.error("Error exporting survey answers:",s),l("Failed to export survey answers"),c(!0)}finally{x(!1)}}},B=s=>{C(m===s?null:s)};return e.jsxs(Q,{className:"p-4",children:[e.jsx(O,{title:"Survey Answers"}),e.jsxs(U,{onClose:()=>c(!1),show:A,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(k,{children:[e.jsx("img",{src:P,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsx(L,{children:N})]}),i&&e.jsx(o,{className:"mb-4",children:e.jsxs(o.Body,{children:[e.jsx(o.Title,{children:i.title}),e.jsx(o.Subtitle,{className:"mb-2 text-muted",children:i.description}),e.jsxs("div",{className:"d-flex justify-content-between mt-3",children:[e.jsxs("div",{children:[e.jsxs(p,{bg:"primary",className:"me-2",children:["Questions: ",i.questions.length]}),e.jsxs(p,{bg:"success",children:["Respondents: ",S]})]}),e.jsx(q,{variant:"outline-primary",onClick:R,disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Exporting..."]}):"Export Answers"})]})]})}),e.jsxs(F,{children:[e.jsxs(j,{xs:12,md:6,children:[e.jsx("h4",{className:"mb-3",children:"Individual Responses"}),e.jsx(d,{activeKey:m,children:Object.entries(f).map(([s,t])=>e.jsxs(d.Item,{eventKey:s,children:[e.jsxs(d.Header,{onClick:()=>B(s),children:[t.user.name," (",t.user.memberId,")"]}),e.jsx(d.Body,{children:e.jsxs(y,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Question"}),e.jsx("th",{children:"Answer"})]})}),e.jsx("tbody",{children:i==null?void 0:i.questions.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.text}),e.jsx("td",{children:t.answers[r.id]||"Not answered"})]},r.id))})]})})]},s))})]}),e.jsxs(j,{xs:12,md:6,children:[e.jsx("h4",{className:"mb-3",children:"Question Statistics"}),b.map(s=>e.jsx(o,{className:"mb-3",children:e.jsxs(o.Body,{children:[e.jsx(o.Title,{children:s.questionText}),e.jsxs(o.Subtitle,{className:"mb-2 text-muted",children:["Total answers: ",s.totalAnswers]}),e.jsxs(y,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Option"}),e.jsx("th",{children:"Count"}),e.jsx("th",{children:"Percentage"})]})}),e.jsx("tbody",{children:s.options.map((t,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.option}),e.jsx("td",{children:t.count}),e.jsxs("td",{children:[t.percentage,"%"]})]},r))})]})]})},s.questionId))]})]})]})};export{ie as default};
