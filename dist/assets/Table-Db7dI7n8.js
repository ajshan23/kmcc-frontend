import{r as a,u as G,j as e,T as U}from"./index-BCQ8XePc.js";import{P as K}from"./PageTitle-Bqjq_xpf.js";import{a as j}from"./api-CQpZrRPq.js";import{I as f}from"./IconifyIcon-jB5K9-96.js";import{S as D}from"./Spinner-BNXt9rxS.js";import{R as J}from"./Row-CQj91pzA.js";import{C as Q}from"./Col-BR9WNOn1.js";import{C as V,a as W}from"./Card-DBoZ8N4s.js";import{I as X}from"./InputGroup-yIYUHlq6.js";import{F as Y}from"./FormControl-SqxqXHwE.js";import{B as n}from"./Button-DDbE0FWG.js";import{M as d}from"./Modal-BTZHy_Jc.js";import"./iconify-Sjb3qfcU.js";import"./CardHeaderContext-DlD9yLXM.js";import"./divWithClassName-BsRS6Wb_.js";import"./FormCheckInput-WVpR3VYM.js";import"./FormContext-BhFHY_3_.js";import"./InputGroupContext-Dbjifzko.js";import"./Button-D-jFX0tQ.js";import"./AbstractModalHeader-D4Cx9Y2h.js";import"./useWindow-DanGxOlB.js";import"./usePrevious-BphD9FTY.js";import"./useEventCallback-qFhElVO6.js";import"./hasClass-DANfkvs8.js";import"./useMergedRefs-D72rsyTi.js";import"./NoopTransition-BkakQPQj.js";import"./DataKey-COGXBUcQ.js";const Z="/assets/no-Ci1GeHlm.png",Ie=()=>{const[g,y]=a.useState([]),[b,C]=a.useState(""),[x,S]=a.useState(""),[l,h]=a.useState(1),[w,F]=a.useState(1),[p,N]=a.useState(null),[M,v]=a.useState(!1),[k,I]=a.useState(!1),P=G(),[B,o]=a.useState(!1),[L,c]=a.useState(""),[R,T]=a.useState(!1),A=async()=>{var s,r;try{v(!0);const t=await j.get("/admin/users",{params:{page:l,limit:10,search:x}});y(t.data.data.users),F(t.data.data.pagination.totalPages)}catch(t){console.error("Error fetching users:",t),c(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to fetch users"),o(!0)}finally{v(!1)}};a.useEffect(()=>{A()},[l,x]);const $=async()=>{var s,r;try{I(!0);const t=await j.get("/user/export",{responseType:"blob"}),m=window.URL.createObjectURL(new Blob([t.data])),i=document.createElement("a");i.href=m;const z=new Date().toISOString().split("T")[0];i.setAttribute("download",`kmcc_users_export_${z}.xlsx`),document.body.appendChild(i),i.click(),i.parentNode.removeChild(i),window.URL.revokeObjectURL(m),c("All users data exported successfully!"),o(!0)}catch(t){console.error("Error exporting users:",t),c(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to export users data"),o(!0)}finally{I(!1)}},E=()=>{S(b),h(1)},H=()=>{C(""),S(""),h(1)},O=s=>{N(s),T(!0)},u=()=>{T(!1),N(null)},_=async()=>{var s,r;if(p)try{await j.delete(`/admin/users/${p}`),y(t=>t.filter(m=>m.id!==p)),c("User deleted successfully!"),o(!0)}catch(t){console.error("Error deleting user:",t),c(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to delete user"),o(!0)}finally{u()}},q=(s,r)=>{r.stopPropagation(),P(`/users/${s}/edit`)};return M?e.jsx("div",{className:"d-flex justify-content-center p-5",children:e.jsx(D,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(K,{title:"Users Table"}),e.jsx(U,{onClose:()=>o(!1),show:B,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(U.Body,{children:L})}),e.jsx(J,{children:e.jsx(Q,{xs:12,children:e.jsx(V,{children:e.jsxs(W,{children:[e.jsxs("div",{className:"d-flex justify-content-between mb-3",children:[e.jsxs(X,{style:{width:"400px"},children:[e.jsx(Y,{placeholder:"Search users...",value:b,onChange:s=>C(s.target.value),onKeyPress:s=>{s.key==="Enter"&&E()}}),e.jsx(n,{variant:"outline-secondary",onClick:E,children:"Search"}),x&&e.jsx(n,{variant:"outline-danger",onClick:H,children:"Clear"})]}),e.jsx(n,{variant:"success",onClick:$,disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx(D,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{icon:"mdi:file-excel",className:"me-2"}),"Export to Excel"]})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Iqama Number"}),e.jsx("th",{children:"Member ID"}),e.jsx("th",{children:"Area name"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Profile"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:g.length>0?g.map(s=>e.jsxs("tr",{className:"align-middle",onClick:()=>P(`/users/${s.id}`),style:{cursor:"pointer"},children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:s.iqamaNumber}),e.jsx("td",{children:s.memberId}),e.jsx("td",{children:s.areaName}),e.jsx("td",{children:s.phoneNumber}),e.jsx("td",{children:s.profileImage?e.jsx("img",{src:`data:image/png;base64,${s.profileImage}`,alt:"Profile",className:"rounded-circle",width:"40",height:"40"}):e.jsx("img",{src:Z,alt:"Profile",className:"rounded-circle",width:"40",height:"40"})}),e.jsxs("td",{children:[e.jsx(n,{variant:"primary",className:"me-2",onClick:r=>q(s.id,r),children:e.jsx(f,{icon:"mdi:pencil"})}),e.jsx(n,{variant:"danger",onClick:r=>{r.stopPropagation(),O(s.id)},children:e.jsx(f,{icon:"ri:delete-bin-4-fill"})})]})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center",children:"No users found"})})})]})}),e.jsxs("div",{className:"d-flex justify-content-between mt-3",children:[e.jsx(n,{variant:"primary",disabled:l<=1,onClick:()=>h(s=>s-1),children:"Previous"}),e.jsxs("span",{children:["Page ",l," of ",w]}),e.jsx(n,{variant:"primary",disabled:l>=w,onClick:()=>h(s=>s+1),children:"Next"})]})]})})})}),e.jsxs(d,{show:R,onHide:u,centered:!0,children:[e.jsx(d.Header,{closeButton:!0,children:e.jsx(d.Title,{children:"Delete User"})}),e.jsx(d.Body,{children:"Are you sure you want to delete this user? This action cannot be undone."}),e.jsxs(d.Footer,{children:[e.jsx(n,{variant:"secondary",onClick:u,children:"Cancel"}),e.jsx(n,{variant:"danger",onClick:_,children:"Delete"})]})]})]})};export{Ie as default};
