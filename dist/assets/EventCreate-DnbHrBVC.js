import{d as W,u as _,r as c,j as e,k as K,T as f}from"./index-C4h4LeeC.js";import{l as Q}from"./cropper-DSjCPVQJ.js";import{a as w}from"./api-CQpZrRPq.js";import{P as V}from"./PageTitle-CWWablCN.js";import{S as F}from"./Spinner-lRSxT0Gw.js";import{R as H}from"./Row-q3Ki7zJR.js";import{C}from"./Col-DtQoyYva.js";import{C as I,a as k}from"./Card-C11WjSz1.js";import{F as n}from"./Form-D3LbNE2c.js";import{B as l}from"./Button-44QDA4_g.js";import"./CardHeaderContext-DEdCtnK_.js";import"./divWithClassName-D8tIs208.js";import"./FormCheck-kNP21EUQ.js";import"./FormContext-BAY9kC9G.js";import"./ElementChildren-CJn4I1Gs.js";import"./FormControl-BR82fO97.js";import"./FormLabel-CMWJChb4.js";import"./Button-BvvrbRIW.js";const ve=()=>{const{id:o}=W(),y=_(),d=c.useRef(null),[L,g]=c.useState(!1),[$,x]=c.useState(""),[T,b]=c.useState(null),[N,G]=c.useState(null),[A,M]=c.useState(!!o),[v,S]=c.useState(!1),[r,p]=c.useState({title:"",place:"",eventType:"",eventDate:"",startTime:"",endTime:"",highlights:[""]}),E=362/472;c.useEffect(()=>{if(!o)return;(async()=>{try{const a=await w.get(`/admin/events/${o}`);if(a.status===200){const s=a.data.data,[i,m]=s.timing.split(" - "),u=D(i),j=D(m);p({title:s.title,place:s.place,eventType:s.eventType||"",eventDate:new Date(s.eventDate).toISOString().split("T")[0],startTime:u,endTime:j,highlights:s.highlights||[""]}),s.image&&b(s.image)}}catch(a){console.error("Error fetching event:",a),x("Failed to load event data"),g(!0)}finally{M(!1)}})()},[o]);const D=t=>{if(!t)return"";const[a,s]=t.split(" ");let[i,m]=a.split(":");return s==="PM"&&i!=="12"&&(i=parseInt(i,10)+12),s==="AM"&&i==="12"&&(i="00"),`${i}:${m}`},P=t=>{const a=t.target.files[0];if(a){const s=new FileReader;s.onload=()=>{b(s.result)},s.readAsDataURL(a)}},U=()=>{var a;const t=(a=d.current)==null?void 0:a.cropper;t&&t.getCroppedCanvas().toBlob(s=>{G(s)})},h=t=>{const{name:a,value:s}=t.target;p(i=>({...i,[a]:s}))},q=()=>{p(t=>({...t,highlights:[...t.highlights,""]}))},B=t=>{const a=r.highlights.filter((s,i)=>i!==t);p(s=>({...s,highlights:a}))},z=(t,a)=>{const s=[...r.highlights];s[t]=a,p(i=>({...i,highlights:s}))},O=async t=>{t.preventDefault(),S(!0);try{const a=new FormData;N&&a.append("image",N);const s=u=>{const[j,Z]=u.split(":"),R=parseInt(j,10),J=R>=12?"PM":"AM";return`${R%12||12}:${Z} ${J}`},i=`${s(r.startTime)} - ${s(r.endTime)}`;o&&a.append("id",o),a.append("title",r.title),a.append("place",r.place),a.append("eventType",r.eventType),a.append("eventDate",r.eventDate),a.append("timing",i),a.append("highlights",JSON.stringify(r.highlights.filter(u=>u.trim()!=="")));const m=await w.post(o?`/admin/events/${o}`:"/admin/create-event",a,{headers:{"Content-Type":"multipart/form-data"}});(m.status===200||m.status===201)&&(x(o?"Event updated successfully!":"Event created successfully!"),g(!0),setTimeout(()=>{y("/event")},2e3))}catch(a){console.error("Error saving event:",a),x(`Failed to ${o?"update":"create"} event`),g(!0)}finally{S(!1)}};return A?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"80vh"},children:e.jsx(F,{animation:"border",variant:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(V,{title:o?"Edit Event":"Create Event"}),e.jsx(K,{position:"top-end",className:"p-3",children:e.jsxs(f,{onClose:()=>g(!1),show:L,delay:3e3,autohide:!0,children:[e.jsx(f.Header,{children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(f.Body,{children:$})]})}),e.jsx(H,{children:e.jsx(C,{xs:12,children:e.jsx(I,{children:e.jsx(k,{children:e.jsx(n,{onSubmit:O,children:e.jsxs(H,{children:[e.jsxs(C,{lg:9,children:[e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Event Image (362x472)"}),e.jsx(n.Control,{type:"file",accept:"image/*",onChange:P}),e.jsx(n.Text,{className:"text-muted",children:o?"Upload new image to replace existing one":"Upload event image"})]}),T&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"img-container",children:e.jsx(Q,{src:T,style:{height:400,width:"100%"},initialAspectRatio:E,aspectRatio:E,guides:!1,crop:U,ref:d,rotatable:!0,scalable:!0,zoomable:!0})}),e.jsx(I,{className:"mt-3",children:e.jsx(k,{children:e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsx(l,{variant:"outline-secondary",onClick:()=>{var t;return(t=d.current)==null?void 0:t.cropper.zoom(.1)},children:"Zoom In"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>{var t;return(t=d.current)==null?void 0:t.cropper.zoom(-.1)},children:"Zoom Out"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>{var t;return(t=d.current)==null?void 0:t.cropper.rotate(-45)},children:"Rotate Left"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>{var t;return(t=d.current)==null?void 0:t.cropper.rotate(45)},children:"Rotate Right"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>{var t;return(t=d.current)==null?void 0:t.cropper.reset()},children:"Reset"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>{var t;return(t=d.current)==null?void 0:t.cropper.clear()},children:"Clear"})]})})})]})]}),e.jsxs(C,{lg:3,children:[e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Event Title"}),e.jsx(n.Control,{type:"text",name:"title",value:r.title,onChange:h,placeholder:"Enter event title",required:!0})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Place"}),e.jsx(n.Control,{type:"text",name:"place",value:r.place,onChange:h,placeholder:"Enter event place",required:!0})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Event Type"}),e.jsxs(n.Control,{as:"select",name:"eventType",value:r.eventType,onChange:h,children:[e.jsx("option",{value:"",children:"Select event type"}),e.jsx("option",{value:"concert",children:"Concert"}),e.jsx("option",{value:"conference",children:"Conference"}),e.jsx("option",{value:"workshop",children:"Workshop"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Date"}),e.jsx(n.Control,{type:"date",name:"eventDate",value:r.eventDate,onChange:h,required:!0})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Start Time"}),e.jsx(n.Control,{type:"time",name:"startTime",value:r.startTime,onChange:h,required:!0})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"End Time"}),e.jsx(n.Control,{type:"time",name:"endTime",value:r.endTime,onChange:h,required:!0})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Highlights"}),r.highlights.map((t,a)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(n.Control,{type:"text",value:t,onChange:s=>z(a,s.target.value),placeholder:`Highlight ${a+1}`}),e.jsx(l,{variant:"danger",className:"ms-2",onClick:()=>B(a),disabled:r.highlights.length===1,children:"Remove"})]},a)),e.jsx(l,{variant:"secondary",className:"w-100",onClick:q,children:"Add Highlight"})]}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsx(l,{variant:"primary",type:"submit",className:"mt-3",disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(F,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),o?" Updating...":" Creating..."]}):o?"Update Event":"Create Event"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>y("/event"),disabled:v,children:"Cancel"})]})]})]})})})})})})]})};export{ve as default};
