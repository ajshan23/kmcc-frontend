import{a as Z,r,j as e,T as $,g as J,h as K}from"./index-DTNBVJXJ.js";import{l as Q}from"./cropper-DRbxm2vn.js";import{I as d}from"./IconifyIcon-C822AO2m.js";import{a as V}from"./api-alN533tX.js";import{P as _}from"./PageTitle-BSd58_4C.js";import{l as ee}from"./logo-sm-DeRMNujR.js";import{R as w,C}from"./Row-BAydH47-.js";import{C as M}from"./Card-LdjoLELL.js";import{C as R}from"./CardBody-ffggLUo-.js";import{F as a}from"./Form-C-a0Gm7P.js";import{B as m}from"./Button-D3ui8Ipe.js";import"./iconify-DGrS6a3F.js";import"./CardHeaderContext-Cg4WHjpo.js";import"./divWithClassName-Bqr9clmc.js";import"./FormCheck-BrI6a1VK.js";import"./FormContext-BNTEYguM.js";import"./ElementChildren-a0xZHth5.js";import"./FormControl-CXDbjkuY.js";import"./FormLabel-CLyi9vaj.js";import"./Button-LfktIHOk.js";const be=()=>{const D=Z(),[F,n]=r.useState(!1),[I,o]=r.useState(""),[y,b]=r.useState(!1),[S,E]=r.useState(null),[te,L]=r.useState({cropX:0,cropY:0,imageWidth:0,imageHeight:0,imageRotate:0,scaleX:0,scaleY:0}),[u,k]=r.useState(null),[h,P]=r.useState(""),[g,G]=r.useState(""),[x,z]=r.useState(""),[j,A]=r.useState(""),[f,B]=r.useState(""),[v,X]=r.useState("Mon-Fri"),c=r.useRef(null),N=123/137,Y=[{label:"Monday to Friday",value:"Mon-Fri"},{label:"Monday to Saturday",value:"Mon-Sat"},{label:"Everyday",value:"Everyday"},{label:"Custom",value:"Custom"}],H=t=>{const l=t.target.files[0];if(!l)return;if(!l.type.startsWith("image/")){o("Please upload a valid image file."),n(!0);return}if(l.size>5*1024*1024){o("File size must be less than 5MB."),n(!0);return}const s=new FileReader;s.onload=()=>{E(s.result)},s.readAsDataURL(l)},U=()=>{var l;const t=(l=c.current)==null?void 0:l.cropper;if(t){const s=t.getData(),p=t.getImageData();L({cropX:Math.ceil(s.x),cropY:Math.ceil(s.y),imageWidth:Math.ceil(p.width),imageHeight:Math.ceil(p.height),imageRotate:Math.ceil(p.rotate),scaleX:Math.ceil(p.scaleX),scaleY:Math.ceil(p.scaleY)}),t.getCroppedCanvas().toBlob(i=>{k(i)})}},W=async()=>{if(!u){o("Please crop the image first."),n(!0);return}if(!h||!g||!j||!f||!x||!v){o("Please fill all required fields."),n(!0);return}b(!0);const t=`service-image-${Date.now()}.png`,l=new File([u],t,{type:"image/png"}),s=new FormData;s.append("image",l),s.append("title",h),s.append("location",g),s.append("startingTime",j),s.append("stoppingTime",f),s.append("phoneNumber",x),s.append("availableDays",v),(i=>{const T={};for(let[q,O]of i.entries())T[q]=O;console.log(T)})(s);try{(await V.post("/services/new",s,{headers:{"Content-Type":"multipart/form-data"}})).status===201?(o("Service created successfully!"),n(!0),setTimeout(()=>{D("/service")},2e3)):(o("Failed to create service."),n(!0))}catch(i){console.error("Error creating service:",i),i.response?o(i.response.data.message||"Failed to create service."):i.request?o("Network error. Please check your connection."):o("An unexpected error occurred."),n(!0)}finally{b(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(_,{title:"New service"}),e.jsxs($,{onClose:()=>n(!1),show:F,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(J,{children:[e.jsx("img",{src:ee,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsx(K,{children:I})]}),e.jsx(w,{children:e.jsx(C,{xs:12,children:e.jsx(M,{children:e.jsx(R,{children:e.jsxs(w,{children:[e.jsxs(C,{lg:9,children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Upload Service Image (123x137)"}),e.jsx(a.Control,{type:"file",accept:"image/*",onChange:H})]}),S&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"img-container",children:e.jsx(Q,{src:S,style:{height:400,width:"100%"},initialAspectRatio:N,aspectRatio:N,guides:!1,crop:U,ref:c,rotatable:!0,scalable:!0,zoomable:!0})}),e.jsx(M,{children:e.jsx(R,{children:e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsxs(m,{onClick:()=>{var t;return(t=c.current)==null?void 0:t.cropper.zoom(.1)},children:[e.jsx(d,{icon:"mdi:magnify-plus-outline"})," ","Zoom In"]}),e.jsxs(m,{onClick:()=>{var t;return(t=c.current)==null?void 0:t.cropper.zoom(-.1)},children:[e.jsx(d,{icon:"mdi:magnify-minus-outline"})," ","Zoom Out"]}),e.jsxs(m,{onClick:()=>{var t;return(t=c.current)==null?void 0:t.cropper.rotate(-45)},children:[e.jsx(d,{icon:"mdi:rotate-left"})," Rotate Left"]}),e.jsxs(m,{onClick:()=>{var t;return(t=c.current)==null?void 0:t.cropper.rotate(45)},children:[e.jsx(d,{icon:"mdi:rotate-right"})," Rotate Right"]}),e.jsxs(m,{onClick:()=>{var t;return(t=c.current)==null?void 0:t.cropper.reset()},children:[e.jsx(d,{icon:"mdi:sync"})," Reset"]}),e.jsxs(m,{onClick:()=>{var t;return(t=c.current)==null?void 0:t.cropper.clear()},children:[e.jsx(d,{icon:"mdi:close"})," Clear"]})]})})})]})]}),e.jsxs(C,{lg:3,children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Service Title"}),e.jsx(a.Control,{type:"text",value:h,onChange:t=>P(t.target.value),placeholder:"Enter service title"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Place"}),e.jsx(a.Control,{type:"text",value:g,onChange:t=>G(t.target.value),placeholder:"Enter service place"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Start Time"}),e.jsx(a.Control,{type:"time",value:j,onChange:t=>A(t.target.value)})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"End Time"}),e.jsx(a.Control,{type:"time",value:f,onChange:t=>B(t.target.value)})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Phone Number"}),e.jsx(a.Control,{type:"number",value:x,onChange:t=>z(t.target.value),placeholder:"Enter phone number"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Available Days"}),e.jsx(a.Select,{value:v,onChange:t=>X(t.target.value),children:Y.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(m,{variant:"primary",className:"w-100 mt-3",onClick:W,disabled:!u||y,children:y?"Creating...":"Create Service"})]})]})})})})})]})};export{be as default};
