import{r as a,j as e,k as te,T as w,L as Q}from"./index-CfNT85tM.js";import{a as C}from"./api-BAouzzCb.js";import{I as y}from"./IconifyIcon-0D5ZULyN.js";import{P as ae}from"./PageTitle-D_HZ265t.js";import{d as re}from"./index-BeK54Baj.js";import{C as _}from"./Card-BxC9ygCX.js";import{C as H}from"./CardBody-TiP-bp9B.js";import{R as O,C as E}from"./Row-pUvplkm2.js";import{I as ne}from"./InputGroup-DILXNa1f.js";import{F as ie}from"./FormControl-dmhg-08h.js";import{B as r}from"./Button-DmtmunvM.js";import{S as V}from"./Spinner-DY2VvB9K.js";import{B as z}from"./Badge-Dxw4lbGc.js";import{F as le}from"./Form-BPTIrVzf.js";import{T as oe}from"./Table-DAjJSobz.js";import{P as B}from"./Pagination-mI0TYWHu.js";import{C as ce,a as de,L as me,B as he,p as xe,b as pe,c as je,A as ue}from"./chart-BpwFQqEG.js";import{M as W,a as X,b as Y,c as Z,d as ee}from"./Modal-xL1nFGJh.js";import{T as ge}from"./Tabs-DuqMh3co.js";import{T as se}from"./Tab-LnW0qGdn.js";import{B as fe}from"./ButtonGroup-DFdAj-D1.js";import"./iconify-Dnpwx_79.js";import"./CardHeaderContext-DMh6jMut.js";import"./divWithClassName-MTQsKDs0.js";import"./FormCheck-DtwGqKiM.js";import"./FormContext-CAGAzZgQ.js";import"./ElementChildren-ShUlXlPu.js";import"./InputGroupContext-BwBJiCBN.js";import"./Button-AVmPP0NH.js";import"./FormLabel-CoJ0DtNH.js";import"./Anchor-Kzj3Lb_I.js";import"./useEventCallback-B2meNR0i.js";import"./AbstractModalHeader-o6WA7pR6.js";import"./useWindow-BmY1pYqs.js";import"./usePrevious-TUyZfySc.js";import"./hasClass-BQeUoxnv.js";import"./useMergedRefs-eYDo2WSS.js";import"./NoopTransition-BANWBBX8.js";import"./DataKey-COGXBUcQ.js";import"./hook-9Fc7o0VZ.js";import"./extends-CF3RwP-h.js";import"./TabPane-BrrWKCGZ.js";import"./Nav-DYsxPVmg.js";import"./NavContext-j2YYlu8f.js";import"./NavItem-lRUtfKNV.js";import"./NavbarContext-Wz35b8Be.js";import"./NavLink-BRKSwZly.js";const Ne=({eventId:u})=>{const[h,A]=a.useState([]),[T,k]=a.useState(!0),[M,n]=a.useState(""),[f,x]=a.useState(!1),[p,g]=a.useState(""),[o,d]=a.useState(1),[S]=a.useState(10),[N,F]=a.useState("all"),[D,K]=a.useState(!1),m=a.useCallback(async()=>{try{k(!0);const s=await C.get(`/admin/events/${u}/registrations`);s.status===200&&A(s.data.data.registrations||[])}catch(s){console.error("Error fetching registrations:",s),g("Failed to load registrations"),x(!0)}finally{k(!1)}},[u]);a.useEffect(()=>{m()},[m]);const I=re(s=>{n(s),d(1)},300),R=async()=>{var s,i;try{const c=await C.get(`/admin/events/${u}/registrations/download`,{responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}),U=new Blob([c.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),v=window.URL.createObjectURL(U),b=document.createElement("a");b.href=v;let q=`event_registrations_${u}.xlsx`;const J=c.headers["content-disposition"];if(J){const $=J.match(/filename="?(.+)"?/);$&&$[1]&&(q=decodeURIComponent($[1]))}b.setAttribute("download",q),document.body.appendChild(b),b.click(),window.URL.revokeObjectURL(v),b.parentNode.removeChild(b),g("Registrations exported successfully"),x(!0)}catch(c){console.error("Error exporting registrations:",c),g(((i=(s=c.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to export registration data"),x(!0)}},L=async(s,i)=>{try{(await C.patch(`/admin/events/${u}/attendance`,{userId:s,isAttended:!i})).status===200&&(A(U=>U.map(v=>v.userId===s?{...v,isAttended:!i}:v)),g("Attendance updated successfully"),x(!0))}catch(c){console.error("Error updating attendance:",c),g("Failed to update attendance"),x(!0)}},t=h.filter(s=>{const i=s.user.name.toLowerCase().includes(M.toLowerCase()),c=N==="all"||N==="attended"&&s.isAttended||N==="pending"&&!s.isAttended;return i&&c}),l=o*S,j=l-S,G=t.slice(j,l),P=Math.ceil(t.length/S);return e.jsxs("div",{className:"p-4",children:[e.jsx(ae,{title:"Event Attendance"}),e.jsx(te,{position:"top-end",className:"p-3",children:e.jsxs(w,{onClose:()=>x(!1),show:f,delay:3e3,autohide:!0,children:[e.jsx(w.Header,{children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(w.Body,{children:p})]})}),e.jsx(_,{className:"shadow-sm",children:e.jsxs(H,{children:[e.jsxs(O,{className:"mb-4",children:[e.jsx(E,{md:6,children:e.jsxs(ne,{children:[e.jsx(ie,{placeholder:"Search attendees...",onChange:s=>I(s.target.value)}),e.jsx(r,{variant:"primary",onClick:R,disabled:h.length===0||D,children:D?e.jsxs(e.Fragment,{children:[e.jsx(V,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),e.jsx("span",{className:"ms-2",children:"Downloading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-download me-1"})," Download Excel"]})})]})}),e.jsxs(E,{md:6,className:"text-md-end",children:[e.jsxs(z,{bg:"info",className:"p-2",children:["Total Registered: ",h.length]}),e.jsxs(z,{bg:"success",className:"p-2 ms-2",children:["Attended: ",h.filter(s=>s.isAttended).length]})]})]}),e.jsx(O,{className:"mb-3",children:e.jsx(E,{md:3,children:e.jsxs(le.Select,{value:N,onChange:s=>{F(s.target.value),d(1)},children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"attended",children:"Attended"}),e.jsx("option",{value:"pending",children:"Pending"})]})})}),T?e.jsx("div",{className:"text-center py-4",children:e.jsx(V,{animation:"border",variant:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(oe,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Member ID"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:G.length>0?G.map((s,i)=>e.jsxs("tr",{children:[e.jsx("td",{children:j+i+1}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[s.user.profileImage&&e.jsx("img",{src:`data:image/jpeg;base64,${s.user.profileImage}`,alt:"Profile",className:"rounded-circle me-2",style:{width:"30px",height:"30px"}}),s.user.name]})}),e.jsx("td",{children:s.user.memberId}),e.jsx("td",{children:s.user.phoneNumber}),e.jsx("td",{children:e.jsx(z,{bg:s.isAttended?"success":"warning",className:"p-2",children:s.isAttended?"Attended":"Pending"})}),e.jsx("td",{children:e.jsx(r,{variant:s.isAttended?"warning":"success",size:"sm",onClick:()=>L(s.userId,s.isAttended),children:s.isAttended?"Mark Absent":"Mark Present"})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-4",children:"No registrations found"})})})]})}),P>1&&e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsxs(B,{children:[e.jsx(B.Prev,{onClick:()=>d(s=>Math.max(1,s-1)),disabled:o===1}),Array.from({length:P},(s,i)=>e.jsx(B.Item,{active:i+1===o,onClick:()=>d(i+1),children:i+1},i+1)),e.jsx(B.Next,{onClick:()=>d(s=>Math.min(P,s+1)),disabled:o===P})]})})]})]})})]})};ce.register(de,me,he,xe,pe,je,ue);const xs=()=>{const[u,h]=a.useState([]),[A,T]=a.useState(!1),[k,M]=a.useState(!1),[n,f]=a.useState(null),[x,p]=a.useState(!1),[g,o]=a.useState(""),[d,S]=a.useState(""),[N,F]=a.useState("events");a.useEffect(()=>{(async()=>{try{const l=await C.get("/admin/get-events");l.status===200&&h(l.data.data)}catch(l){console.error(l),o("Failed to load events"),p(!0)}})()},[]);const D=t=>{f(t),T(!0)},K=t=>{f(t),M(!0)},m=()=>{T(!1),M(!1),f(null)},I=async()=>{if(n)try{(await C.patch(`/admin/status/event/${n.id}`)).status===200&&(h(l=>l.map(j=>j.id===n.id?{...j,isFinished:!0}:j)),o("Event marked as completed!"),p(!0))}catch(t){console.error("Error updating event status:",t),o("Failed to update event status."),p(!0)}finally{m()}},R=async()=>{if(n)try{(await C.delete(`/admin/event/${n.id}`)).status===200&&(h(l=>l.filter(j=>j.id!==n.id)),o("Event deleted successfully!"),p(!0))}catch(t){console.error("Error deleting event:",t),o("Failed to delete event."),p(!0)}finally{m()}},L=u.filter(t=>t.title.toLowerCase().includes(d.toLowerCase()));return e.jsxs("div",{className:"p-4",children:[e.jsx(ae,{title:"Event Management"}),e.jsx(te,{position:"top-end",className:"p-3",children:e.jsxs(w,{onClose:()=>p(!1),show:x,delay:3e3,autohide:!0,children:[e.jsx(w.Header,{className:"bg-primary text-white",children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(w.Body,{children:g})]})}),e.jsxs(W,{show:A,onHide:m,centered:!0,children:[e.jsx(X,{closeButton:!0,className:"bg-light",children:e.jsx(Y,{as:"h5",children:"Confirm Completion"})}),e.jsx(Z,{children:n&&e.jsxs("div",{children:[e.jsxs("p",{children:["Are you sure you want to mark"," ",e.jsxs("strong",{children:['"',n.title,'"']})," as completed?"]}),e.jsx("p",{className:"text-muted",children:'This will change the event status to "Finished".'})]})}),e.jsxs(ee,{children:[e.jsx(r,{variant:"outline-secondary",onClick:m,children:"Cancel"}),e.jsx(r,{variant:"primary",onClick:I,children:"Confirm"})]})]}),e.jsxs(W,{show:k,onHide:m,centered:!0,children:[e.jsx(X,{closeButton:!0,className:"bg-light",children:e.jsx(Y,{as:"h5",children:"Confirm Deletion"})}),e.jsx(Z,{children:n&&e.jsxs("div",{children:[e.jsxs("p",{children:["Are you sure you want to delete"," ",e.jsxs("strong",{children:['"',n.title,'"']}),"?"]}),e.jsx("p",{className:"text-danger",children:"This action cannot be undone and will permanently remove the event."})]})}),e.jsxs(ee,{children:[e.jsx(r,{variant:"outline-secondary",onClick:m,children:"Cancel"}),e.jsx(r,{variant:"danger",onClick:R,children:"Delete"})]})]}),e.jsxs(ge,{activeKey:N,onSelect:t=>F(t),className:"mb-3",children:[e.jsx(se,{eventKey:"events",title:"Events Management",children:e.jsx(_,{className:"shadow-sm mt-3",children:e.jsxs(H,{children:[e.jsxs(O,{className:"mb-4",children:[e.jsx(E,{md:6,className:"mb-3 mb-md-0",children:e.jsxs(ne,{children:[e.jsx(ie,{placeholder:"Search events...","aria-label":"Search events",value:d,onChange:t=>S(t.target.value),className:"border-end-0"}),e.jsx(r,{variant:"outline-secondary",className:"border-start-0",children:e.jsx(y,{icon:"mdi:magnify"})})]})}),e.jsx(E,{md:6,className:"text-md-end",children:e.jsxs(r,{variant:"primary",as:Q,to:"/event/new",className:"px-4",children:[e.jsx(y,{icon:"mdi:plus",className:"me-2"}),"Create New Event"]})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"Title"}),e.jsx("th",{className:"text-center",children:"Date"}),e.jsx("th",{className:"text-center",children:"Location"}),e.jsx("th",{className:"text-center",children:"Timing"}),e.jsx("th",{className:"text-center",children:"Image"}),e.jsx("th",{className:"text-center",children:"Status"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsx("tbody",{children:L.length>0?L.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"align-middle",children:t.title}),e.jsx("td",{className:"align-middle",children:new Date(t.eventDate).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}),e.jsx("td",{className:"align-middle",children:t.place}),e.jsx("td",{className:"align-middle",children:t.timing}),e.jsx("td",{className:"align-middle",children:t.image?e.jsx("img",{src:t.image,alt:"Event banner",className:"rounded",style:{width:"60px",height:"60px",objectFit:"cover"}}):e.jsx("span",{className:"text-muted",children:"No image"})}),e.jsx("td",{className:"align-middle",children:e.jsx("span",{className:`badge ${t.isFinished?"bg-danger":"bg-success"} p-2`,children:t.isFinished?"Finished":"Ongoing"})}),e.jsx("td",{className:"align-middle",children:e.jsxs(fe,{children:[e.jsxs(r,{variant:"primary",size:"sm",as:Q,to:`/event/edit/${t.id}`,className:"me-2",children:[e.jsx(y,{icon:"mdi:pencil",className:"me-1"}),"Edit"]}),e.jsxs(r,{variant:"info",size:"sm",onClick:()=>{f(t),F("attendance")},className:"me-2",children:[e.jsx(y,{icon:"mdi:attendance",className:"me-1"}),"Attendance"]}),e.jsxs(r,{variant:t.isFinished?"secondary":"warning",size:"sm",onClick:()=>D(t),disabled:t.isFinished,className:"me-2",children:[e.jsx(y,{icon:"mdi:check-circle",className:"me-1"}),t.isFinished?"Completed":"Complete"]}),e.jsxs(r,{variant:"danger",size:"sm",onClick:()=>K(t),children:[e.jsx(y,{icon:"mdi:trash",className:"me-1"}),"Delete"]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-4",children:d?"No events match your search":"No events found"})})})]})})]})})}),e.jsx(se,{eventKey:"attendance",title:"Attendance Tracking",children:n?e.jsx(Ne,{eventId:n.id}):e.jsx(_,{className:"shadow-sm mt-3",children:e.jsx(H,{className:"text-center py-5",children:e.jsx("h5",{children:"Please select an event from the Events Management tab"})})})})]})]})};export{xs as default};
