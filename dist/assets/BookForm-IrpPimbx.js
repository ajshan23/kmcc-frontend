import{d as L,u as q,r as i,j as e,T as A,h as G,i as R}from"./index-C4h4LeeC.js";import{a as f}from"./api-CQpZrRPq.js";import{P as $}from"./PageTitle-CWWablCN.js";import{l as M}from"./logo-sm-Bq_R7RX3.js";import{R as F}from"./Row-q3Ki7zJR.js";import{C as x}from"./Col-DtQoyYva.js";import{C as U,a as H}from"./Card-C11WjSz1.js";import{F as a}from"./Form-D3LbNE2c.js";import{B}from"./Button-44QDA4_g.js";import"./CardHeaderContext-DEdCtnK_.js";import"./divWithClassName-D8tIs208.js";import"./FormCheck-kNP21EUQ.js";import"./FormContext-BAY9kC9G.js";import"./ElementChildren-CJn4I1Gs.js";import"./FormControl-BR82fO97.js";import"./FormLabel-CMWJChb4.js";import"./Button-BvvrbRIW.js";const ie=()=>{const{id:c}=L(),s=!!c,g=q(),[N,n]=i.useState(!1),[P,l]=i.useState(""),[p,j]=i.useState(""),[u,C]=i.useState(""),[b,v]=i.useState(""),[h,S]=i.useState(null),[y,k]=i.useState(null),[d,T]=i.useState(null),[w,m]=i.useState(!1);i.useEffect(()=>{s&&(async()=>{try{const t=await f.get(`/book/${c}`);if(t.status===200){const r=t.data.data;j(r.title||""),C(r.author||""),v(r.description||""),k(r.coverImage||null)}}catch(t){console.error("Error fetching book:",t),l("Failed to load book data"),n(!0)}})()},[c,s]);const E=o=>{const t=o.target.files[0];if(!t)return;if(!t.type.match("image.*")){l("Please select an image file"),n(!0);return}S(t);const r=new FileReader;r.onload=()=>{k(r.result)},r.readAsDataURL(t)},D=o=>{const t=o.target.files[0];if(t){if(t.type!=="application/pdf"){l("Please select a PDF file"),n(!0);return}T(t)}},I=async o=>{if(o.preventDefault(),m(!0),!p||!u){l("Title and author are required"),n(!0),m(!1);return}if(!s&&(!h||!d)){l("Both cover image and PDF file are required"),n(!0),m(!1);return}const t=new FormData;t.append("title",p),t.append("author",u),t.append("description",b),h&&t.append("coverImage",h),d&&t.append("pdf",d);try{let r;s?r=await f.put(`/book/${c}`,t,{headers:{"Content-Type":"multipart/form-data"}}):r=await f.post("/book",t,{headers:{"Content-Type":"multipart/form-data"}}),r.status===(s?200:201)&&(l(`Book ${s?"updated":"created"} successfully!`),n(!0),setTimeout(()=>{g("/book")},1500))}catch(r){console.error(`Error ${s?"updating":"creating"} book:`,r),l(`Failed to ${s?"update":"create"} book. Please try again.`),n(!0)}finally{m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx($,{title:s?"Edit Book":"Add New Book"}),e.jsxs(A,{onClose:()=>n(!1),show:N,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(G,{children:[e.jsx("img",{src:M,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"KMCC"})]}),e.jsx(R,{children:P})]}),e.jsx(F,{children:e.jsx(x,{xs:12,children:e.jsx(U,{children:e.jsx(H,{children:e.jsxs(a,{onSubmit:I,children:[e.jsxs(F,{children:[e.jsxs(x,{md:6,children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Title *"}),e.jsx(a.Control,{type:"text",value:p,onChange:o=>j(o.target.value),placeholder:"Enter book title",required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Author *"}),e.jsx(a.Control,{type:"text",value:u,onChange:o=>C(o.target.value),placeholder:"Enter author name",required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Description"}),e.jsx(a.Control,{as:"textarea",rows:3,value:b,onChange:o=>v(o.target.value),placeholder:"Enter book description"})]})]}),e.jsxs(x,{md:6,children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsxs(a.Label,{children:["Cover Image ",!s&&"*"]}),e.jsx(a.Control,{type:"file",accept:"image/*",onChange:E,required:!s}),y&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{children:"Preview:"}),e.jsx("img",{src:y,alt:"Cover preview",style:{maxHeight:"200px"}})]})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsxs(a.Label,{children:["PDF File ",!s&&"*"]}),e.jsx(a.Control,{type:"file",accept:"application/pdf",onChange:D,required:!s}),d&&e.jsx("div",{className:"mt-2",children:e.jsxs("p",{children:["Selected file: ",d.name]})})]})]})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-4",children:[e.jsx(B,{variant:"secondary",className:"me-2",onClick:()=>g("/book"),children:"Cancel"}),e.jsx(B,{variant:"primary",type:"submit",disabled:w,children:w?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),s?"Updating...":"Creating..."]}):s?"Update Book":"Add Book"})]})]})})})})})]})};export{ie as default};
