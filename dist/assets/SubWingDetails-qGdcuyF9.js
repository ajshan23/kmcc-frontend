import{r as i,j as e,d as W,T as H,h as z,i as K,L as q}from"./index-BCQ8XePc.js";import{P as G}from"./PageTitle-Bqjq_xpf.js";import{a as B}from"./api-CQpZrRPq.js";import{I as T}from"./IconifyIcon-jB5K9-96.js";import{l as O}from"./logo-sm-Bq_R7RX3.js";import"./iconify-Sjb3qfcU.js";import{l as J}from"./cropper-DNo2TXcW.js";import{F as j}from"./Form-DOoTYhWU.js";import{R as L}from"./Row-CQj91pzA.js";import{C}from"./Col-BR9WNOn1.js";import{F as A}from"./FormControl-SqxqXHwE.js";import{C as g,a as Q}from"./Card-DBoZ8N4s.js";import{B as b}from"./Button-DDbE0FWG.js";import{B as V}from"./Badge-Bf-JSp8T.js";import{T as X}from"./Tabs-BSGLuzmC.js";import{T as F}from"./Tab-9LlUt_n0.js";import{T as $}from"./Table-gVZHZr4U.js";import{M as x}from"./Modal-BTZHy_Jc.js";import"./FormCheck-B3j9whee.js";import"./FormContext-BhFHY_3_.js";import"./FormCheckInput-WVpR3VYM.js";import"./ElementChildren-CqgWmrA1.js";import"./FormLabel-BuyplJ8N.js";import"./CardHeaderContext-DlD9yLXM.js";import"./divWithClassName-BsRS6Wb_.js";import"./Button-D-jFX0tQ.js";import"./hook-CfyFr1rV.js";import"./extends-CF3RwP-h.js";import"./TabPane-2e_BU_9W.js";import"./Nav-DLS4rqq8.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-CuLTeRei.js";import"./useMergedRefs-D72rsyTi.js";import"./NavItem-PiGg2Miz.js";import"./useEventCallback-qFhElVO6.js";import"./NavbarContext-DqTDE0TJ.js";import"./NavLink-DZI1uC2f.js";import"./Anchor-Cx6sCtiu.js";import"./NoopTransition-BkakQPQj.js";import"./AbstractModalHeader-D4Cx9Y2h.js";import"./useWindow-DanGxOlB.js";import"./usePrevious-BphD9FTY.js";import"./hasClass-DANfkvs8.js";const P=({subWingId:c,onSuccess:r,onCancel:k,member:s})=>{const[h,w]=i.useState((s==null?void 0:s.name)||""),[f,v]=i.useState((s==null?void 0:s.position)||""),[m,N]=i.useState(null),[a,M]=i.useState(null),[p,y]=i.useState(!1),u=i.useRef(null);i.useEffect(()=>{s&&(w(s.name),v(s.position),s.image&&(N(s.image),M(s.image)))},[s]);const E=n=>{const o=n.target.files[0];if(o){const l=new FileReader;l.onload=()=>{N(l.result)},l.readAsDataURL(o)}},R=()=>{var o;const n=(o=u.current)==null?void 0:o.cropper;n&&n.getCroppedCanvas().toBlob(l=>{M(l)})},I=async n=>{if(n.preventDefault(),y(!0),!h||!f){alert("Name and position are required"),y(!1);return}const o=new FormData;o.append("name",h),o.append("position",f),a&&(!s||a!==s.image)&&o.append("image",a,"member.jpg");try{const l=s?`/sub-wing/${c}/members/${s.id}`:`/sub-wing/${c}/members`,S=await B[s?"put":"post"](l,o,{headers:{"Content-Type":"multipart/form-data"}});S.status===(s?200:201)&&r(S.data.data)}catch(l){console.error("Error saving member:",l),alert(`Failed to ${s?"update":"add"} member`)}finally{y(!1)}};return e.jsxs(j,{onSubmit:I,children:[e.jsxs(L,{children:[e.jsxs(C,{md:6,children:[e.jsxs(j.Group,{className:"mb-3",children:[e.jsx(j.Label,{children:"Member Name"}),e.jsx(A,{type:"text",value:h,onChange:n=>w(n.target.value),placeholder:"Enter member name",required:!0})]}),e.jsxs(j.Group,{className:"mb-3",children:[e.jsx(j.Label,{children:"Position"}),e.jsx(A,{type:"text",value:f,onChange:n=>v(n.target.value),placeholder:"Enter position",required:!0})]})]}),e.jsxs(C,{md:6,children:[e.jsxs(j.Group,{className:"mb-3",children:[e.jsx(j.Label,{children:"Member Image (163x231 recommended)"}),e.jsx(A,{type:"file",accept:"image/*",onChange:E})]}),m&&e.jsx(g,{className:"mb-3",children:e.jsx(Q,{children:e.jsx(J,{src:m,style:{height:400,width:"100%"},initialAspectRatio:163/231,aspectRatio:163/231,guides:!1,crop:R,ref:u})})}),a&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Cropped Preview:"}),e.jsx("img",{src:typeof a=="string"?a:URL.createObjectURL(a),alt:"Cropped preview",style:{maxHeight:"200px"}})]})]})]}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(b,{variant:"secondary",className:"me-2",onClick:k,children:"Cancel"}),e.jsx(b,{variant:"primary",type:"submit",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),s?"Updating...":"Adding..."]}):s?"Update Member":"Add Member"})]})]})},We=()=>{const{subWingId:c}=W(),[r,k]=i.useState(null),[s,h]=i.useState([]),[w,f]=i.useState(!0),[v,m]=i.useState(!1),[N,a]=i.useState(""),[M,p]=i.useState(!1),[y,u]=i.useState(!1),[E,R]=i.useState(null),[I,n]=i.useState("details");i.useEffect(()=>{(async()=>{try{f(!0);const[d,U]=await Promise.all([B.get(`/sub-wing/${c}`),B.get(`/sub-wing/${c}/members`)]);k(d.data.data),h(U.data.data)}catch(d){console.error("Error fetching sub-wing details:",d),a("Failed to load sub-wing details"),m(!0)}finally{f(!1)}})()},[c]);const o=t=>{h([...s,t]),p(!1),a("Member added successfully"),m(!0)},l=t=>{h(s.map(d=>d.id===t.id?t:d)),u(!1),a("Member updated successfully"),m(!0)},D=async t=>{if(window.confirm("Are you sure you want to delete this member?"))try{await B.delete(`/sub-wing/${c}/members/${t}`),h(s.filter(d=>d.id!==t)),a("Member deleted successfully"),m(!0)}catch(d){console.error("Error deleting member:",d),a("Failed to delete member"),m(!0)}},S=t=>{R(t),u(!0)};return w?e.jsx("div",{className:"d-flex justify-content-center p-5",children:"Loading..."}):r?e.jsxs("div",{className:"d-flex p-4",children:[e.jsx(G,{title:"Sub-Wing Details"}),e.jsxs(H,{onClose:()=>m(!1),show:v,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(z,{children:[e.jsx("img",{src:O,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"KMCC"})]}),e.jsx(K,{children:N})]}),e.jsx(L,{className:"w-100",children:e.jsx(C,{xs:12,children:e.jsx(g,{children:e.jsxs(g.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("h4",{children:[r.name," Sub-Wing",e.jsxs(V,{bg:"primary",className:"ms-2",children:[s.length," Members"]})]}),e.jsxs("div",{children:[e.jsxs(b,{variant:"primary",className:"me-2",as:q,to:`/sub-wing/edit/${c}`,children:[e.jsx(T,{icon:"mdi:pencil",className:"me-1"}),"Edit"]}),e.jsxs(b,{variant:"success",onClick:()=>p(!0),children:[e.jsx(T,{icon:"mdi:plus",className:"me-1"}),"Add Member"]})]})]}),e.jsxs(X,{activeKey:I,onSelect:t=>n(t),className:"mb-3",children:[e.jsx(F,{eventKey:"details",title:"Details",children:e.jsxs(L,{className:"mt-3",children:[e.jsx(C,{md:4,children:e.jsx(g,{children:e.jsxs(g.Body,{className:"text-center",children:[r.icon?e.jsx("img",{src:r.icon,alt:r.name,style:{height:"150px",marginBottom:"20px"}}):e.jsx("div",{style:{height:"150px",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"20px"},children:e.jsx("span",{className:"text-muted",children:"No icon"})}),e.jsx("h5",{children:"Color Scheme"}),e.jsxs("div",{className:"d-flex justify-content-center gap-3 mb-3",children:[e.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:r.backgroundColor,border:"1px solid #ddd"},title:`Background: ${r.backgroundColor}`}),e.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:r.mainColor,border:"1px solid #ddd"},title:`Main color: ${r.mainColor}`})]})]})})}),e.jsx(C,{md:8,children:e.jsx(g,{children:e.jsxs(g.Body,{children:[e.jsx("h5",{children:"Sub-Wing Information"}),e.jsx($,{bordered:!0,children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("td",{children:r.name})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Background Color"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{style:{width:"20px",height:"20px",backgroundColor:r.backgroundColor,marginRight:"10px",border:"1px solid #ddd"}}),r.backgroundColor]})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Main Color"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{style:{width:"20px",height:"20px",backgroundColor:r.mainColor,marginRight:"10px",border:"1px solid #ddd"}}),r.mainColor]})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("td",{children:r.description})]})]})})]})})})]})}),e.jsx(F,{eventKey:"members",title:"Members",children:e.jsx("div",{className:"mt-3",children:e.jsxs($,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Position"}),e.jsx("th",{children:"Image"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map((t,d)=>e.jsxs("tr",{children:[e.jsx("td",{children:d+1}),e.jsx("td",{children:t.name}),e.jsx("td",{children:t.position}),e.jsx("td",{children:t.image?e.jsx("img",{src:t.image,alt:t.name,style:{height:"50px"}}):e.jsx("span",{className:"text-muted",children:"No image"})}),e.jsxs("td",{children:[e.jsx(b,{variant:"primary",size:"sm",className:"me-2",onClick:()=>S(t),children:e.jsx(T,{icon:"mdi:pencil",color:"white"})}),e.jsx(b,{variant:"danger",size:"sm",onClick:()=>D(t.id),children:e.jsx(T,{icon:"mdi:delete",color:"white"})})]})]},t.id))})]})})})]})]})})})}),e.jsxs(x,{show:M,onHide:()=>p(!1),size:"lg",children:[e.jsx(x.Header,{closeButton:!0,children:e.jsx(x.Title,{children:"Add New Member"})}),e.jsx(x.Body,{children:e.jsx(P,{subWingId:c,onSuccess:o,onCancel:()=>p(!1)})})]}),e.jsxs(x,{show:y,onHide:()=>u(!1),size:"lg",children:[e.jsx(x.Header,{closeButton:!0,children:e.jsx(x.Title,{children:"Edit Member"})}),e.jsx(x.Body,{children:e.jsx(P,{subWingId:c,onSuccess:l,onCancel:()=>u(!1),member:E})})]})]}):e.jsx("div",{className:"d-flex justify-content-center p-5",children:"Sub-wing not found"})};export{We as default};
