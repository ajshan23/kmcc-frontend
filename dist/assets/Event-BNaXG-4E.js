import{r as a,j as e,k as H,T as u,L as D}from"./index-DKQPNifM.js";import{a as C}from"./api-BAouzzCb.js";import{I as j}from"./IconifyIcon-Cz5kna7C.js";import{P as U}from"./PageTitle-CRu15oFp.js";import{C as k}from"./Card-D59v7jI9.js";import{C as F}from"./CardBody-DcEFUZwh.js";import{R as K,C as T}from"./Row-Z0t_gNsB.js";import{I as _}from"./InputGroup-BoExRK3x.js";import{F as G}from"./FormControl-BA3XJbTj.js";import{B as M}from"./Badge-C8PV2b9o.js";import{S as J}from"./Spinner-CHuAIaOa.js";import{T as Q}from"./Table-CQf6JiUU.js";import{B as r}from"./Button-CJm9uxN6.js";import{C as V,a as W,L as X,B as Y,p as Z,b as ee,c as se,A as te}from"./chart-BpwFQqEG.js";import{M as I,a as L,b as R,c as P,d as $}from"./Modal-DzjcU-YA.js";import{T as ae}from"./Tabs-Bz9TCoAY.js";import{T as z}from"./Tab-B2k2tOP-.js";import{B as ne}from"./ButtonGroup-AMQsgK6p.js";import"./iconify-BZ3wrvzO.js";import"./CardHeaderContext-kdxd1e-2.js";import"./divWithClassName-CmLA-jjW.js";import"./FormCheckInput-B_azkgLI.js";import"./FormContext-wZ54zJwb.js";import"./InputGroupContext-B6ztc9me.js";import"./Button-dGMJGo8F.js";import"./AbstractModalHeader-Ce9hSe-k.js";import"./useWindow-D5QcWUEp.js";import"./usePrevious-DP_BbfW8.js";import"./useEventCallback-Be3DcQW7.js";import"./hasClass-C5ui0Lxl.js";import"./useMergedRefs-DX226p1l.js";import"./NoopTransition-40k_bfUr.js";import"./DataKey-COGXBUcQ.js";import"./hook-weBL_fHe.js";import"./extends-CF3RwP-h.js";import"./TabPane-D628qwib.js";import"./Nav-DnoA70og.js";import"./NavContext-CdHF7jfo.js";import"./NavItem-Bn7ii0RS.js";import"./NavbarContext-DTIjGSwE.js";import"./NavLink-CKOK-iX3.js";import"./Anchor-DaoZRV_t.js";import"./ElementChildren-CJ8krY86.js";const ie=({eventId:g})=>{const[d,w]=a.useState([]),[S,E]=a.useState(!0),[f,n]=a.useState(""),[m,h]=a.useState(!1),[l,N]=a.useState("");a.useEffect(()=>{(async()=>{try{const i=await C.get(`/admin/events/${g}/registrations`);i.status===200&&w(i.data.data.registrations||[])}catch(i){console.error("Error fetching registrations:",i),N("Failed to load registrations"),h(!0)}finally{E(!1)}})()},[g]);const o=async(t,i)=>{try{(await C.patch(`/admin/events/${g}/attendance`,{userId:t,isAttended:!i})).status===200&&(w(A=>A.map(y=>y.userId===t?{...y,isAttended:!i}:y)),N("Attendance updated successfully"),h(!0))}catch(v){console.error("Error updating attendance:",v),N("Failed to update attendance"),h(!0)}},x=d.filter(t=>t.user.name.toLowerCase().includes(f.toLowerCase()));return e.jsxs("div",{className:"p-4",children:[e.jsx(U,{title:"Event Attendance"}),e.jsx(H,{position:"top-end",className:"p-3",children:e.jsxs(u,{onClose:()=>h(!1),show:m,delay:3e3,autohide:!0,children:[e.jsx(u.Header,{children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(u.Body,{children:l})]})}),e.jsx(k,{className:"shadow-sm",children:e.jsxs(F,{children:[e.jsxs(K,{className:"mb-4",children:[e.jsx(T,{md:6,children:e.jsx(_,{children:e.jsx(G,{placeholder:"Search attendees...",value:f,onChange:t=>n(t.target.value)})})}),e.jsxs(T,{md:6,className:"text-md-end",children:[e.jsxs(M,{bg:"info",className:"p-2",children:["Total Registered: ",d.length]}),e.jsxs(M,{bg:"success",className:"p-2 ms-2",children:["Attended: ",d.filter(t=>t.isAttended).length]})]})]}),S?e.jsx("div",{className:"text-center py-4",children:e.jsx(J,{animation:"border",variant:"primary"})}):e.jsx("div",{className:"table-responsive",children:e.jsxs(Q,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Member ID"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:x.length>0?x.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{children:i+1}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[t.user.profileImage&&e.jsx("img",{src:`data:image/jpeg;base64,${t.user.profileImage}`,alt:"Profile",className:"rounded-circle me-2",style:{width:"30px",height:"30px"}}),t.user.name]})}),e.jsx("td",{children:t.user.memberId}),e.jsx("td",{children:t.user.phoneNumber}),e.jsx("td",{children:e.jsx(M,{bg:t.isAttended?"success":"warning",className:"p-2",children:t.isAttended?"Attended":"Pending"})}),e.jsx("td",{children:e.jsx(r,{variant:t.isAttended?"warning":"success",size:"sm",onClick:()=>o(t.userId,t.isAttended),children:t.isAttended?"Mark Absent":"Mark Present"})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-4",children:"No registrations found"})})})]})})]})})]})};V.register(W,X,Y,Z,ee,se,te);const Ve=()=>{const[g,d]=a.useState([]),[w,S]=a.useState(!1),[E,f]=a.useState(!1),[n,m]=a.useState(null),[h,l]=a.useState(!1),[N,o]=a.useState(""),[x,t]=a.useState(""),[i,v]=a.useState("events");a.useEffect(()=>{(async()=>{try{const c=await C.get("/admin/get-events");c.status===200&&d(c.data.data)}catch(c){console.error(c),o("Failed to load events"),l(!0)}})()},[]);const A=s=>{m(s),S(!0)},y=s=>{m(s),f(!0)},p=()=>{S(!1),f(!1),m(null)},O=async()=>{if(n)try{(await C.patch(`/admin/status/event/${n.id}`)).status===200&&(d(c=>c.map(b=>b.id===n.id?{...b,isFinished:!0}:b)),o("Event marked as completed!"),l(!0))}catch(s){console.error("Error updating event status:",s),o("Failed to update event status."),l(!0)}finally{p()}},q=async()=>{if(n)try{(await C.delete(`/admin/event/${n.id}`)).status===200&&(d(c=>c.filter(b=>b.id!==n.id)),o("Event deleted successfully!"),l(!0))}catch(s){console.error("Error deleting event:",s),o("Failed to delete event."),l(!0)}finally{p()}},B=g.filter(s=>s.title.toLowerCase().includes(x.toLowerCase()));return e.jsxs("div",{className:"p-4",children:[e.jsx(U,{title:"Event Management"}),e.jsx(H,{position:"top-end",className:"p-3",children:e.jsxs(u,{onClose:()=>l(!1),show:h,delay:3e3,autohide:!0,children:[e.jsx(u.Header,{className:"bg-primary text-white",children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(u.Body,{children:N})]})}),e.jsxs(I,{show:w,onHide:p,centered:!0,children:[e.jsx(L,{closeButton:!0,className:"bg-light",children:e.jsx(R,{as:"h5",children:"Confirm Completion"})}),e.jsx(P,{children:n&&e.jsxs("div",{children:[e.jsxs("p",{children:["Are you sure you want to mark"," ",e.jsxs("strong",{children:['"',n.title,'"']})," as completed?"]}),e.jsx("p",{className:"text-muted",children:'This will change the event status to "Finished".'})]})}),e.jsxs($,{children:[e.jsx(r,{variant:"outline-secondary",onClick:p,children:"Cancel"}),e.jsx(r,{variant:"primary",onClick:O,children:"Confirm"})]})]}),e.jsxs(I,{show:E,onHide:p,centered:!0,children:[e.jsx(L,{closeButton:!0,className:"bg-light",children:e.jsx(R,{as:"h5",children:"Confirm Deletion"})}),e.jsx(P,{children:n&&e.jsxs("div",{children:[e.jsxs("p",{children:["Are you sure you want to delete"," ",e.jsxs("strong",{children:['"',n.title,'"']}),"?"]}),e.jsx("p",{className:"text-danger",children:"This action cannot be undone and will permanently remove the event."})]})}),e.jsxs($,{children:[e.jsx(r,{variant:"outline-secondary",onClick:p,children:"Cancel"}),e.jsx(r,{variant:"danger",onClick:q,children:"Delete"})]})]}),e.jsxs(ae,{activeKey:i,onSelect:s=>v(s),className:"mb-3",children:[e.jsx(z,{eventKey:"events",title:"Events Management",children:e.jsx(k,{className:"shadow-sm mt-3",children:e.jsxs(F,{children:[e.jsxs(K,{className:"mb-4",children:[e.jsx(T,{md:6,className:"mb-3 mb-md-0",children:e.jsxs(_,{children:[e.jsx(G,{placeholder:"Search events...","aria-label":"Search events",value:x,onChange:s=>t(s.target.value),className:"border-end-0"}),e.jsx(r,{variant:"outline-secondary",className:"border-start-0",children:e.jsx(j,{icon:"mdi:magnify"})})]})}),e.jsx(T,{md:6,className:"text-md-end",children:e.jsxs(r,{variant:"primary",as:D,to:"/event/new",className:"px-4",children:[e.jsx(j,{icon:"mdi:plus",className:"me-2"}),"Create New Event"]})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"Title"}),e.jsx("th",{className:"text-center",children:"Date"}),e.jsx("th",{className:"text-center",children:"Location"}),e.jsx("th",{className:"text-center",children:"Timing"}),e.jsx("th",{className:"text-center",children:"Image"}),e.jsx("th",{className:"text-center",children:"Status"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsx("tbody",{children:B.length>0?B.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"align-middle",children:s.title}),e.jsx("td",{className:"align-middle",children:new Date(s.eventDate).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}),e.jsx("td",{className:"align-middle",children:s.place}),e.jsx("td",{className:"align-middle",children:s.timing}),e.jsx("td",{className:"align-middle",children:s.image?e.jsx("img",{src:s.image,alt:"Event banner",className:"rounded",style:{width:"60px",height:"60px",objectFit:"cover"}}):e.jsx("span",{className:"text-muted",children:"No image"})}),e.jsx("td",{className:"align-middle",children:e.jsx("span",{className:`badge ${s.isFinished?"bg-danger":"bg-success"} p-2`,children:s.isFinished?"Finished":"Ongoing"})}),e.jsx("td",{className:"align-middle",children:e.jsxs(ne,{children:[e.jsxs(r,{variant:"primary",size:"sm",as:D,to:`/event/edit/${s.id}`,className:"me-2",children:[e.jsx(j,{icon:"mdi:pencil",className:"me-1"}),"Edit"]}),e.jsxs(r,{variant:"info",size:"sm",onClick:()=>{m(s),v("attendance")},className:"me-2",children:[e.jsx(j,{icon:"mdi:attendance",className:"me-1"}),"Attendance"]}),e.jsxs(r,{variant:s.isFinished?"secondary":"warning",size:"sm",onClick:()=>A(s),disabled:s.isFinished,className:"me-2",children:[e.jsx(j,{icon:"mdi:check-circle",className:"me-1"}),s.isFinished?"Completed":"Complete"]}),e.jsxs(r,{variant:"danger",size:"sm",onClick:()=>y(s),children:[e.jsx(j,{icon:"mdi:trash",className:"me-1"}),"Delete"]})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-4",children:x?"No events match your search":"No events found"})})})]})})]})})}),e.jsx(z,{eventKey:"attendance",title:"Attendance Tracking",children:n?e.jsx(ie,{eventId:n.id}):e.jsx(k,{className:"shadow-sm mt-3",children:e.jsx(F,{className:"text-center py-5",children:e.jsx("h5",{children:"Please select an event from the Events Management tab"})})})})]})]})};export{Ve as default};
