import{d as q,u as z,r as x,j as e,T as F}from"./index-D9C8xGDJ.js";import{a as D}from"./api-CQpZrRPq.js";import{P as K}from"./PageTitle-CTV_nOCB.js";import{I as W}from"./IconifyIcon-B_FaLXx1.js";import{S as E}from"./Spinner-CvNOHT_H.js";import{R as c,C as t}from"./Row-DNXGtDaS.js";import{C as T}from"./Card-Bg5eLJtX.js";import{F as C}from"./Form-B7ZRRNa0.js";import{F as n,a as o}from"./FormLabel-BEDtgQcg.js";import{F as l}from"./FormControl-DWlS3GFR.js";import{B as O}from"./Button-jzwfO54I.js";import"./iconify-D7I9lgUj.js";import"./CardHeaderContext-B6CePyy5.js";import"./divWithClassName-2VyLv_7K.js";import"./FormCheck-CFPqw4o6.js";import"./FormContext-D-yD9u-c.js";import"./ElementChildren-DgCQtZUg.js";import"./Button-_Yz-NvGp.js";const me=()=>{const{id:p}=q(),j=z(),[y,v]=x.useState(!1),[G,U]=x.useState(!0),[$,g]=x.useState(!1),[R,N]=x.useState(""),[S,I]=x.useState(null),[s,A]=x.useState({name:"",email:"",phoneNumber:"",isAdmin:!1,isSuperAdmin:!1,occupation:"",employer:"",place:"",dateOfBirth:"",bloodGroup:"",kmccPosition:"",address:""});x.useEffect(()=>{(async()=>{var a,m,h,u,b,P,k,w,B;try{const f=await D.get(`/admin/users/${p}`),r=f.data.data||f.data;if(!r)throw new Error("User data not found");A({name:r.name||"",email:r.email||"",phoneNumber:r.phoneNumber||"",isAdmin:r.isAdmin||!1,isSuperAdmin:r.isSuperAdmin||!1,occupation:((a=r.profile)==null?void 0:a.occupation)||"",employer:((m=r.profile)==null?void 0:m.employer)||"",place:((h=r.profile)==null?void 0:h.place)||"",dateOfBirth:(u=r.profile)!=null&&u.dateOfBirth?new Date(r.profile.dateOfBirth).toISOString().split("T")[0]:"",bloodGroup:((b=r.profile)==null?void 0:b.bloodGroup)||"",kmccPosition:((P=r.profile)==null?void 0:P.kmccPosition)||"",address:((k=r.profile)==null?void 0:k.address)||""}),r.profileImage&&I(`data:image/jpeg;base64,${r.profileImage}`)}catch(f){console.error("Error fetching user data:",f),N(((B=(w=f.response)==null?void 0:w.data)==null?void 0:B.message)||"Failed to fetch user data"),g(!0),j("/users")}finally{U(!1)}})()},[p,j]);const L=async d=>{var m,h;d.preventDefault(),v(!0);const a=new FormData;a.append("name",s.name),a.append("email",s.email),a.append("phoneNumber",s.phoneNumber),a.append("isAdmin",s.isAdmin),a.append("isSuperAdmin",s.isSuperAdmin),a.append("occupation",s.occupation),a.append("employer",s.employer),a.append("place",s.place),a.append("dateOfBirth",s.dateOfBirth),a.append("bloodGroup",s.bloodGroup),a.append("kmccPosition",s.kmccPosition),a.append("address",s.address),d.target.profileImage.files[0]&&a.append("profileImage",d.target.profileImage.files[0]);try{await D.put(`/admin/users-with-profile/${p}`,a,{headers:{"Content-Type":"multipart/form-data"}}),N("User and profile updated successfully!"),g(!0),setTimeout(()=>j(`/users/${p}`),1500)}catch(u){console.error("Error updating user:",u),N(((h=(m=u.response)==null?void 0:m.data)==null?void 0:h.message)||"Failed to update user"),g(!0)}finally{v(!1)}},i=d=>{const{name:a,value:m,type:h,checked:u}=d.target;A(b=>({...b,[a]:h==="checkbox"?u:m}))},M=d=>{if(d.target.files&&d.target.files[0]){const a=new FileReader;a.onload=m=>{I(m.target.result)},a.readAsDataURL(d.target.files[0])}};return G?e.jsx("div",{className:"d-flex justify-content-center p-5",children:e.jsx(E,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(K,{title:"Edit User",breadcrumbItems:[{label:"Users",path:"/users"},{label:`User #${p}`,path:`/users/${p}`},{label:"Edit",active:!0}]}),e.jsx(F,{onClose:()=>g(!1),show:$,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(F.Body,{children:R})}),e.jsx(c,{children:e.jsx(t,{md:8,children:e.jsx(T,{children:e.jsx(T.Body,{children:e.jsxs(C,{onSubmit:L,encType:"multipart/form-data",children:[e.jsx(c,{children:e.jsx(t,{md:6,children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{children:"Profile Image"}),e.jsx(l,{type:"file",name:"profileImage",onChange:M,accept:"image/*"}),S&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:S,alt:"Profile Preview",className:"img-thumbnail",style:{maxWidth:"200px"}})})]})})}),e.jsx("h5",{className:"mt-4",children:"Basic Information"}),e.jsxs(c,{children:[e.jsx(t,{md:6,children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{children:"Name*"}),e.jsx(l,{type:"text",name:"name",value:s.name,onChange:i,required:!0})]})}),e.jsx(t,{md:6,children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{children:"Email"}),e.jsx(l,{type:"email",name:"email",value:s.email,onChange:i})]})})]}),e.jsxs(c,{children:[e.jsx(t,{md:6,children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{children:"Phone Number*"}),e.jsx(l,{type:"text",name:"phoneNumber",value:s.phoneNumber,onChange:i,required:!0})]})}),e.jsx(t,{md:6,children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{children:"Date of Birth"}),e.jsx(l,{type:"date",name:"dateOfBirth",value:s.dateOfBirth,onChange:i})]})})]}),e.jsx("h5",{className:"mt-4",children:"Professional Information"}),e.jsxs(c,{children:[e.jsx(t,{md:6,children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{children:"Occupation"}),e.jsx(l,{type:"text",name:"occupation",value:s.occupation,onChange:i})]})}),e.jsx(t,{md:6,children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{children:"Employer"}),e.jsx(l,{type:"text",name:"employer",value:s.employer,onChange:i})]})})]}),e.jsxs(c,{children:[e.jsx(t,{md:6,children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{children:"KMCC Position"}),e.jsx(l,{type:"text",name:"kmccPosition",value:s.kmccPosition,onChange:i})]})}),e.jsx(t,{md:6,children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{children:"Blood Group"}),e.jsx(l,{type:"text",name:"bloodGroup",value:s.bloodGroup,onChange:i})]})})]}),e.jsx("h5",{className:"mt-4",children:"Address Information"}),e.jsxs(c,{children:[e.jsx(t,{md:6,children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{children:"Place"}),e.jsx(l,{type:"text",name:"place",value:s.place,onChange:i})]})}),e.jsx(t,{md:6,children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{children:"Address"}),e.jsx(l,{type:"text",name:"address",value:s.address,onChange:i})]})})]}),e.jsx("h5",{className:"mt-4",children:"Admin Settings"}),e.jsxs(c,{children:[e.jsx(t,{md:6,children:e.jsx(n,{className:"mb-3",children:e.jsx(C.Check,{type:"checkbox",label:"Is Admin",name:"isAdmin",checked:s.isAdmin,onChange:i})})}),e.jsx(t,{md:6,children:e.jsx(n,{className:"mb-3",children:e.jsx(C.Check,{type:"checkbox",label:"Is Super Admin",name:"isSuperAdmin",checked:s.isSuperAdmin,onChange:i})})})]}),e.jsxs("div",{className:"d-flex gap-2 mt-4",children:[e.jsx(O,{variant:"secondary",onClick:()=>j(`/users/${p}`),disabled:y,children:"Cancel"}),e.jsx(O,{type:"submit",variant:"primary",disabled:y,children:y?e.jsx(E,{size:"sm",animation:"border"}):e.jsxs(e.Fragment,{children:[e.jsx(W,{icon:"mdi:content-save-outline",className:"me-1"}),"Save Changes"]})})]})]})})})})})]})};export{me as default};
