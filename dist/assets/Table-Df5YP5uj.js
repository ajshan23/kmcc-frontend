import{r,u as R,j as e,T as I}from"./index-oZOXagb6.js";import{P as q}from"./PageTitle-CDfmxWcc.js";import{a as w}from"./api-CQpZrRPq.js";import{I as P}from"./IconifyIcon-DvFk5hCx.js";import{S as G}from"./Spinner-CWr4oDD1.js";import{R as z}from"./Row-BRTb4Q3x.js";import{C as K}from"./Col-CliyWdof.js";import{C as L,a as J}from"./Card-CByQ_iKt.js";import{I as O}from"./InputGroup-CeiKs3no.js";import{F as Q}from"./FormControl-7vMxEVbB.js";import{B as i}from"./Button-BjDVT7iL.js";import{M as o}from"./Modal-B-ri6GXF.js";import"./iconify-DRmFi74x.js";import"./CardHeaderContext-DZwIQcmL.js";import"./divWithClassName-D5RmpbwJ.js";import"./FormCheckInput-BXTlCTZ2.js";import"./FormContext-Bl_nBIxk.js";import"./InputGroupContext-BYLsS1nd.js";import"./Button-B8bHFfcq.js";import"./AbstractModalHeader-ByOIaQTJ.js";import"./useWindow-uLpk0Vmg.js";import"./usePrevious-DCKX2kZU.js";import"./useEventCallback-BEJq0vfy.js";import"./hasClass-DWM9LpYO.js";import"./useMergedRefs-pn6opyZt.js";import"./NoopTransition-DgaF_Ew9.js";import"./DataKey-COGXBUcQ.js";const V="/assets/no-Ci1GeHlm.png",be=()=>{const[p,j]=r.useState([]),[u,f]=r.useState(""),[d,g]=r.useState(""),[n,l]=r.useState(1),[y,k]=r.useState(1),[h,C]=r.useState(null),[T,S]=r.useState(!1),b=R(),[D,c]=r.useState(!1),[M,m]=r.useState(""),[U,N]=r.useState(!1),E=async()=>{var s,t;try{S(!0);const a=await w.get("/admin/users",{params:{page:n,limit:10,search:d}});j(a.data.data.users),k(a.data.data.pagination.totalPages)}catch(a){console.error("Error fetching users:",a),m(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to fetch users"),c(!0)}finally{S(!1)}};r.useEffect(()=>{E()},[n,d]);const v=()=>{g(u),l(1)},B=()=>{f(""),g(""),l(1)},F=s=>{C(s),N(!0)},x=()=>{N(!1),C(null)},$=async()=>{var s,t;if(h)try{await w.delete(`/admin/users/${h}`),j(a=>a.filter(H=>H.id!==h)),m("User deleted successfully!"),c(!0)}catch(a){console.error("Error deleting user:",a),m(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to delete user"),c(!0)}finally{x()}},A=(s,t)=>{t.stopPropagation(),b(`/users/${s}/edit`)};return T?e.jsx("div",{className:"d-flex justify-content-center p-5",children:e.jsx(G,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"Users Table"}),e.jsx(I,{onClose:()=>c(!1),show:D,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(I.Body,{children:M})}),e.jsx(z,{children:e.jsx(K,{xs:12,children:e.jsx(L,{children:e.jsxs(J,{children:[e.jsx("div",{className:"d-flex justify-content-between mb-3",children:e.jsxs(O,{style:{width:"400px"},children:[e.jsx(Q,{placeholder:"Search users...",value:u,onChange:s=>f(s.target.value),onKeyPress:s=>{s.key==="Enter"&&v()}}),e.jsx(i,{variant:"outline-secondary",onClick:v,children:"Search"}),d&&e.jsx(i,{variant:"outline-danger",onClick:B,children:"Clear"})]})}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Iqama Number"}),e.jsx("th",{children:"Member ID"}),e.jsx("th",{children:"Area name"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Profile"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:p.length>0?p.map(s=>e.jsxs("tr",{className:"align-middle",onClick:()=>b(`/users/${s.id}`),children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:s.iqamaNumber}),e.jsx("td",{children:s.memberId}),e.jsx("td",{children:s.areaName}),e.jsx("td",{children:s.phoneNumber}),e.jsx("td",{children:s.profileImage?e.jsx("img",{src:`data:image/png;base64,${s.profileImage}`,alt:"Profile",className:"rounded-circle",width:"40",height:"40"}):e.jsx("img",{src:V,alt:"Profile",className:"rounded-circle",width:"40",height:"40"})}),e.jsxs("td",{children:[e.jsx(i,{variant:"primary",className:"me-2",onClick:t=>A(s.id,t),children:e.jsx(P,{icon:"mdi:pencil"})}),e.jsx(i,{variant:"danger",onClick:t=>{t.stopPropagation(),F(s.id)},children:e.jsx(P,{icon:"ri:delete-bin-4-fill"})})]})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center",children:"No users found"})})})]})}),e.jsxs("div",{className:"d-flex justify-content-between mt-3",children:[e.jsx(i,{variant:"primary",disabled:n<=1,onClick:()=>l(s=>s-1),children:"Previous"}),e.jsxs("span",{children:["Page ",n," of ",y]}),e.jsx(i,{variant:"primary",disabled:n>=y,onClick:()=>l(s=>s+1),children:"Next"})]})]})})})}),e.jsxs(o,{show:U,onHide:x,centered:!0,children:[e.jsx(o.Header,{closeButton:!0,children:e.jsx(o.Title,{children:"Delete User"})}),e.jsx(o.Body,{children:"Are you sure you want to delete this user? This action cannot be undone."}),e.jsxs(o.Footer,{children:[e.jsx(i,{variant:"secondary",onClick:x,children:"Cancel"}),e.jsx(i,{variant:"danger",onClick:$,children:"Delete"})]})]})]})};export{be as default};
