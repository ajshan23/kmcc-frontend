import{d as K,u as W,r as p,j as e,T as D}from"./index-CWxK9h8P.js";import{a as T}from"./api-CQpZrRPq.js";import{P as J}from"./PageTitle-DWsonpDE.js";import{I as Q}from"./IconifyIcon-CC4OnH-e.js";import{S as O}from"./Spinner-Dqj128jD.js";import{R as c}from"./Row-C2I4GQ41.js";import{C as n}from"./Col-BXHEcCf6.js";import{C as G}from"./Card-DZFDkilJ.js";import{F as v}from"./Form-3aqpnuqS.js";import{F as i,a as t}from"./FormLabel-CcqgsKZl.js";import{F as d}from"./FormControl-CAjNTUps.js";import{B as S}from"./Button-CQasjNBg.js";import{A as V}from"./Alert-CtcnMIOd.js";import"./iconify-BL2rH4cv.js";import"./CardHeaderContext-ijBDOs9Q.js";import"./divWithClassName-B3-UALgE.js";import"./FormCheck-BSjGQnoS.js";import"./FormContext-COJ5zA0n.js";import"./FormCheckInput-DXPhqNpk.js";import"./ElementChildren-C4XOSt_6.js";import"./Button-Rbr09trj.js";import"./hook-DSKMHYPi.js";import"./extends-CF3RwP-h.js";import"./Anchor-DTXIp3XK.js";import"./useEventCallback-FbBVX3K_.js";const ye=()=>{const{id:h}=K(),b=W(),[N,C]=p.useState(!1),[U,$]=p.useState(!0),[R,f]=p.useState(!1),[L,w]=p.useState(""),[A,I]=p.useState(null),[j,M]=p.useState(!1),[s,P]=p.useState({name:"",email:"",phoneNumber:"",isAdmin:!1,isSuperAdmin:!1,password:"",confirmPassword:"",occupation:"",employer:"",place:"",dateOfBirth:"",bloodGroup:"",kmccPosition:"",address:""});p.useEffect(()=>{(async()=>{var a,m,x,u,y,k,F,B,E;try{const g=await T.get(`/admin/users/${h}`),r=g.data.data||g.data;if(!r)throw new Error("User data not found");P({name:r.name||"",email:r.email||"",phoneNumber:r.phoneNumber||"",isAdmin:r.isAdmin||!1,isSuperAdmin:r.isSuperAdmin||!1,password:"",confirmPassword:"",occupation:((a=r.profile)==null?void 0:a.occupation)||"",employer:((m=r.profile)==null?void 0:m.employer)||"",place:((x=r.profile)==null?void 0:x.place)||"",dateOfBirth:(u=r.profile)!=null&&u.dateOfBirth?new Date(r.profile.dateOfBirth).toISOString().split("T")[0]:"",bloodGroup:((y=r.profile)==null?void 0:y.bloodGroup)||"",kmccPosition:((k=r.profile)==null?void 0:k.kmccPosition)||"",address:((F=r.profile)==null?void 0:F.address)||""}),r.profileImage&&I(`data:image/jpeg;base64,${r.profileImage}`)}catch(g){console.error("Error fetching user data:",g),w(((E=(B=g.response)==null?void 0:B.data)==null?void 0:E.message)||"Failed to fetch user data"),f(!0),b("/users")}finally{$(!1)}})()},[h,b]);const q=async l=>{var m,x;if(l.preventDefault(),C(!0),j&&s.password&&s.password!==s.confirmPassword){w("Passwords do not match"),f(!0),C(!1);return}const a=new FormData;a.append("name",s.name),a.append("email",s.email),a.append("phoneNumber",s.phoneNumber),a.append("isAdmin",s.isAdmin),a.append("isSuperAdmin",s.isSuperAdmin),s.password&&a.append("password",s.password),a.append("occupation",s.occupation),a.append("employer",s.employer),a.append("place",s.place),a.append("dateOfBirth",s.dateOfBirth),a.append("bloodGroup",s.bloodGroup),a.append("kmccPosition",s.kmccPosition),a.append("address",s.address),l.target.profileImage.files[0]&&a.append("profileImage",l.target.profileImage.files[0]);try{await T.put(`/admin/users-with-profile/${h}`,a,{headers:{"Content-Type":"multipart/form-data"}}),w("User and profile updated successfully!"),f(!0),setTimeout(()=>b(`/users/${h}`),1500)}catch(u){console.error("Error updating user:",u),w(((x=(m=u.response)==null?void 0:m.data)==null?void 0:x.message)||"Failed to update user"),f(!0)}finally{C(!1)}},o=l=>{const{name:a,value:m,type:x,checked:u}=l.target;P(y=>({...y,[a]:x==="checkbox"?u:m}))},z=l=>{if(l.target.files&&l.target.files[0]){const a=new FileReader;a.onload=m=>{I(m.target.result)},a.readAsDataURL(l.target.files[0])}},H=()=>{M(!j),j&&P(l=>({...l,password:"",confirmPassword:""}))};return U?e.jsx("div",{className:"d-flex justify-content-center p-5",children:e.jsx(O,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Edit User",breadcrumbItems:[{label:"Users",path:"/users"},{label:`User #${h}`,path:`/users/${h}`},{label:"Edit",active:!0}]}),e.jsx(D,{onClose:()=>f(!1),show:R,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(D.Body,{children:L})}),e.jsx(c,{children:e.jsx(n,{md:8,children:e.jsx(G,{children:e.jsx(G.Body,{children:e.jsxs(v,{onSubmit:q,encType:"multipart/form-data",children:[e.jsx(c,{children:e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"Profile Image"}),e.jsx(d,{type:"file",name:"profileImage",onChange:z,accept:"image/*"}),A&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:A,alt:"Profile Preview",className:"img-thumbnail",style:{maxWidth:"200px"}})})]})})}),e.jsx("h5",{className:"mt-4",children:"Basic Information"}),e.jsxs(c,{children:[e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"Name*"}),e.jsx(d,{type:"text",name:"name",value:s.name,onChange:o,required:!0})]})}),e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"Email"}),e.jsx(d,{type:"email",name:"email",value:s.email,onChange:o})]})})]}),e.jsxs(c,{children:[e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"Phone Number*"}),e.jsx(d,{type:"text",name:"phoneNumber",value:s.phoneNumber,onChange:o,required:!0})]})}),e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"Date of Birth"}),e.jsx(d,{type:"date",name:"dateOfBirth",value:s.dateOfBirth,onChange:o})]})})]}),e.jsx("div",{className:"mb-3",children:e.jsx(S,{variant:"link",onClick:H,className:"p-0",children:j?"Hide Password Fields":"Change Password"})}),j&&e.jsxs(e.Fragment,{children:[e.jsx(V,{variant:"info",className:"mb-3",children:"Leave password fields blank to keep current password"}),e.jsxs(c,{children:[e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"New Password"}),e.jsx(d,{type:"password",name:"password",value:s.password,onChange:o,placeholder:"Enter new password"})]})}),e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"Confirm Password"}),e.jsx(d,{type:"password",name:"confirmPassword",value:s.confirmPassword,onChange:o,placeholder:"Confirm new password"})]})})]})]}),e.jsx("h5",{className:"mt-4",children:"Professional Information"}),e.jsxs(c,{children:[e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"Occupation"}),e.jsx(d,{type:"text",name:"occupation",value:s.occupation,onChange:o})]})}),e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"Employer"}),e.jsx(d,{type:"text",name:"employer",value:s.employer,onChange:o})]})})]}),e.jsxs(c,{children:[e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"KMCC Position"}),e.jsx(d,{type:"text",name:"kmccPosition",value:s.kmccPosition,onChange:o})]})}),e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"Blood Group"}),e.jsx(d,{type:"text",name:"bloodGroup",value:s.bloodGroup,onChange:o})]})})]}),e.jsx("h5",{className:"mt-4",children:"Address Information"}),e.jsxs(c,{children:[e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"Place"}),e.jsx(d,{type:"text",name:"place",value:s.place,onChange:o})]})}),e.jsx(n,{md:6,children:e.jsxs(i,{className:"mb-3",children:[e.jsx(t,{children:"Address"}),e.jsx(d,{type:"text",name:"address",value:s.address,onChange:o})]})})]}),e.jsx("h5",{className:"mt-4",children:"Admin Settings"}),e.jsxs(c,{children:[e.jsx(n,{md:6,children:e.jsx(i,{className:"mb-3",children:e.jsx(v.Check,{type:"checkbox",label:"Is Admin",name:"isAdmin",checked:s.isAdmin,onChange:o})})}),e.jsx(n,{md:6,children:e.jsx(i,{className:"mb-3",children:e.jsx(v.Check,{type:"checkbox",label:"Is Super Admin",name:"isSuperAdmin",checked:s.isSuperAdmin,onChange:o})})})]}),e.jsxs("div",{className:"d-flex gap-2 mt-4",children:[e.jsx(S,{variant:"secondary",onClick:()=>b(`/users/${h}`),disabled:N,children:"Cancel"}),e.jsx(S,{type:"submit",variant:"primary",disabled:N,children:N?e.jsx(O,{size:"sm",animation:"border"}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{icon:"mdi:content-save-outline",className:"me-1"}),"Save Changes"]})})]})]})})})})})]})};export{ye as default};
