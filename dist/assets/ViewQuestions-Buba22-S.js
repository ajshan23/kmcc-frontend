import{u as R,d as k,r as o,j as e,T as M,h as P,i as A,L as B}from"./index-DKQPNifM.js";import{P as F}from"./PageTitle-CRu15oFp.js";import{a as j}from"./api-BAouzzCb.js";import{l as H}from"./logo-sm-DeRMNujR.js";import{I as f}from"./IconifyIcon-Cz5kna7C.js";import{D as $,C as L,P as z}from"./react-beautiful-dnd.esm-w1m8cl22.js";import{C as V}from"./Container-BAWR4Hsn.js";import{R as T,C as g}from"./Row-Z0t_gNsB.js";import{B as n}from"./Button-CJm9uxN6.js";import{T as G}from"./Table-CQf6JiUU.js";import{M as a}from"./Modal-DzjcU-YA.js";import"./iconify-BZ3wrvzO.js";import"./extends-CF3RwP-h.js";import"./raf-schd.esm-BiZi7Sgo.js";import"./objectSpread2-CqEmhNvY.js";import"./toPropertyKey-C9c9JG92.js";import"./tiny-invariant-BaFNuDhB.js";import"./index-8JwjhRSi.js";import"./Button-dGMJGo8F.js";import"./AbstractModalHeader-Ce9hSe-k.js";import"./useWindow-D5QcWUEp.js";import"./usePrevious-DP_BbfW8.js";import"./useEventCallback-Be3DcQW7.js";import"./hasClass-C5ui0Lxl.js";import"./useMergedRefs-DX226p1l.js";import"./NoopTransition-40k_bfUr.js";import"./DataKey-COGXBUcQ.js";import"./divWithClassName-CmLA-jjW.js";const ye=()=>{const y=R(),{id:d}=k(),[w,h]=o.useState([]),[N,b]=o.useState(!0),[D,v]=o.useState(!1),[m,C]=o.useState(null),[I,l]=o.useState(""),[Q,c]=o.useState(!1);o.useEffect(()=>{d||y("/survey"),x()},[]);const x=async()=>{b(!0);try{const s=await j.get(`/survey/surveys/${d}/questions`);if(s.status===200){const t=s.data.data.questions.sort((i,r)=>i.position-r.position);h(t)}}catch(s){console.error("Error fetching questions:",s)}b(!1)},S=s=>{C(s),v(!0)},p=()=>{v(!1),C(null)},E=async()=>{if(m){h(s=>s.filter(t=>t.id!==m));try{if((await j.delete(`/survey/question/${m}`)).status!==200)throw new Error("Failed to delete");l("Question deleted successfully!")}catch(s){console.error("Error deleting question:",s),l("Failed to delete question."),x()}finally{c(!0),p()}}},q=async s=>{if(!s.destination)return;const t=Array.from(w),[i]=t.splice(s.source.index,1);t.splice(s.destination.index,0,i),h(t);const r=t.map(u=>u.id);try{if((await j.post(`/survey/surveys/${d}/reorder-questions`,{questionIds:r})).status!==200)throw new Error("Failed to save new order");l("Question order updated successfully!"),c(!0)}catch(u){console.error("Error reordering questions:",u),x(),l("Failed to update question order."),c(!0)}};return e.jsxs(V,{className:"p-4",children:[e.jsx(F,{title:"Questions"}),e.jsxs(M,{onClose:()=>c(!1),show:Q,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(P,{children:[e.jsx("img",{src:H,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsx(A,{children:I})]}),e.jsx(T,{children:e.jsx(g,{xs:12,children:e.jsxs("div",{style:{width:"70vw",background:"white",border:"1px solid gray",padding:10,borderRadius:10},children:[e.jsxs(T,{className:"d-flex justify-content-between align-items-center p-2",children:[e.jsx(g,{xs:"auto",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search",style:{width:"250px",borderRadius:10}})}),e.jsx(g,{xs:"auto",children:e.jsx(n,{variant:"dark",style:{padding:"10px 20px",borderRadius:10},to:`/add/questions/${d}`,as:B,children:"New Questions"})})]}),N?e.jsx("p",{className:"text-center mt-3",children:"Loading questions..."}):e.jsx($,{onDragEnd:q,children:e.jsx(L,{droppableId:"questions",children:s=>e.jsxs(G,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"mt-3 text-center",...s.droppableProps,ref:s.innerRef,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Text"}),e.jsx("th",{children:"Image"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[w.map((t,i)=>e.jsx(z,{draggableId:String(t.id),index:i,children:r=>e.jsxs("tr",{ref:r.innerRef,...r.draggableProps,...r.dragHandleProps,children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(f,{icon:"mdi:drag",className:"me-2"}),i+1]})}),e.jsx("td",{children:t.type}),e.jsx("td",{children:t.text}),e.jsx("td",{children:t.image?e.jsx("img",{src:t.image,alt:"Question",style:{width:"50px",height:"auto",borderRadius:2}}):"N/A"}),e.jsx("td",{style:{verticalAlign:"middle"},children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx(n,{variant:"primary",size:"sm",onClick:()=>y(`/question/edit/${t.id}`),children:e.jsx(f,{icon:"mdi:pencil",color:"white"})}),e.jsx(n,{variant:"danger",size:"sm",onClick:()=>S(t.id),children:e.jsx(f,{icon:"ri:delete-bin-4-fill",color:"white"})})]})})]})},t.id)),s.placeholder]})]})})})]})})}),e.jsxs(a,{show:D,onHide:p,centered:!0,children:[e.jsx(a.Header,{closeButton:!0,children:e.jsx(a.Title,{children:"Delete Question"})}),e.jsx(a.Body,{children:"Are you sure you want to delete this question? This action cannot be undone."}),e.jsxs(a.Footer,{children:[e.jsx(n,{variant:"secondary",onClick:p,children:"Cancel"}),e.jsx(n,{variant:"danger",onClick:E,children:"Delete"})]})]})]})};export{ye as default};
