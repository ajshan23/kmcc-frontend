import{d as q,u as z,r as o,j as e,T as O,h as J,i as K}from"./index-DZiXj8TR.js";import{l as Q}from"./cropper-BFtYBArb.js";import{I as W}from"./IconifyIcon-BSqbF420.js";import{a as j}from"./api-CQpZrRPq.js";import{P as X}from"./PageTitle-DsU_ZpA0.js";import{l as Y}from"./logo-sm-Bq_R7RX3.js";import{R as P,C as w}from"./Row-DDbPR_EX.js";import{C as Z,a as _}from"./Card-CSmnExEW.js";import{F as s}from"./Form-BpKd490-.js";import{B as ee}from"./Button-BxiFzc-j.js";import"./iconify-DkiI8ZpJ.js";import"./CardHeaderContext-DtkFU5Q_.js";import"./divWithClassName-BB-OH6fM.js";import"./FormCheck-uCRPbm19.js";import"./FormContext-52DUx_Tc.js";import"./ElementChildren-UnnKUi4O.js";import"./FormControl-CYWbfcub.js";import"./FormLabel-DPx4Bcny.js";import"./Button-DamFSoRp.js";const Ce=()=>{const{id:p}=q(),n=!!p,G=z(),[$,i]=o.useState(!1),[H,l]=o.useState(""),[te,c]=o.useState("success"),[y,C]=o.useState(null),[m,b]=o.useState(null),[N,T]=o.useState(null),[d,I]=o.useState(null),[u,S]=o.useState(""),[h,v]=o.useState(""),[g,R]=o.useState(""),[x,E]=o.useState(""),[f,F]=o.useState("2 min read"),[L,U]=o.useState(!1),B=o.useRef(null),A=402/335;o.useEffect(()=>{n&&(async()=>{try{const a=await j.get(`/news/${p}`);if(a.status===200){const r=a.data.data||a.data;S(r.type),v(r.heading),R(r.author),E(r.body),F(r.timeToRead||"2 min read"),r.image&&(C(r.image),I(r.image)),r.authorImage&&(b(r.authorImage),T(r.authorImage))}}catch(a){console.error("Error fetching news:",a),l("Failed to load news data."),c("danger"),i(!0)}})()},[p,n]);const M=t=>{const a=t.target.files[0];if(a){const r=new FileReader;r.onload=()=>C(r.result),r.readAsDataURL(a)}},D=t=>{const a=t.target.files[0];if(a){const r=new Blob([a],{type:a.type});b(r),T(URL.createObjectURL(r))}},V=()=>{var a;const t=(a=B.current)==null?void 0:a.cropper;t&&t.getCroppedCanvas().toBlob(r=>I(r))},k=async()=>{if(!n&&!d){l("Please crop the image first."),c("danger"),i(!0);return}if(!u||!h||!g||!x||!f){l("Please fill all required fields."),c("danger"),i(!0);return}U(!0);const t=new FormData;d&&typeof d!="string"&&t.append("image",d,"news-image.png"),m&&typeof m!="string"&&t.append("authorImage",m,"author-image.png"),t.append("type",u),t.append("heading",h),t.append("author",g),t.append("body",x),t.append("timeToRead",f);try{let a;if(n?a=await j.put(`/news/${p}`,t,{headers:{"Content-Type":"multipart/form-data"}}):a=await j.post("/news",t,{headers:{"Content-Type":"multipart/form-data"}}),a.status===(n?200:201))l(`News ${n?"updated":"created"} successfully!`),c("success"),i(!0),setTimeout(()=>{G("/news")},2e3);else throw new Error(`Failed to ${n?"update":"create"} news.`)}catch(a){console.error(`Error ${n?"updating":"creating"} news:`,a),l(`Failed to ${n?"update":"create"} news. Please try again.`),c("danger"),i(!0)}finally{U(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:n?"Edit News":"New News"}),e.jsxs(O,{onClose:()=>i(!1),show:$,delay:2e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(J,{children:[e.jsx("img",{src:Y,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsx(K,{children:H})]}),e.jsx(P,{children:e.jsx(w,{xs:12,children:e.jsx(Z,{children:e.jsx(_,{children:e.jsxs(P,{children:[e.jsxs(w,{lg:9,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Upload News Image (402x335)"}),e.jsx(s.Control,{type:"file",accept:"image/*",onChange:M})]}),y&&e.jsx(e.Fragment,{children:e.jsx(Q,{src:y,style:{height:400,width:"100%"},initialAspectRatio:A,aspectRatio:A,guides:!1,crop:V,ref:B})}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Upload Author Image"}),e.jsx(s.Control,{type:"file",accept:"image/*",onChange:D}),N&&e.jsx("img",{src:N,alt:"Preview",width:150,className:"mt-3"})]})]}),e.jsxs(w,{lg:3,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Type"}),e.jsx(s.Control,{type:"text",value:u,onChange:t=>S(t.target.value),placeholder:"Enter type"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Heading"}),e.jsx(s.Control,{type:"text",value:h,onChange:t=>v(t.target.value),placeholder:"Enter heading"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Author"}),e.jsx(s.Control,{type:"text",value:g,onChange:t=>R(t.target.value),placeholder:"Enter author name"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Time to Read"}),e.jsx(s.Control,{type:"text",value:f,onChange:t=>F(t.target.value),placeholder:"e.g., 2 min read"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Body"}),e.jsx(s.Control,{as:"textarea",rows:5,value:x,onChange:t=>E(t.target.value),placeholder:"Enter news content"})]}),e.jsx(ee,{variant:"primary",className:"w-100 mt-3",onClick:k,disabled:L||!n&&!d,children:L?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),n?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{icon:n?"mdi:pencil":"mdi:upload"}),n?" Update News":" Create News"]})})]})]})})})})})]})};export{Ce as default};
