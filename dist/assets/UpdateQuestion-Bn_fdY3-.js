import{u as A,d as G,r,j as e,T as B,h as D,i as U}from"./index-D9C8xGDJ.js";import{I as m}from"./IconifyIcon-B_FaLXx1.js";import{a as T}from"./api-CQpZrRPq.js";import{P as k}from"./PageTitle-CTV_nOCB.js";import{l as H}from"./logo-sm-Bq_R7RX3.js";import{A as $}from"./Alert-DTFVWtcS.js";import{R as w,C as u}from"./Row-DNXGtDaS.js";import{C as M,a as z}from"./Card-Bg5eLJtX.js";import{F as o}from"./Form-B7ZRRNa0.js";import{B as h}from"./Button-jzwfO54I.js";import"./iconify-D7I9lgUj.js";import"./hook-C3BOm-4g.js";import"./extends-CF3RwP-h.js";import"./divWithClassName-2VyLv_7K.js";import"./Anchor-BPHPD6tX.js";import"./useEventCallback-CSjVCyuo.js";import"./Button-_Yz-NvGp.js";import"./CardHeaderContext-B6CePyy5.js";import"./FormCheck-CFPqw4o6.js";import"./FormContext-D-yD9u-c.js";import"./ElementChildren-DgCQtZUg.js";import"./FormControl-DWlS3GFR.js";import"./FormLabel-BEDtgQcg.js";const ge=()=>{const x=A(),{questionId:d}=G(),[I,g]=r.useState(!1),[j,l]=r.useState(null),[p,f]=r.useState(""),[c,y]=r.useState("text"),[i,n]=r.useState([""]),[C,v]=r.useState(0),[b,N]=r.useState(null),[q,S]=r.useState(null);r.useEffect(()=>{if(!d){x(-1);return}O()},[d]);const O=async()=>{try{const s=(await T.get(`/survey/question/${d}`)).data.data.question;f(s.text),y(s.type),v(s.position),s.type==="multiple_choice"?n(s.options||[""]):n([""]),s.image&&N(s.image)}catch(t){console.error("Error fetching question:",t),l("Failed to load question data")}},Q=t=>{y(t),t==="text"?n([""]):t==="multiple_choice"&&i.length===0&&n([""])},F=t=>{const s=t.target.files[0];if(s){S(s);const a=new FileReader;a.onload=()=>{N(a.result)},a.readAsDataURL(s)}},E=()=>{n([...i,""])},P=t=>{if(i.length>1){const s=i.filter((a,R)=>R!==t);n(s)}},_=(t,s)=>{const a=[...i];a[t]=s,n(a)},L=async()=>{if(!p.trim()){l("Question text is required");return}if(c==="multiple_choice"&&i.some(s=>!s.trim())){l("All options must be filled");return}l(null);const t=new FormData;t.append("text",p),t.append("type",c),t.append("position",C.toString()),q&&t.append("image",q),c==="multiple_choice"&&t.append("options",JSON.stringify(i.filter(s=>s.trim()!=="")));try{(await T.put(`/survey/question/${d}`,t,{headers:{"Content-Type":"multipart/form-data"}})).status===200&&(g(!0),setTimeout(()=>{x(-1)},2e3))}catch(s){console.error("Error updating question:",s),l("Failed to update question. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Edit Question"}),j&&e.jsx($,{variant:"danger",onClose:()=>l(null),dismissible:!0,children:j}),e.jsxs(B,{onClose:()=>g(!1),show:I,delay:2e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(D,{children:[e.jsx("img",{src:H,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"TECHMIN"})]}),e.jsx(U,{children:"Question updated successfully."})]}),e.jsx(w,{children:e.jsx(u,{xs:12,children:e.jsx(M,{children:e.jsx(z,{children:e.jsxs(w,{children:[e.jsxs(u,{lg:9,children:[e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Update Question Image (Optional)"}),e.jsx(o.Control,{type:"file",accept:"image/*",onChange:F})]}),b&&e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:b,alt:"Question Preview",style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"5px"}})})]}),e.jsxs(u,{lg:3,children:[e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Question Text *"}),e.jsx(o.Control,{type:"text",value:p,onChange:t=>f(t.target.value),placeholder:"Enter question",required:!0})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Question Position *"}),e.jsx(o.Control,{type:"number",value:C,onChange:t=>v(parseInt(t.target.value)||0),min:"0",required:!0})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Question Type *"}),e.jsxs(o.Control,{as:"select",value:c,onChange:t=>Q(t.target.value),children:[e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"multiple_choice",children:"Multiple Choice"})]})]}),c==="multiple_choice"&&e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Options *"}),i.map((t,s)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(o.Control,{type:"text",value:t,onChange:a=>_(s,a.target.value),placeholder:`Option ${s+1}`,required:!0}),e.jsx(h,{variant:"danger",className:"ms-2",onClick:()=>P(s),disabled:i.length<=1,children:e.jsx(m,{icon:"mdi:delete"})})]},s)),e.jsxs(h,{variant:"secondary",className:"w-100",onClick:E,children:[e.jsx(m,{icon:"mdi:plus"})," Add Option"]})]}),e.jsxs(h,{variant:"primary",className:"w-100 mt-3",onClick:L,children:[e.jsx(m,{icon:"mdi:pencil"})," Update Question"]})]})]})})})})})]})};export{ge as default};
