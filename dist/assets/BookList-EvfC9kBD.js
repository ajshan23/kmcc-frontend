import{r,j as e,T as M,h as $,i as z,L as g}from"./index-CfNT85tM.js";import{P as F}from"./PageTitle-D_HZ265t.js";import{a as w}from"./api-BAouzzCb.js";import{I as h}from"./IconifyIcon-0D5ZULyN.js";import{l as R}from"./logo-sm-DeRMNujR.js";import{R as H,C as U}from"./Row-pUvplkm2.js";import{C as v}from"./Card-BxC9ygCX.js";import{B as i}from"./Button-DmtmunvM.js";import{T as K}from"./Table-DAjJSobz.js";import{P as l}from"./Pagination-mI0TYWHu.js";import{M as m}from"./Modal-xL1nFGJh.js";import"./iconify-Dnpwx_79.js";import"./CardBody-TiP-bp9B.js";import"./CardHeaderContext-DMh6jMut.js";import"./divWithClassName-MTQsKDs0.js";import"./Button-AVmPP0NH.js";import"./Anchor-Kzj3Lb_I.js";import"./useEventCallback-B2meNR0i.js";import"./AbstractModalHeader-o6WA7pR6.js";import"./useWindow-BmY1pYqs.js";import"./usePrevious-TUyZfySc.js";import"./hasClass-BQeUoxnv.js";import"./useMergedRefs-eYDo2WSS.js";import"./NoopTransition-BANWBBX8.js";import"./DataKey-COGXBUcQ.js";const ue=()=>{const[N,y]=r.useState([]),[b,x]=r.useState(!1),[a,k]=r.useState(null),[B,d]=r.useState(!1),[S,j]=r.useState(""),[T,C]=r.useState(!0),[o,A]=r.useState(1),[u,P]=r.useState(1),[f,O]=r.useState(10);r.useEffect(()=>{(async()=>{try{C(!0);const s=await w.get(`/book?page=${o}&limit=${f}`);s.status===200&&(y(s.data.data.books),P(s.data.data.totalPages))}catch(s){console.error("Error fetching books:",s),j("Failed to load books"),d(!0)}finally{C(!1)}})()},[o,f]);const L=t=>{k(t),x(!0)},D=async()=>{if(a)try{await w.delete(`/book/${a.id}`),y(t=>t.filter(s=>s.id!==a.id)),j("Book deleted successfully!"),d(!0)}catch(t){console.error("Error deleting book:",t),j("Failed to delete book"),d(!0)}finally{x(!1),k(null)}},c=t=>{A(t)},E=async(t,s)=>{try{const p=await w.get(`/book/${t}/download`,{responseType:"blob"});if(!p.data)throw new Error("No data received");const I=window.URL.createObjectURL(new Blob([p.data])),n=document.createElement("a");n.href=I,n.setAttribute("download",`${s||"book"}.pdf`),document.body.appendChild(n),n.click(),n.parentNode.removeChild(n)}catch(p){console.error("Error downloading book:",p),j("Failed to download book"),d(!0)}};return T?e.jsx("div",{className:"d-flex justify-content-center p-5",children:"Loading..."}):e.jsxs("div",{className:"d-flex p-4",children:[e.jsx(F,{title:"Books"}),e.jsxs(M,{onClose:()=>d(!1),show:B,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs($,{children:[e.jsx("img",{src:R,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"KMCC"})]}),e.jsx(z,{children:S})]}),e.jsx(H,{className:"w-100",children:e.jsx(U,{xs:12,children:e.jsx(v,{children:e.jsxs(v.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h4",{children:"Books Management"}),e.jsxs(i,{variant:"primary",as:g,to:"/book/new",children:[e.jsx(h,{icon:"mdi:plus",className:"me-1"}),"Add New Book"]})]}),e.jsxs(K,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Cover"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Author"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Added"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:N.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:(o-1)*f+s+1}),e.jsx("td",{children:t.coverImage?e.jsx("img",{src:t.coverImage,alt:t.title,style:{height:"50px"}}):e.jsx("span",{className:"text-muted",children:"No cover"})}),e.jsx("td",{children:t.title||"N/A"}),e.jsx("td",{children:t.author||"N/A"}),e.jsx("td",{children:t.description?`${t.description.substring(0,50)}...`:"No description"}),e.jsx("td",{children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A"}),e.jsxs("td",{children:[e.jsx(i,{variant:"info",size:"sm",className:"me-2",as:g,to:`/book/${t.id}`,children:e.jsx(h,{icon:"mdi:eye",color:"white"})}),e.jsx(i,{variant:"primary",size:"sm",className:"me-2",as:g,to:`/book/edit/${t.id}`,children:e.jsx(h,{icon:"mdi:pencil",color:"white"})}),e.jsx(i,{variant:"success",size:"sm",className:"me-2",onClick:()=>E(t.id,t.title),children:e.jsx(h,{icon:"mdi:download",color:"white"})}),e.jsx(i,{variant:"danger",size:"sm",onClick:()=>L(t),children:e.jsx(h,{icon:"mdi:delete",color:"white"})})]})]},t.id))})]}),e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsxs(l,{children:[e.jsx(l.First,{onClick:()=>c(1),disabled:o===1}),e.jsx(l.Prev,{onClick:()=>c(o-1),disabled:o===1}),Array.from({length:u},(t,s)=>s+1).map(t=>e.jsx(l.Item,{active:t===o,onClick:()=>c(t),children:t},t)),e.jsx(l.Next,{onClick:()=>c(o+1),disabled:o===u}),e.jsx(l.Last,{onClick:()=>c(u),disabled:o===u})]})})]})})})}),e.jsxs(m,{show:b,onHide:()=>x(!1),centered:!0,children:[e.jsx(m.Header,{closeButton:!0,children:e.jsx(m.Title,{children:"Delete Book"})}),e.jsxs(m.Body,{children:['Are you sure you want to delete "',a==null?void 0:a.title,'"? This action cannot be undone.']}),e.jsxs(m.Footer,{children:[e.jsx(i,{variant:"secondary",onClick:()=>x(!1),children:"Cancel"}),e.jsx(i,{variant:"danger",onClick:D,children:"Delete"})]})]})]})};export{ue as default};
