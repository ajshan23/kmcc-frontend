import{r as a,u as F,j as e,T as C}from"./index-tbORj_h7.js";import{P as $}from"./PageTitle-B5UZOk6x.js";import{a as N}from"./api-BWS4aRsM.js";import{I as S}from"./IconifyIcon-DNveIdU0.js";import{S as H}from"./Spinner-i65u_QRX.js";import{R,C as q}from"./Row-BAKXF0E5.js";import{C as A}from"./Card-CS7mEMRp.js";import{C as z}from"./CardBody-DNeWABbn.js";import{B as i}from"./Button-Bd2MDoO7.js";import{M as o}from"./Modal-CvkZUMz4.js";import"./iconify-C4gxA2ZK.js";import"./CardHeaderContext-DmhcPj-M.js";import"./divWithClassName-B7qpIybN.js";import"./Button-DIcN3Qge.js";import"./AbstractModalHeader-CyNFVtV3.js";import"./useWindow-qyDVknU7.js";import"./usePrevious-Bxq2cH5n.js";import"./useEventCallback-BPutPn65.js";import"./hasClass-BSEzL-da.js";import"./useMergedRefs-ChrblFYH.js";import"./NoopTransition-CMRoOKHe.js";import"./DataKey-COGXBUcQ.js";const G="/assets/no-Ci1GeHlm.png",he=()=>{const[x,p]=a.useState([]),[d,v]=a.useState(""),[n,j]=a.useState(1),[u,w]=a.useState(1),[c,f]=a.useState(null),[P,g]=a.useState(!1),y=F(),[I,l]=a.useState(!1),[T,h]=a.useState(""),[k,b]=a.useState(!1),D=async()=>{var s,t;try{g(!0);const r=await N.get("/admin/users",{params:{page:n,limit:10,search:d}});p(r.data.data.users),w(r.data.data.pagination.totalPages)}catch(r){console.error("Error fetching users:",r),h(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to fetch users"),l(!0)}finally{g(!1)}};a.useEffect(()=>{D()},[n,d]);const M=s=>{f(s),b(!0)},m=()=>{b(!1),f(null)},U=async()=>{var s,t;if(c)try{await N.delete(`/admin/users/${c}`),p(r=>r.filter(E=>E.id!==c)),h("User deleted successfully!"),l(!0)}catch(r){console.error("Error deleting user:",r),h(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to delete user"),l(!0)}finally{m()}},B=(s,t)=>{t.stopPropagation(),y(`/users/${s}/edit`)};return P?e.jsx("div",{className:"d-flex justify-content-center p-5",children:e.jsx(H,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Users Table"}),e.jsx(C,{onClose:()=>l(!1),show:I,delay:5e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(C.Body,{children:T})}),e.jsx(R,{children:e.jsx(q,{xs:12,children:e.jsx(A,{children:e.jsxs(z,{children:[e.jsx("div",{className:"d-flex justify-content-between mb-3",children:e.jsx("input",{type:"text",placeholder:"Search users...",className:"form-control w-25",value:d,onChange:s=>v(s.target.value)})}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Iqama Number"}),e.jsx("th",{children:"Member ID"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Profile"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:x.length>0?x.map(s=>e.jsxs("tr",{className:"align-middle",onClick:()=>y(`/users/${s.id}`),children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:s.iqamaNumber}),e.jsx("td",{children:s.memberId}),e.jsx("td",{children:s.phoneNumber}),e.jsx("td",{children:s.profileImage?e.jsx("img",{src:`data:image/png;base64,${s.profileImage}`,alt:"Profile",className:"rounded-circle",width:"40",height:"40"}):e.jsx("img",{src:G,alt:"Profile",className:"rounded-circle",width:"40",height:"40"})}),e.jsxs("td",{children:[e.jsx(i,{variant:"primary",className:"me-2",onClick:t=>B(s.id,t),children:e.jsx(S,{icon:"mdi:pencil"})}),e.jsx(i,{variant:"danger",onClick:t=>{t.stopPropagation(),M(s.id)},children:e.jsx(S,{icon:"ri:delete-bin-4-fill"})})]})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center",children:"No users found"})})})]})}),e.jsxs("div",{className:"d-flex justify-content-between mt-3",children:[e.jsx(i,{variant:"primary",disabled:n<=1,onClick:()=>j(s=>s-1),children:"Previous"}),e.jsxs("span",{children:["Page ",n," of ",u]}),e.jsx(i,{variant:"primary",disabled:n>=u,onClick:()=>j(s=>s+1),children:"Next"})]})]})})})}),e.jsxs(o,{show:k,onHide:m,centered:!0,children:[e.jsx(o.Header,{closeButton:!0,children:e.jsx(o.Title,{children:"Delete User"})}),e.jsx(o.Body,{children:"Are you sure you want to delete this user? This action cannot be undone."}),e.jsxs(o.Footer,{children:[e.jsx(i,{variant:"secondary",onClick:m,children:"Cancel"}),e.jsx(i,{variant:"danger",onClick:U,children:"Delete"})]})]})]})};export{he as default};
