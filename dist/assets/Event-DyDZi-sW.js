import{r as a,j as e,k as ie,T as A,L as X}from"./index-tNgA7nGT.js";import{a as P}from"./api-CQpZrRPq.js";import{I as T}from"./IconifyIcon-s9Hyo8eO.js";import{P as re}from"./PageTitle-CCkfjASR.js";import{d as oe}from"./index-CNqD8Tqu.js";import{C as q,a as J}from"./Card-B1tYBRGQ.js";import{R as Q}from"./Row-RifMysLS.js";import{C as D}from"./Col-CnORAU6q.js";import{I as le}from"./InputGroup-sUvZEEcM.js";import{F as W}from"./FormControl-CbvVdWru.js";import{B as h}from"./Button-CENta7Bz.js";import{S as Y}from"./Spinner-DN05z5fI.js";import{B as G}from"./Badge-6r31o3T3.js";import{F as ce}from"./Form-Dv6oRs5P.js";import{T as de}from"./Table-CZGqjMOQ.js";import{P as d}from"./Pagination-BJbfZPRG.js";import{C as me,a as he,L as xe,B as pe,p as ue,b as je,c as ge,A as fe}from"./chart-BpwFQqEG.js";import{M as Z,a as ee,b as se,c as te,d as ae}from"./Modal-XWv4zo73.js";import{T as ve}from"./Tabs-qynbnIdM.js";import{T as ne}from"./Tab-DVJMANYP.js";import{B as Ne}from"./ButtonGroup-DNdwwmdg.js";import"./iconify-RXcx2lhF.js";import"./CardHeaderContext-BtYRO3IT.js";import"./divWithClassName-BkIstr-m.js";import"./FormCheckInput-B2vMIfyo.js";import"./FormContext-DD_I2OzJ.js";import"./InputGroupContext-DdlMQU-e.js";import"./Button-CXeEohPr.js";import"./FormCheck-Bgt48iIR.js";import"./ElementChildren-DV_13d0k.js";import"./FormLabel-C90nlSEw.js";import"./Anchor-D9YqaxLu.js";import"./useEventCallback-pYaJC5nB.js";import"./AbstractModalHeader-_KRINFje.js";import"./useWindow-BY7h8nM3.js";import"./usePrevious-BewAhWrh.js";import"./hasClass-B91NjqlQ.js";import"./useMergedRefs-CqwwmTTk.js";import"./NoopTransition-CWzBALoK.js";import"./DataKey-COGXBUcQ.js";import"./hook-BrFPO8J7.js";import"./extends-CF3RwP-h.js";import"./TabPane-BIM7X7il.js";import"./Nav-vMb328M1.js";import"./NavContext-Df65UCKh.js";import"./NavItem-YpGF5LpO.js";import"./NavbarContext-C1NhEY_6.js";import"./NavLink-DhcuRsms.js";const be=({eventId:y})=>{const[g,B]=a.useState([]),[R,$]=a.useState(!0),[U,o]=a.useState(""),[S,f]=a.useState(!1),[v,C]=a.useState(""),[u,j]=a.useState(1),[M]=a.useState(10),[E,z]=a.useState("all"),[n,O]=a.useState(!1),c=a.useCallback(async()=>{try{$(!0);const t=await P.get(`/admin/events/${y}/registrations`);t.status===200&&B(t.data.data.registrations||[])}catch(t){console.error("Error fetching registrations:",t),C("Failed to load registrations"),f(!0)}finally{$(!1)}},[y]);a.useEffect(()=>{c()},[c]);const V=oe(t=>{o(t),j(1)},300),w=async()=>{var t,i;try{const m=await P.get(`/admin/events/${y}/registrations/download`,{responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}),p=new Blob([m.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),N=window.URL.createObjectURL(p),b=document.createElement("a");b.href=N;let s=`event_registrations_${y}.xlsx`;const r=m.headers["content-disposition"];if(r){const l=r.match(/filename="?(.+)"?/);l&&l[1]&&(s=decodeURIComponent(l[1]))}b.setAttribute("download",s),document.body.appendChild(b),b.click(),window.URL.revokeObjectURL(N),b.parentNode.removeChild(b),C("Registrations exported successfully"),f(!0)}catch(m){console.error("Error exporting registrations:",m),C(((i=(t=m.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to export registration data"),f(!0)}},K=async(t,i)=>{try{(await P.patch(`/admin/events/${y}/attendance`,{userId:t,isAttended:!i})).status===200&&(B(p=>p.map(N=>N.userId===t?{...N,isAttended:!i}:N)),C("Attendance updated successfully"),f(!0))}catch(m){console.error("Error updating attendance:",m),C("Failed to update attendance"),f(!0)}},F=g.filter(t=>{const i=t.user.name.toLowerCase().includes(U.toLowerCase()),m=E==="all"||E==="attended"&&t.isAttended||E==="pending"&&!t.isAttended;return i&&m}),I=u*M,_=I-M,H=F.slice(_,I),x=Math.ceil(F.length/M);return e.jsxs("div",{className:"p-4",children:[e.jsx(re,{title:"Event Attendance"}),e.jsx(ie,{position:"top-end",className:"p-3",children:e.jsxs(A,{onClose:()=>f(!1),show:S,delay:3e3,autohide:!0,children:[e.jsx(A.Header,{children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(A.Body,{children:v})]})}),e.jsx(q,{className:"shadow-sm",children:e.jsxs(J,{children:[e.jsxs(Q,{className:"mb-4",children:[e.jsx(D,{md:6,children:e.jsxs(le,{children:[e.jsx(W,{placeholder:"Search attendees...",onChange:t=>V(t.target.value)}),e.jsx(h,{variant:"primary",onClick:w,disabled:g.length===0||n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(Y,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),e.jsx("span",{className:"ms-2",children:"Downloading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-download me-1"})," Download Excel"]})})]})}),e.jsxs(D,{md:6,className:"text-md-end",children:[e.jsxs(G,{bg:"info",className:"p-2",children:["Total Registered: ",g.length]}),e.jsxs(G,{bg:"success",className:"p-2 ms-2",children:["Attended: ",g.filter(t=>t.isAttended).length]})]})]}),e.jsx(Q,{className:"mb-3",children:e.jsx(D,{md:3,children:e.jsxs(ce.Select,{value:E,onChange:t=>{z(t.target.value),j(1)},children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"attended",children:"Attended"}),e.jsx("option",{value:"pending",children:"Pending"})]})})}),R?e.jsx("div",{className:"text-center py-4",children:e.jsx(Y,{animation:"border",variant:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(de,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Member ID"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:H.length>0?H.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{children:_+i+1}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[t.user.profileImage&&e.jsx("img",{src:`data:image/jpeg;base64,${t.user.profileImage}`,alt:"Profile",className:"rounded-circle me-2",style:{width:"30px",height:"30px"}}),t.user.name]})}),e.jsx("td",{children:t.user.memberId}),e.jsx("td",{children:t.user.phoneNumber}),e.jsx("td",{children:e.jsx(G,{bg:t.isAttended?"success":"warning",className:"p-2",children:t.isAttended?"Attended":"Pending"})}),e.jsx("td",{children:e.jsx(h,{variant:t.isAttended?"warning":"success",size:"sm",onClick:()=>K(t.userId,t.isAttended),children:t.isAttended?"Mark Absent":"Mark Present"})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-4",children:"No registrations found"})})})]})}),x>1&&e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsxs(d,{children:[e.jsx(d.Prev,{onClick:()=>j(t=>Math.max(1,t-1)),disabled:u===1}),Array.from({length:x},(t,i)=>e.jsx(d.Item,{active:i+1===u,onClick:()=>j(i+1),children:i+1},i+1)),e.jsx(d.Next,{onClick:()=>j(t=>Math.min(x,t+1)),disabled:u===x})]})})]})]})})]})};me.register(he,xe,pe,ue,je,ge,fe);const js=()=>{const[y,g]=a.useState([]),[B,R]=a.useState(!1),[$,U]=a.useState(!1),[o,S]=a.useState(null),[f,v]=a.useState(!1),[C,u]=a.useState(""),[j,M]=a.useState(""),[E,z]=a.useState("events"),[n,O]=a.useState(1),[c,V]=a.useState(1),[w,K]=a.useState(10),[F,I]=a.useState(0);a.useEffect(()=>{(async()=>{try{const r=await P.get(`/admin/get-events?page=${n}&limit=${w}`);r.status===200&&(g(r.data.data),I(r.data.totalEvents),V(r.data.totalPages))}catch(r){console.error(r),u("Failed to load events"),v(!0)}})()},[n,w]);const _=s=>{S(s),R(!0)},H=s=>{S(s),U(!0)},x=()=>{R(!1),U(!1),S(null)},t=async()=>{if(o)try{(await P.patch(`/admin/status/event/${o.id}`)).status===200&&(g(r=>r.map(l=>l.id===o.id?{...l,isFinished:!0}:l)),u("Event marked as completed!"),v(!0))}catch(s){console.error("Error updating event status:",s),u("Failed to update event status."),v(!0)}finally{x()}},i=async()=>{if(o)try{(await P.delete(`/admin/event/${o.id}`)).status===200&&(g(r=>r.filter(l=>l.id!==o.id)),I(r=>r-1),u("Event deleted successfully!"),v(!0))}catch(s){console.error("Error deleting event:",s),u("Failed to delete event."),v(!0)}finally{x()}},m=y.filter(s=>s.title.toLowerCase().includes(j.toLowerCase())),p=s=>{O(s)},N=s=>{K(Number(s.target.value)),O(1)},b=()=>{let s=[],l=Math.max(1,n-Math.floor(2.5)),L=Math.min(c,l+5-1);L-l+1<5&&(l=Math.max(1,L-5+1)),l>1&&(s.push(e.jsx(d.Item,{active:n===1,onClick:()=>p(1),children:"1"},1)),l>2&&s.push(e.jsx(d.Ellipsis,{},"start-ellipsis")));for(let k=l;k<=L;k++)s.push(e.jsx(d.Item,{active:k===n,onClick:()=>p(k),children:k},k));return L<c&&(L<c-1&&s.push(e.jsx(d.Ellipsis,{},"end-ellipsis")),s.push(e.jsx(d.Item,{active:c===n,onClick:()=>p(c),children:c},c))),s};return e.jsxs("div",{className:"p-4",children:[e.jsx(re,{title:"Event Management"}),e.jsx(ie,{position:"top-end",className:"p-3",children:e.jsxs(A,{onClose:()=>v(!1),show:f,delay:3e3,autohide:!0,children:[e.jsx(A.Header,{className:"bg-primary text-white",children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(A.Body,{children:C})]})}),e.jsxs(Z,{show:B,onHide:x,centered:!0,children:[e.jsx(ee,{closeButton:!0,className:"bg-light",children:e.jsx(se,{as:"h5",children:"Confirm Completion"})}),e.jsx(te,{children:o&&e.jsxs("div",{children:[e.jsxs("p",{children:["Are you sure you want to mark"," ",e.jsxs("strong",{children:['"',o.title,'"']})," as completed?"]}),e.jsx("p",{className:"text-muted",children:'This will change the event status to "Finished".'})]})}),e.jsxs(ae,{children:[e.jsx(h,{variant:"outline-secondary",onClick:x,children:"Cancel"}),e.jsx(h,{variant:"primary",onClick:t,children:"Confirm"})]})]}),e.jsxs(Z,{show:$,onHide:x,centered:!0,children:[e.jsx(ee,{closeButton:!0,className:"bg-light",children:e.jsx(se,{as:"h5",children:"Confirm Deletion"})}),e.jsx(te,{children:o&&e.jsxs("div",{children:[e.jsxs("p",{children:["Are you sure you want to delete"," ",e.jsxs("strong",{children:['"',o.title,'"']}),"?"]}),e.jsx("p",{className:"text-danger",children:"This action cannot be undone and will permanently remove the event."})]})}),e.jsxs(ae,{children:[e.jsx(h,{variant:"outline-secondary",onClick:x,children:"Cancel"}),e.jsx(h,{variant:"danger",onClick:i,children:"Delete"})]})]}),e.jsxs(ve,{activeKey:E,onSelect:s=>z(s),className:"mb-3",children:[e.jsx(ne,{eventKey:"events",title:"Events Management",children:e.jsx(q,{className:"shadow-sm mt-3",children:e.jsxs(J,{children:[e.jsxs(Q,{className:"mb-4",children:[e.jsx(D,{md:6,className:"mb-3 mb-md-0",children:e.jsxs(le,{children:[e.jsx(W,{placeholder:"Search events...","aria-label":"Search events",value:j,onChange:s=>M(s.target.value),className:"border-end-0"}),e.jsx(h,{variant:"outline-secondary",className:"border-start-0",children:e.jsx(T,{icon:"mdi:magnify"})})]})}),e.jsx(D,{md:6,className:"text-md-end",children:e.jsxs("div",{className:"d-flex justify-content-md-end align-items-center",children:[e.jsx("div",{className:"me-3",children:e.jsxs(W,{as:"select",value:w,onChange:N,style:{width:"80px"},children:[e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"})]})}),e.jsxs(h,{variant:"primary",as:X,to:"/event/new",className:"px-4",children:[e.jsx(T,{icon:"mdi:plus",className:"me-2"}),"Create New Event"]})]})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"Title"}),e.jsx("th",{className:"text-center",children:"Date"}),e.jsx("th",{className:"text-center",children:"Location"}),e.jsx("th",{className:"text-center",children:"Timing"}),e.jsx("th",{className:"text-center",children:"Image"}),e.jsx("th",{className:"text-center",children:"Status"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsx("tbody",{children:m.length>0?m.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"align-middle",children:s.title}),e.jsx("td",{className:"align-middle",children:new Date(s.eventDate).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}),e.jsx("td",{className:"align-middle",children:s.place}),e.jsx("td",{className:"align-middle",children:s.timing}),e.jsx("td",{className:"align-middle",children:s.image?e.jsx("img",{src:s.image,alt:"Event banner",className:"rounded",style:{width:"60px",height:"60px",objectFit:"cover"}}):e.jsx("span",{className:"text-muted",children:"No image"})}),e.jsx("td",{className:"align-middle",children:e.jsx("span",{className:`badge ${s.isFinished?"bg-danger":"bg-success"} p-2`,children:s.isFinished?"Finished":"Ongoing"})}),e.jsx("td",{className:"align-middle",children:e.jsxs(Ne,{children:[e.jsxs(h,{variant:"primary",size:"sm",as:X,to:`/event/edit/${s.id}`,className:"me-2",children:[e.jsx(T,{icon:"mdi:pencil",className:"me-1"}),"Edit"]}),e.jsxs(h,{variant:"info",size:"sm",onClick:()=>{S(s),z("attendance")},className:"me-2",children:[e.jsx(T,{icon:"mdi:attendance",className:"me-1"}),"Attendance"]}),e.jsxs(h,{variant:s.isFinished?"secondary":"warning",size:"sm",onClick:()=>_(s),disabled:s.isFinished,className:"me-2",children:[e.jsx(T,{icon:"mdi:check-circle",className:"me-1"}),s.isFinished?"Completed":"Complete"]}),e.jsxs(h,{variant:"danger",size:"sm",onClick:()=>H(s),children:[e.jsx(T,{icon:"mdi:trash",className:"me-1"}),"Delete"]})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-4",children:j?"No events match your search":"No events found"})})})]})}),c>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",(n-1)*w+1," to"," ",Math.min(n*w,F)," of ",F," ","events"]}),e.jsxs(d,{children:[e.jsx(d.First,{onClick:()=>p(1),disabled:n===1}),e.jsx(d.Prev,{onClick:()=>p(n-1),disabled:n===1}),b(),e.jsx(d.Next,{onClick:()=>p(n+1),disabled:n===c}),e.jsx(d.Last,{onClick:()=>p(c),disabled:n===c})]})]})]})})}),e.jsx(ne,{eventKey:"attendance",title:"Attendance Tracking",children:o?e.jsx(be,{eventId:o.id}):e.jsx(q,{className:"shadow-sm mt-3",children:e.jsx(J,{className:"text-center py-5",children:e.jsx("h5",{children:"Please select an event from the Events Management tab"})})})})]})]})};export{js as default};
