import{r as h,u as y,j as e,c as w,a as v,b as I,d as P,e as C}from"./index-DPuNUjLg.js";import{A as L}from"./AuthLogo-C62iluI5.js";import{u as A}from"./index.esm-BGPypC2k.js";import{o as F}from"./yup-p56DkpSN.js";import{c as R,a as f}from"./index.esm-vvsj6C9x.js";import{T as $}from"./TextFormInput-BfghELSI.js";import{P as q}from"./PasswordFormInput-CvTy-06b.js";import{F as T}from"./Form-LPEeaXcj.js";import{B as k}from"./Button-BnjsKorX.js";import{a as B}from"./auth-img-Z-U4pW7a.js";import{C as D}from"./Container-CGStooxB.js";import{R as x,C as u}from"./Row-CcHO1i0D.js";import{C as E}from"./Card-BZ6UHl2I.js";import"./logo-CpTU3YbV.js";import"./logo-dark-4y3Tdk85.js";import"./FormContext-BlvwWdud.js";import"./FormLabel-B_CILb4g.js";import"./FormControl-bLwLOBBO.js";import"./IconifyIcon-CRmgpD-A.js";import"./iconify-CwHMartp.js";import"./FormCheck-KaS-eO03.js";import"./ElementChildren-ChJp8XjW.js";import"./Button-CXwj5S0n.js";import"./CardBody-CGT1fL4u.js";import"./CardHeaderContext-DMcAJQTf.js";import"./divWithClassName-CR8nEuA8.js";const j=h.forwardRef(({bsPrefix:r,variant:a,animation:c="border",size:t,as:l="div",className:o,...n},d)=>{r=y(r,"spinner");const i=`${r}-${c}`;return e.jsx(l,{ref:d,...n,className:w(o,i,t&&`${i}-${t}`,a&&`text-${a}`)})});j.displayName="Spinner";const M=R({identifier:f().required("Please enter your Iqama Number or Member ID"),password:f().required("Please enter your password")}),O=()=>{const[r,a]=h.useState(!1),c=v(),[t]=I(),{saveSession:l}=P(),{showNotification:o}=C(),{control:n,handleSubmit:d}=A({resolver:F(M),defaultValues:{identifier:"",password:""}}),i=async N=>{var g;a(!0);try{console.log("Sending login request...");const m=await fetch("http://13.203.184.112:3000/api/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)}),s=await m.json();if(console.log("API Response:",s),m.ok&&(s!=null&&s.success)&&((g=s==null?void 0:s.data)!=null&&g.token)){console.log("Login successful!");const{user:p,token:b}=s.data;if(!p.isAdmin&&!p.isSuperAdmin){o({message:"Access denied! You are not an admin.",variant:"danger"});return}l({token:b,user:p}),o({message:"Successfully logged in. Redirecting....",variant:"success"});const S=t.get("redirectTo")||"/";setTimeout(()=>c(S),500)}else console.error("Unexpected Response Structure:",s),o({message:s.message||"Unexpected response. Please try again.",variant:"danger"})}catch(m){console.error("Login error:",m),o({message:"Login failed. Please try again.",variant:"danger"})}finally{a(!1)}};return e.jsxs(T,{onSubmit:d(i),children:[e.jsx($,{name:"identifier",control:n,label:"Iqama Number or Member ID"}),e.jsx(q,{name:"password",control:n,label:"Password"}),e.jsx(k,{type:"submit",disabled:r,className:"w-100 mt-3",children:r?e.jsx(j,{animation:"border",size:"sm"}):"Sign In"})]})},ue=()=>e.jsx("div",{className:"account-pages p-sm-5 position-relative",children:e.jsx(D,{children:e.jsx(x,{className:"justify-content-center",children:e.jsx(u,{xxl:9,lg:11,children:e.jsx(E,{className:"overflow-hidden",children:e.jsxs(x,{className:"g-0",children:[e.jsx(u,{lg:6,children:e.jsxs("div",{className:"d-flex flex-column h-100",children:[e.jsx(L,{}),e.jsxs("div",{className:"p-4 my-auto text-center",children:[e.jsx("h4",{className:"fs-20",children:"Sign In"}),e.jsx("p",{className:"text-muted mb-4",children:"Enter your Iqama Number or Member ID and password to access your account."}),e.jsx(O,{})]})]})}),e.jsx(u,{lg:6,className:"d-none d-lg-block",children:e.jsx("img",{src:B,alt:"image",className:"img-fluid rounded h-100"})})]})})})})})});export{ue as default};
