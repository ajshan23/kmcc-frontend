import{d as Y,r as i,j as e,T as W}from"./index-tbORj_h7.js";import{a as b}from"./api-BWS4aRsM.js";import{P as B}from"./PageTitle-B5UZOk6x.js";import"./iconify-C4gxA2ZK.js";import{R as N,C as g}from"./Row-BAKXF0E5.js";import{C as y}from"./Card-CS7mEMRp.js";import{F as o}from"./Form-CDi93_SM.js";import{B as z}from"./Button-Bd2MDoO7.js";import{S as R}from"./Spinner-i65u_QRX.js";import{T as q}from"./Table-B3nz3hZ0.js";import{B as E}from"./Badge-BRCL_N-i.js";import"./CardBody-DNeWABbn.js";import"./CardHeaderContext-DmhcPj-M.js";import"./divWithClassName-B7qpIybN.js";import"./FormCheck-D22FGpr8.js";import"./FormContext-DSTfdlBC.js";import"./ElementChildren-DWy4EH4n.js";import"./FormControl-Df9JJE9i.js";import"./FormLabel-D96uhRXc.js";import"./Button-DIcN3Qge.js";const ie=()=>{const{programId:c}=Y(),[d,A]=i.useState(null),[v,p]=i.useState(!1),[C,m]=i.useState(!1),[M,h]=i.useState(""),[D,w]=i.useState([]),[u,I]=i.useState([]),[s,x]=i.useState({month:"",year:new Date().getFullYear(),lotId:"",prizeAmount:""}),S=["January","February","March","April","May","June","July","August","September","October","November","December"];i.useEffect(()=>{(async()=>{p(!0);try{const[r,a]=await Promise.all([b.get(`/gold/${c}`),b.get(`/gold/${c}/lots?eligibleOnly=true`)]);A(r.data.data),I(r.data.data.winners||[]);const l=new Set((r.data.data.winners||[]).map(n=>n.lotId));w(a.data.data.filter(n=>!l.has(n.id)))}catch(r){console.error("Error fetching data:",r),h("Failed to load program data"),m(!0)}finally{p(!1)}})()},[c]);const F=async t=>{var a,l;if(t.preventDefault(),!s.month||!s.lotId||!s.year){h("Month, year and lot selection are required"),m(!0);return}if(u.find(n=>n.month===parseInt(s.month)&&n.year===parseInt(s.year))){h("This month/year combination already has a winner"),m(!0);return}p(!0);try{const n=await b.post("/gold/winners",{programId:c,winners:[{...s,month:parseInt(s.month),year:parseInt(s.year)}]});I([...u,...n.data.data]),w(T=>T.filter(P=>P.id!==parseInt(s.lotId))),h("Winner added successfully!"),x({month:"",year:new Date().getFullYear(),lotId:"",prizeAmount:""})}catch(n){h(((l=(a=n.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to add winner"),m(!0)}finally{p(!1)}},f=[...new Set(u.map(t=>t.year))].sort((t,r)=>r-t),[j,L]=i.useState(f[0]||new Date().getFullYear());return e.jsxs(e.Fragment,{children:[e.jsx(B,{title:`Winners - ${(d==null?void 0:d.name)||"Loading..."}`,breadcrumbItems:[{label:"Gold Programs",path:"/gold-programs"},{label:(d==null?void 0:d.name)||"Program",path:`/gold-programs/${c}`},{label:"Winners Management",active:!0}]}),e.jsx(W,{onClose:()=>m(!1),show:C,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:e.jsx(W.Body,{children:M})}),e.jsxs(N,{children:[e.jsx(g,{md:6,children:e.jsx(y,{className:"mb-4",children:e.jsxs(y.Body,{children:[e.jsx("h5",{children:"Add New Winner"}),e.jsxs(o,{onSubmit:F,children:[e.jsxs(N,{children:[e.jsx(g,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Year*"}),e.jsx(o.Select,{value:s.year,onChange:t=>x({...s,year:t.target.value}),required:!0,children:Array.from({length:5},(t,r)=>{const a=new Date().getFullYear()+r;return e.jsx("option",{value:a,children:a},a)})})]})}),e.jsx(g,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Month*"}),e.jsxs(o.Select,{value:s.month,onChange:t=>x({...s,month:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select month..."}),S.map((t,r)=>e.jsx("option",{value:r+1,children:t},t))]})]})})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Select Lot*"}),e.jsxs(o.Select,{value:s.lotId,onChange:t=>x({...s,lotId:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Choose lot..."}),D.map(t=>{var r,a;return e.jsxs("option",{value:t.id,children:[(r=t.user)==null?void 0:r.name," (Member ID: ",(a=t.user)==null?void 0:a.memberId,")"]},t.id)})]})]}),e.jsx(z,{type:"submit",variant:"primary",disabled:v,children:v?e.jsx(R,{size:"sm",animation:"border"}):"Add Winner"})]})]})})}),e.jsx(g,{md:6,children:e.jsx(y,{children:e.jsxs(y.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h5",{children:"Current Winners"}),f.length>0&&e.jsx(o.Select,{style:{width:"120px"},value:j,onChange:t=>L(parseInt(t.target.value)),children:f.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs(q,{striped:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Month"}),e.jsx("th",{children:"Winner"}),e.jsx("th",{children:"Member ID"}),e.jsx("th",{children:"Prize"})]})}),e.jsx("tbody",{children:u.filter(t=>t.year===j).sort((t,r)=>t.month-r.month).map(t=>{var r,a,l,n;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(E,{bg:"info",children:S[t.month-1]})}),e.jsx("td",{children:((a=(r=t.lot)==null?void 0:r.user)==null?void 0:a.name)||"N/A"}),e.jsx("td",{children:((n=(l=t.lot)==null?void 0:l.user)==null?void 0:n.memberId)||"N/A"})]},t.id)})})]}),u.filter(t=>t.year===j).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted",children:["No winners for ",j]})]})})})]})]})};export{ie as default};
