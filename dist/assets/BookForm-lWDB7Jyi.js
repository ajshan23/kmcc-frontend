import{d as L,u as q,r as i,j as e,T as A,h as G,i as R}from"./index-CfNT85tM.js";import{a as f}from"./api-BAouzzCb.js";import{P as $}from"./PageTitle-D_HZ265t.js";import{l as M}from"./logo-sm-DeRMNujR.js";import{R as F,C as x}from"./Row-pUvplkm2.js";import{C as U}from"./Card-BxC9ygCX.js";import{C as H}from"./CardBody-TiP-bp9B.js";import{F as s}from"./Form-BPTIrVzf.js";import{B}from"./Button-DmtmunvM.js";import"./CardHeaderContext-DMh6jMut.js";import"./divWithClassName-MTQsKDs0.js";import"./FormCheck-DtwGqKiM.js";import"./FormContext-CAGAzZgQ.js";import"./ElementChildren-ShUlXlPu.js";import"./FormControl-dmhg-08h.js";import"./FormLabel-CoJ0DtNH.js";import"./Button-AVmPP0NH.js";const ie=()=>{const{id:c}=L(),a=!!c,g=q(),[N,n]=i.useState(!1),[P,l]=i.useState(""),[p,j]=i.useState(""),[u,C]=i.useState(""),[b,v]=i.useState(""),[h,S]=i.useState(null),[y,k]=i.useState(null),[d,T]=i.useState(null),[w,m]=i.useState(!1);i.useEffect(()=>{a&&(async()=>{try{const t=await f.get(`/book/${c}`);if(t.status===200){const r=t.data.data;j(r.title||""),C(r.author||""),v(r.description||""),k(r.coverImage||null)}}catch(t){console.error("Error fetching book:",t),l("Failed to load book data"),n(!0)}})()},[c,a]);const E=o=>{const t=o.target.files[0];if(!t)return;if(!t.type.match("image.*")){l("Please select an image file"),n(!0);return}S(t);const r=new FileReader;r.onload=()=>{k(r.result)},r.readAsDataURL(t)},D=o=>{const t=o.target.files[0];if(t){if(t.type!=="application/pdf"){l("Please select a PDF file"),n(!0);return}T(t)}},I=async o=>{if(o.preventDefault(),m(!0),!p||!u){l("Title and author are required"),n(!0),m(!1);return}if(!a&&(!h||!d)){l("Both cover image and PDF file are required"),n(!0),m(!1);return}const t=new FormData;t.append("title",p),t.append("author",u),t.append("description",b),h&&t.append("coverImage",h),d&&t.append("pdf",d);try{let r;a?r=await f.put(`/book/${c}`,t,{headers:{"Content-Type":"multipart/form-data"}}):r=await f.post("/book",t,{headers:{"Content-Type":"multipart/form-data"}}),r.status===(a?200:201)&&(l(`Book ${a?"updated":"created"} successfully!`),n(!0),setTimeout(()=>{g("/book")},1500))}catch(r){console.error(`Error ${a?"updating":"creating"} book:`,r),l(`Failed to ${a?"update":"create"} book. Please try again.`),n(!0)}finally{m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx($,{title:a?"Edit Book":"Add New Book"}),e.jsxs(A,{onClose:()=>n(!1),show:N,delay:3e3,autohide:!0,style:{position:"fixed",top:20,right:20,zIndex:9999},children:[e.jsxs(G,{children:[e.jsx("img",{src:M,alt:"brand-logo",height:"16",className:"me-1"}),e.jsx("strong",{className:"me-auto",children:"KMCC"})]}),e.jsx(R,{children:P})]}),e.jsx(F,{children:e.jsx(x,{xs:12,children:e.jsx(U,{children:e.jsx(H,{children:e.jsxs(s,{onSubmit:I,children:[e.jsxs(F,{children:[e.jsxs(x,{md:6,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Title *"}),e.jsx(s.Control,{type:"text",value:p,onChange:o=>j(o.target.value),placeholder:"Enter book title",required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Author *"}),e.jsx(s.Control,{type:"text",value:u,onChange:o=>C(o.target.value),placeholder:"Enter author name",required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Description"}),e.jsx(s.Control,{as:"textarea",rows:3,value:b,onChange:o=>v(o.target.value),placeholder:"Enter book description"})]})]}),e.jsxs(x,{md:6,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsxs(s.Label,{children:["Cover Image ",!a&&"*"]}),e.jsx(s.Control,{type:"file",accept:"image/*",onChange:E,required:!a}),y&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{children:"Preview:"}),e.jsx("img",{src:y,alt:"Cover preview",style:{maxHeight:"200px"}})]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsxs(s.Label,{children:["PDF File ",!a&&"*"]}),e.jsx(s.Control,{type:"file",accept:"application/pdf",onChange:D,required:!a}),d&&e.jsx("div",{className:"mt-2",children:e.jsxs("p",{children:["Selected file: ",d.name]})})]})]})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-4",children:[e.jsx(B,{variant:"secondary",className:"me-2",onClick:()=>g("/book"),children:"Cancel"}),e.jsx(B,{variant:"primary",type:"submit",disabled:w,children:w?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),a?"Updating...":"Creating..."]}):a?"Update Book":"Add Book"})]})]})})})})})]})};export{ie as default};
